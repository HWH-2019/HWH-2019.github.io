---
title: vs2019下创建的Qt项目发布并制作安装程序流程
author: HWH
tags:
  - Qt
  - Installer
  - vs2019
categories: Tutorial
abbrlink: 6aa9d26a
date: 2022-11-18 20:34:25
---



## 写在前面
 - 梳理了如何制作安装教程的流程。
 - 在以下测试环境中通过
 	- VS2019
 	- Qt 5.14.2
 	- Windows 10
 - 总结了网上主流教程没有的解决问题方法
 	- [Qt项目拉取依赖](#jump1)
 	- [`Application Folder`下创建的文件夹，将不会自动创建](#jump2)
 	- [生成项目时报有警告](#jump3)
 - 文章没有图片，但十分详细如果环境相似请耐心阅读。

## 首先下载Microsoft Visual Studio Installer Projects插件
- 项目下点击: 扩展->管理扩展->选择联机->搜索框输入`installer`搜索->安装插件->关闭所有vs界面后自动安装。

## 新建Setup项目
- 项目下点击: 右键解决方案->添加->新建项目...->搜索`Setup`->选择`Setup Project`-> 下一步直到创建好Setup项目

## 了解Setup项目
- vs在创建好Setup项目后会默认打开项目的文件系统，如果不慎关闭或者未打开可以依次点击: 右键Setup项目->view->文件系统(File System)
- 文件系统(File System)中主要分为三个文件夹`Application Folder`, `User's Desktop` ,`User'sPrograms Menu`
	- `Application Folder` 存放主程序入口(主输出)、依赖(.dll)、图标(.ico)、卸载程序
	- `User's Desktop` 存放桌面快捷方式
	- `User's Programs Menu`	存放开始菜单的快捷方式
<span id="jump1"></span>
## Qt项目制作安装程序前准备

- vs生成Release版本的.exe: 点击调试->项目属性->点击配置管理器->检查是否为Release->点击生成->生成项目。
- 从Qt自带的控制台进入->将路径切换到生成的Release版本的.exe路径下->执行`windeployqt xxx.exe`
- `xxx.exe`为你Qt项目的名称。
- 等待执行完毕则成功将Qt项目所需的依赖(.dll)，拉取到你的.exe文件目录下，此时双击.exe文件则可直接执行。

## 编辑Setup项目

### 首先添加主输出
- 右键`Application Folder`->Add->项目输出->主输出

### 添加依赖
- 右键`Application Folder`->Add->文件，选择需要的文件(.dll)

### 添加具有文件夹的依赖
- 例如Qt项目所需的依赖一部分与.exe同级另一部分则在与.exe同级的文件夹下
- 右键`Application Folder`->Add->文件夹(Folder)->修改文件夹名称为依赖所需的文件夹名->单击打开文件夹->右侧右击->Add->文件，选择需要的文件(.dll)
<span id="jump2"></span>
### 使文件夹在安装的时候创建
- 如果不做修改，在生成好`Setup.exe`和`Setup.msi`文件后，安装到电脑时，对于自己在`Application Folder`下创建的文件夹，将不会自动创建，因此会破坏目录结构，安装好的文件将因为无法找到依赖而无法运行。
- 解决方法: 右键自己创建的文件夹->单击属性窗口(F4)->修改属性窗口中的`AlwaysCreate`和`transitive`为`True`

### 添加快捷方式
- 桌面快捷方式(Shortcut): 打开`User's Desktop`->右侧右击->创建新的快捷方式(C)->选择`Application Folder`(默认)->点击Ok或者双击`Application Folder`->选择主输出->创建后修改快捷方式的名字(此名字为桌面自动生成的快捷方式的名字)
- 开始菜单的快捷方式: 打开`User's Programs Menu`->后续步骤与创建桌面快捷方式无异。
- 如有多个文件需要连接到开始菜单，可以在开始菜单创建文件夹来存放: 右键`User's Programs Menu`->Add->文件夹(Floder)->修改文件夹为想要的名字->打开文件夹->后续步骤与创建桌面快捷方式无异。
- 开始菜单的文件夹会自动创建。

### 添加图标
- 右键`Application Folder`->Add->文件，选择需要的图标文件(.ico)
- 给快捷方式添加图标: 单击创建好的快捷方式(Shortcut)->属性窗口中找到`Icon`->下拉框找到并单击`Browse`->再次点击弹出窗口的`Browse`->在`Application Folder`下找到需要的图标文件(.ico)->点击Ok添加完成。
- 所有快捷方式或者.exe只要属性窗口有`Icon`都可以参照上述步骤修改图标。
<span id="jump3"></span>
## 修改Setup项目属性
- 点击`Setup`项目，查看属性窗口
- 注意`Author`, `Manufacturer`,`ProductCode`,`TargetPlatform`,`Title`
- 尤其注意`TargetPlatform`,默认为`x86`,如果项目生成的是`x64`版本的需要修改，否则会报警告。
- 还有一项属性为了更好的兼容,可以修改也可以不修改。
- 步骤: 右键`Setup`项目->点击属性->点击`Prerequisites`->勾选`Microsoft .NET Framework 4.6.1 (x86和x64)`->点击确定

## 生成Setup项目
- 右键项目名生成
- 会生成`Setup.exe`和`Setup.msi`文件
- `Setup.exe`相当于`Setup.msi`的一个连接,使用`Setup.exe`安装时需要确保两个文件在同一目录下。
