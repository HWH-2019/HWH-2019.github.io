<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Ubuntu 安装配置代理(Linux for clash + proxychains)</title>
    <link href="/2022/12/10/Ubuntu-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86-Linux-for-clash-proxychains/"/>
    <url>/2022/12/10/Ubuntu-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86-Linux-for-clash-proxychains/</url>
    
    <content type="html"><![CDATA[<h3 id="写在前面">写在前面</h3><ul><li>这两天要装 FSL 软件发现第一步不挂代理是真的慢，所以决定研究一下怎么在 Linux 上挂代理</li><li>简单搜索后选择使用 <code>Linux for clash</code> 和 <code>proxychains</code> 解决代理问题</li><li>网上的教程很多但我试过之后大多会出现一些细节问题，而且千篇一律</li><li>所以整理一下挂代理的安装配置流程和细节</li><li>顺嘴提一句 <code>clash</code> 是真的好用</li></ul><h3 id="配置环境">配置环境</h3><ul><li>虚拟机： <code>VMware workstation pro 16</code></li><li>虚拟机操作系统： <code>ubuntu-18.04-desktop-amd64</code></li><li>Linux for clash版本：<code>clash-linux-amd64-v1.11.8</code></li></ul><h3 id="clash-安装配置">Clash 安装配置</h3><h4 id="linux-for-clash-下载">Linux for clash 下载</h4><ul><li>访问 <code>clash</code> 的<a href="https://github.com/Dreamacro/clash/releases">版本发布页</a>选择合适的版本下载</li><li>这里也提供我使用的 <a href="https://github.com/Dreamacro/clash/releases/download/v1.11.8/clash-linux-amd64-v1.11.8.gz">clash-linux-amd64-v1.11.8</a> 快速下载地址</li><li>可以通过浏览器下载，也可以使用 <code>wget</code>下载，<code>clash</code> 很小可以自行选择下载方式，以下提供 <code>wget</code> 下载命令</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://github.com/Dreamacro/clash/releases/download/v1.11.8/clash-linux-amd64-v1.11.8.gz<br></code></pre></td></tr></table></figure><h4 id="linux-for-clash-安装">Linux for clash 安装</h4><ul><li>首先对下载下来的压缩包解压，可以采用命令解压或者双击后提取，下面附解压命令</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gzip -d clash-linux-amd64-v1.11.8.gz<br></code></pre></td></tr></table></figure><ul><li>解压后对 <code>clash-linux-amd64-v1.11.8</code> 文件赋予执行权限</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> +x clash-linux-amd64-v1.11.8<br></code></pre></td></tr></table></figure><blockquote><p>注意：双击提取后的文件名可能为clash-linux-amd64，对应更改后续命令即可</p></blockquote><ul><li>使用 <code>mv</code> 命令将文件移动到指定目录，方便全局访问 <code>clash</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">mv</span> clash-linux-amd64-v1.11.8 /usr/local/bin/clash<br></code></pre></td></tr></table></figure><ul><li>终端执行 <code>clash -v</code> 命令检查 <code>clash</code> 能否正常运行，正常终端显示结果如下：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Clash v1.11.8 linux amd64 with go1.19 Fri Aug 26 13:20:30 UTC 2022<br></code></pre></td></tr></table></figure><h4 id="linux-for-clash-配置">Linux for clash 配置</h4><ul><li><code>clash</code> 运行需要依赖相应的 <code>YAML</code> 配置文件，默认读取 <code>$HOME/.config/clash/config.yaml</code></li><li>当没有这份文件的时候，clash 会使用默认配置生成一份，所以我们可以直接运行一下 <code>clash</code> ，来获取模版，同时会自动下载 <code>Country.mmdb</code> 文件</li><li>第一次在终端执行 <code>clash</code> 的结果如下：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">INFO[0000] Can<span class="hljs-string">&#x27;t find config, create a initial config file</span><br><span class="hljs-string">INFO[0000] Can&#x27;</span>t find MMDB, start download<br>INFO[0000] Mixed(http+socks) proxy listening at: 127.0.0.1:7890<br></code></pre></td></tr></table></figure><ul><li>此时已获得配置文件的模板，但这模板并没有什么用，<code>yaml</code> 文件的内容往往需要代理方提供，这就需要去购买 <code>VPN</code></li><li>大家可以自行找找，这里所需的 <code>VPN</code> 不能是基于软件（仅能在安装它所提供的软件后才可使用）的，而是可以提供订阅链接（即可以取得配置文件的）</li><li>在取得相应的配置文件后将其改名为 <code>config.yaml</code> 并替换相应目录下的初始文件</li></ul><h4 id="linux-for-clash-运行">Linux for clash 运行</h4><ul><li>在配置完成后即可在终端执行 <code>sudo clash</code> 运行，若无报错则运行成功</li><li>运行后可以浏览器访问 <a href="http://clash.razord.top/#/proxies">Clash控制台</a></li><li>如果访问失败，打开设置-&gt;网络-&gt;网络代理，切换为手动，设置下图参数后</li></ul><figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/26626d768c7f4d5faea12ee68e9a0c38~tplv-k3u1fbpfcp-zoom-1.image" alt="代理配置参数" /><figcaption aria-hidden="true">代理配置参数</figcaption></figure><ul><li>访问成功后将进入如下界面：</li></ul><figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4ad51b3f41bf4a689f3ff73361a45fb3~tplv-k3u1fbpfcp-zoom-1.image" alt="clash控制台" /><figcaption aria-hidden="true">clash控制台</figcaption></figure><ul><li>点击设置，检查<strong>允许来自局域网的连接</strong>是否开启</li></ul><figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78e9dc865f5642eba44af72935e75f30~tplv-k3u1fbpfcp-zoom-1.image" alt="设置页面" /><figcaption aria-hidden="true">设置页面</figcaption></figure><ul><li>访问尝试外网网站，如 <a href="https://www.google.com">Google</a></li><li>至此 <code>Linux for clash</code> 已经安装配置好，接下来将介绍如何配置开启自启动，如果不需要的可以跳过下一小节</li></ul><h4 id="linux-for-clash-开机自启">Linux for clash 开机自启</h4><ul><li>自启动的话将 <code>clash</code> 托管给 <code>systemd</code> 来管理</li><li>新建 <code>clash.service</code> 文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo gedit /etc/systemd/system/clash.service<br></code></pre></td></tr></table></figure><ul><li>将以下内容写入到文件中，注意修改 <code>ExecStart</code> 的路径</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[Unit]<br>Description=Clash - A rule-based tunnel <span class="hljs-keyword">in</span> Go<br>Documentation=https://github.com/Dreamacro/clash/wiki<br>[Service]<br>OOMScoreAdjust=-1000<br>ExecStart=/usr/local/bin/clash -f /root/.config/clash/config.yaml<br>Restart=on-failure<br>RestartSec=5<br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><ul><li><code>ExecStart</code> 的路径可以使用以下命令进行查询</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span> <span class="hljs-variable">$HOME</span>/.config/clash/config.yaml<br></code></pre></td></tr></table></figure><ul><li>配置开机自启，并启动 <code>clash</code> 服务</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl <span class="hljs-built_in">enable</span> clash<br>sudo systemctl start clash<br>sudo systemctl status clash<br></code></pre></td></tr></table></figure><ul><li><code>clash</code> 运行起来之后，会在 <code>http://127.0.0.1:7890</code> 这个地址监听 <code>HTTP_PROXY</code> 服务</li><li>接下来需要为 Linux 配置代理，使所有的 http 请求，都经由这个代理服务进出</li><li>Linux 提供了专门的环境变量 <code>http_proxy</code> 和 <code>https_proxy</code> 进行相关配置</li><li>采用以下命令设置并将其写入 <code>.bashrc</code> 文件中，使得每次开启终端都可以生效</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;export http_proxy=http://127.0.0.1:7890\nexport https_proxy=http://127.0.0.1:7890&quot;</span> &gt;&gt; ~/.bashrc<br></code></pre></td></tr></table></figure><ul><li>重新打开个终端，配置即可生效</li></ul><h3 id="proxychains-安装配置">Proxychains 安装配置</h3><h4 id="下载安装">下载安装</h4><ul><li>使用 <code>apt</code> 进行安装，命令如下：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install proxychains<br></code></pre></td></tr></table></figure><h4 id="代理配置">代理配置</h4><ul><li>打开 <code>/etc/proxychains.conf</code> 文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo gedit /etc/proxychains.conf<br></code></pre></td></tr></table></figure><ul><li>在文件最后改成相应的代理方式、地址和端口，根据 <code>clash</code> 的配置，修改如下：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http127.0.0.1 7890<br></code></pre></td></tr></table></figure><h4 id="代理使用">代理使用</h4><ul><li>在命令前加 <code>proxychains</code> 即可</li><li>可以使用一下命令查看是否成功</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">proxychains curl -kIsS https://www.google.com<br></code></pre></td></tr></table></figure><h3 id="写在最后">写在最后</h3><ul><li>目前上述方法已在 <code>Ubuntu 18.04</code> 和 <code>Ubuntu 16.04</code> 上测试完成</li><li>若有其他问题欢迎评论指出</li></ul>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Ubuntu</tag>
      
      <tag>Clash</tag>
      
      <tag>Proxychains</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决 WebService 返回 DataSet XML 数据解析问题</title>
    <link href="/2022/12/10/%E8%A7%A3%E5%86%B3-WebService-%E8%BF%94%E5%9B%9E-DataSet-XML-%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90%E9%97%AE%E9%A2%98/"/>
    <url>/2022/12/10/%E8%A7%A3%E5%86%B3-WebService-%E8%BF%94%E5%9B%9E-DataSet-XML-%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="写在前面">写在前面</h3><ul><li>最近在写 WebService 时，遇到了使用第三方的 WebService 生成客户端代码后，对于请求返回的 DataSet 数据类型无法正确解析的问题。</li><li>经过近一天的尝试终于解决此问题，在此记录并分享。</li><li>这里贴上常用的第三方 WebService，<a href="http://www.webxml.com.cn/zh_cn/web_services.aspx?offset=1">常用的 WebService</a></li></ul><h3 id="问题描述">问题描述</h3><ul><li>使用 <code>IntelliJ IDEA 2020.2.3</code> 中提供的 <code>Glassfish /JAX-WS 2.2 RI / Metro 1.X/ JwSDP2.2</code> 方式生成客户端代码</li></ul><p><img src="https://img-blog.csdnimg.cn/3f1c22052f8e42bebe208870e233810f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>在调用请求返回的 DataSet 数据类型无法正确解析</li><li>返回结果 <code>[[xs:schema: null], [diffgr:diffgram: null]]</code></li></ul><h3 id="解决方法">解决方法</h3><ul><li>使用 <code>Axis</code> 生成客户端代码(<code>IntelliJ IDEA</code> 的可能存在问题，实在不行可以试试 <code>eclipse</code>)</li></ul><p><img src="https://img-blog.csdnimg.cn/57af88dc0d3e4339b3c00825b7e3d3cc.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>使用代理对象返回数据（此处以获取邮政编码为例）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ChinaZipSearchWebServiceSoapProxy</span> <span class="hljs-variable">chinaZipSearchWebServiceSoapProxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChinaZipSearchWebServiceSoapProxy</span>();<br><br><span class="hljs-type">GetAddressByZipCodeResponseGetAddressByZipCodeResult</span> <span class="hljs-variable">addressByZipCode</span> <span class="hljs-operator">=</span> chinaZipSearchWebServiceSoapProxy.getAddressByZipCode(<span class="hljs-string">&quot;212300&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br><br>MessageElement[] any = addressByZipCode.get_any();<br></code></pre></td></tr></table></figure><ul><li>返回的 <code>any</code> 即为包含目标数据的<code>XML</code> 结果</li><li>手动编写代码对 <code>XML</code> 进行解析并获得数据</li></ul><h3 id="写在最后">写在最后</h3><ul><li>我对 XML 的解析操作进行了封装，将其封装成一个工具类，具体代码如下：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.huang.util;<br><br><span class="hljs-keyword">import</span> org.apache.axis.message.MessageElement;<br><span class="hljs-keyword">import</span> org.jdom2.Document;<br><span class="hljs-keyword">import</span> org.jdom2.Element;<br><span class="hljs-keyword">import</span> org.jdom2.JDOMException;<br><span class="hljs-keyword">import</span> org.jdom2.input.SAXBuilder;<br><br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 描述：WebService 返回 DataSet XML 数据解析</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * 方法：DataSetXmlToListMap(MessageElement[] any,List&lt;String&gt; elemNames)</span><br><span class="hljs-comment"> *      -- 解析 any 中  elemNames 指定的数据</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * 使用场景：WebService 采用 Axis 生成客户端代码，服务请求返回结果为 DataSet XML</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * 作者：HWH</span><br><span class="hljs-comment"> * 日期：2022-4-24 20:42</span><br><span class="hljs-comment"> * 邮箱：huangwenhuan2019@outlook.com</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebServiceXmlUtil</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 解析 any 中  elemNames 指定的数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> any MessageElement 数组对象</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> elemNames List&lt;String&gt; 为解析指定的字段名</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> List&lt;Map&lt;String,Object&gt;&gt; any 中  elemNames 指定的数据，其中 Map 键为小写的 elemNames 中的元素</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> JDOMException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Map&lt;String,Object&gt;&gt; <span class="hljs-title function_">DataSetXmlToListMap</span><span class="hljs-params">(MessageElement[] any,List&lt;String&gt; elemNames)</span> <span class="hljs-keyword">throws</span> JDOMException, IOException &#123;<br>        <span class="hljs-type">List</span> <span class="hljs-variable">children</span> <span class="hljs-operator">=</span> any[<span class="hljs-number">1</span>].getChildren();<br>        List&lt;Map&lt;String, Object&gt;&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-type">SAXBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXBuilder</span>();<br>        <span class="hljs-keyword">for</span> (Object child : children) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> child.toString();<br>            <span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(str.getBytes(StandardCharsets.UTF_8));<br>            <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> sb.build(in);<br>            <span class="hljs-type">Element</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> doc.getRootElement(); <span class="hljs-comment">// 得到根元素</span><br>            List&lt;Element&gt; focs = root.getChildren();<br>            <span class="hljs-keyword">for</span> (Element o : focs) &#123;<br>                Map&lt;String, Object&gt; tmp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>                <span class="hljs-keyword">for</span>(String elemName : elemNames)&#123;<br>                    tmp.put(elemName.toLowerCase() , o.getChild(elemName).getText());<br>                &#125;<br>                list.add(tmp);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Solutions</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WebService</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>实现 Jdbc 优雅的链式调用</title>
    <link href="/2022/12/10/%E5%AE%9E%E7%8E%B0-Jdbc-%E4%BC%98%E9%9B%85%E7%9A%84%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8/"/>
    <url>/2022/12/10/%E5%AE%9E%E7%8E%B0-Jdbc-%E4%BC%98%E9%9B%85%E7%9A%84%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="写在前面">写在前面</h3><ul><li>今天用到了 <code>Jdbc</code> 进行数据库的一些操作，要写很多重复连接关闭的代码，刚好最近在学设计模式，就突发奇想浅浅的用一下设计模式，给它封装一下吧</li><li>写的很简单，也可能有很多不足的地方，欢迎评论指出哦。</li><li>只是设计模式的一个练习，不一定实用，大家且看看吧。</li></ul><h3 id="实现说明">实现说明</h3><h4 id="核心">核心</h4><ul><li>链式调用</li><li>建造者模式</li><li>接口回调</li></ul><h4 id="相关说明">相关说明</h4><h5 id="链式调用">链式调用</h5><ul><li>链式调用: <code>chained invocation</code>(链式调用）或者<code>Method chaining</code>，这种风格的AP设计叫做<code>fluent API</code>或者<code>Fluent interface</code></li><li>常用于<code>Builder Pattern</code>(建造者模式)。</li></ul><h5 id="建造者模式">建造者模式</h5><ul><li>建造者模式是设计模式的一种，将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。</li></ul><h5 id="接口回调">接口回调</h5><ul><li>接口回调是指：可以把使用某一接口的类创建的对象的引用赋给该接口声明的接口变量，那么该接口变量就可以调用被类实现的接口的方法。</li><li>实际上，当接口变量调用被类实现的接口中的方法时，就是通知相应的对象调用接口的方法，这一过程称为对象功能的接口回调。</li></ul><h3 id="源码部分">源码部分</h3><ul><li>如何使用话已经总结在代码开头的注释了，连同方法作用也一并整理了。</li><li>好了直接看源码如下：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.huang.util;<br><br><span class="hljs-keyword">import</span> java.sql.*;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 描述：Jdbc 工具类 实现Jdbc的快速使用，链式调用</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * 方法：Builder() -- 构建 jdbc 基本属性</span><br><span class="hljs-comment"> *      setUrl() -- 设置 jdbc url</span><br><span class="hljs-comment"> *      setName() -- 设置 jdbc 用户名</span><br><span class="hljs-comment"> *      setPwd() -- 设置 jdbc 密码</span><br><span class="hljs-comment"> *      -------------------------</span><br><span class="hljs-comment"> *      connect() -- 连接 初始化 Connection 对象</span><br><span class="hljs-comment"> *      -------------------------</span><br><span class="hljs-comment"> *      setSql() -- 设置 sql 语句, 初始化 PreparedStatement 对象</span><br><span class="hljs-comment"> *      -------------------------(待更新)</span><br><span class="hljs-comment"> *      setParamString() -- 设置 sql 语句中对应参数 字符串类型</span><br><span class="hljs-comment"> *      setParamInt() -- 设置 SQL 语句中对应参数 整型</span><br><span class="hljs-comment"> *      -------------------------(待更新)</span><br><span class="hljs-comment"> *      execute() -- 插入，删除语句执行</span><br><span class="hljs-comment"> *      executeQuery() -- 查询语句执行</span><br><span class="hljs-comment"> *      executeUpdate() -- 更新语句执行</span><br><span class="hljs-comment"> *      -------------------------</span><br><span class="hljs-comment"> *      setCallBack() -- 设置回调函数</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * 使用：new JdbcUtil.Builder()</span><br><span class="hljs-comment"> *                 .connect()</span><br><span class="hljs-comment"> *                 .setSql(&quot;select * from user where email = ? and password = ?;&quot;)</span><br><span class="hljs-comment"> *                 .setParamString(1, email)</span><br><span class="hljs-comment"> *                 .setParamString(2, password)</span><br><span class="hljs-comment"> *                 .setCallBack(new CallBack() &#123;</span><br><span class="hljs-comment"> *                     <span class="hljs-doctag">@Override</span></span><br><span class="hljs-comment"> *                     public void executeResult(ResultSet resultSet) &#123;</span><br><span class="hljs-comment"> *                         super.executeResult(resultSet);</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *                     &#125;</span><br><span class="hljs-comment"> *                 &#125;)</span><br><span class="hljs-comment"> * 作者：HWH</span><br><span class="hljs-comment"> * 日期：2022-4-12 14:29</span><br><span class="hljs-comment"> * 邮箱：huangwenhuan2019@outlook.com</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdbcUtil</span> &#123;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 接口回调</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ICallBack</span>&#123;<br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeResult</span><span class="hljs-params">(ResultSet resultSet)</span>;<br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeResult</span><span class="hljs-params">(<span class="hljs-type">int</span> result)</span>;<br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeResult</span><span class="hljs-params">(<span class="hljs-type">boolean</span> result)</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallBack</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICallBack</span>&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeResult</span><span class="hljs-params">(<span class="hljs-type">int</span> result)</span> &#123;<br><br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeResult</span><span class="hljs-params">(<span class="hljs-type">boolean</span> result)</span> &#123;<br><br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeResult</span><span class="hljs-params">(ResultSet resultSet)</span> &#123;<br><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span>&#123;<br>        <span class="hljs-keyword">private</span> String url;<br>        <span class="hljs-keyword">private</span> String name;<br>        <span class="hljs-keyword">private</span> String pwd;<br>        <span class="hljs-keyword">private</span> Connection connection;<br>        <span class="hljs-keyword">private</span> PreparedStatement preparedStatement;<br>        <span class="hljs-keyword">private</span> CallBack callBack;<br><br><br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 构建 jdbc 基本属性</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Builder</span><span class="hljs-params">()</span>&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                Class.forName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>            <span class="hljs-comment">//获取连接</span><br>            url = <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/webservice?serverTimezone=GMT&quot;</span>;<br>            name = <span class="hljs-string">&quot;root&quot;</span>;<br>            pwd = <span class="hljs-string">&quot;15715293569&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 设置 jdbc url</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span> url jdbc 的 url</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@return</span> Builder 对象</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">setUrl</span><span class="hljs-params">(String url)</span> &#123;<br>            <span class="hljs-built_in">this</span>.url = url;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 设置 jdbc 用户名</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span> name jdbc 的 用户名</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@return</span> Builder 对象</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>            <span class="hljs-built_in">this</span>.name = name;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 设置 jdbc 密码</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span> pwd jdbc 的 密码</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@return</span> Builder 对象</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">setPwd</span><span class="hljs-params">(String pwd)</span> &#123;<br>            <span class="hljs-built_in">this</span>.pwd = pwd;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 连接 初始化 Connection 对象</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@return</span> Builder 对象</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">connect</span><span class="hljs-params">()</span>&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                connection = DriverManager.getConnection(url, name, pwd);<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>                throwables.printStackTrace();<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 设置 sql 语句, 初始化 PreparedStatement 对象</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span> sql sql 语句 字符串</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@return</span> Builder 对象</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">setSql</span><span class="hljs-params">(String sql)</span>&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span>(connection==<span class="hljs-literal">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">&quot;connection is null, please invoke connect() to create it.&quot;</span>);<br>                preparedStatement = connection.prepareStatement(sql);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception throwables) &#123;<br>                throwables.printStackTrace();<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 设置 sql 语句中对应参数 字符串类型</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span> index 参数索引</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span> value 参数值</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@return</span> Builder 对象</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">setParamString</span><span class="hljs-params">(<span class="hljs-type">int</span> index,String value)</span>&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span>(preparedStatement!=<span class="hljs-literal">null</span>)&#123;<br>                    preparedStatement.setString(index,value);<br>                &#125;<span class="hljs-keyword">else</span>&#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">&quot;preparedStatement is null, please invoke the setSql() to create it.&quot;</span>);<br>                &#125;<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.getStackTrace();<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * setParamInt() -- 设置 SQL 语句中对应参数 整型</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span> index 参数索引</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span> value 参数值</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@return</span> Builder 对象</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">setParamInt</span><span class="hljs-params">(<span class="hljs-type">int</span> index,<span class="hljs-type">int</span> value)</span>&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span>(preparedStatement!=<span class="hljs-literal">null</span>)&#123;<br>                    preparedStatement.setInt(index,value);<br>                &#125;<span class="hljs-keyword">else</span>&#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">&quot;preparedStatement is null, please invoke the setSql() to create it.&quot;</span>);<br>                &#125;<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.getStackTrace();<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 插入，删除语句执行</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span>&#123;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                result = preparedStatement.execute();<br>                callBack.executeResult(result);<br>                preparedStatement.close();<br>                connection.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>                throwables.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 查询语句执行</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeQuery</span><span class="hljs-params">()</span>&#123;<br>            <span class="hljs-type">ResultSet</span> <span class="hljs-variable">resultSet</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                resultSet = preparedStatement.executeQuery();<br>                callBack.executeResult(resultSet);<br>                resultSet.close();<br>                preparedStatement.close();<br>                connection.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>                throwables.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 更新语句执行</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeUpdate</span><span class="hljs-params">()</span>&#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                result = preparedStatement.executeUpdate();<br>                callBack.executeResult(result);<br>                preparedStatement.close();<br>                connection.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>                throwables.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 设置回调函数</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span> callBack 回调函数</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@return</span> Builder 对象</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">setCallBack</span><span class="hljs-params">(CallBack callBack)</span>&#123;<br>            <span class="hljs-built_in">this</span>.callBack = callBack;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="写在最后">写在最后</h3><ul><li>感觉对于一般的数据库操作已经覆盖了，当然还有很多其他的方法没有实现，可以在必要的时候添加。</li></ul>]]></content>
    
    
    <categories>
      
      <category>Summarize</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jdbc</tag>
      
      <tag>设计模式</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntu中 cmake 版本升级，解决CMake 3.10 or higher is required</title>
    <link href="/2022/12/10/Ubuntu%E4%B8%AD-cmake-%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%EF%BC%8C%E8%A7%A3%E5%86%B3CMake-3-10-or-higher-is-required/"/>
    <url>/2022/12/10/Ubuntu%E4%B8%AD-cmake-%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%EF%BC%8C%E8%A7%A3%E5%86%B3CMake-3-10-or-higher-is-required/</url>
    
    <content type="html"><![CDATA[<h3 id="写在前面">写在前面</h3><ul><li>今天在跑 SLAM十三讲 第三章的 visualizeGeometry 配套代码时，需要安装 <code>Pangolin</code> 库，下载源码编译时报错 <code>CMake 3.10 or higher is required</code>，记录一下解决方法。</li></ul><h3 id="解决方法">解决方法</h3><ul><li>卸载原有的cmake</li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">sudo apt <span class="hljs-built_in">auto</span>remove cmake<br></code></pre></td></tr></table></figure><ul><li>进入 <code>/usr/bin</code> 目录（cmake 默认安装路径）</li><li>下载源码压缩包并解压（需要其他版本只需修改相应版本即可）</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> https://github.com/Kitware/CMake/releases/download/v3.<span class="hljs-number">10</span>.<span class="hljs-number">0</span>/cmake-<span class="hljs-number">3</span>.<span class="hljs-number">10</span>.<span class="hljs-number">0</span>.tar.gz<br><span class="hljs-attribute">tar</span> -zxvf cmake-<span class="hljs-number">3</span>.<span class="hljs-number">10</span>.<span class="hljs-number">0</span>.tar.gz<br></code></pre></td></tr></table></figure><ul><li>如果出现无法下载可以浏览器访问网址直接下载</li><li>安装相关依赖</li></ul><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">sudo apt <span class="hljs-keyword">install</span> libssl-dev build-essential<br></code></pre></td></tr></table></figure><ul><li>安装</li></ul><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gauss">sudo ./bootstrap<br>sudo <span class="hljs-built_in">make</span><br>sudo <span class="hljs-built_in">make</span> install<br><br><span class="hljs-meta"># 一步到位</span><br>sudo ./bootstrap &amp;&amp; sudo <span class="hljs-built_in">make</span> &amp;&amp; sudo <span class="hljs-built_in">make</span> install<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Solutions</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Ubuntu</tag>
      
      <tag>CMake</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【linux系列】融会贯通 linux 内核编程集合 -- logsys练习项目</title>
    <link href="/2022/12/10/%E3%80%90linux%E7%B3%BB%E5%88%97%E3%80%91%E8%9E%8D%E4%BC%9A%E8%B4%AF%E9%80%9A-linux-%E5%86%85%E6%A0%B8%E7%BC%96%E7%A8%8B%E9%9B%86%E5%90%88-logsys%E7%BB%83%E4%B9%A0%E9%A1%B9%E7%9B%AE/"/>
    <url>/2022/12/10/%E3%80%90linux%E7%B3%BB%E5%88%97%E3%80%91%E8%9E%8D%E4%BC%9A%E8%B4%AF%E9%80%9A-linux-%E5%86%85%E6%A0%B8%E7%BC%96%E7%A8%8B%E9%9B%86%E5%90%88-logsys%E7%BB%83%E4%B9%A0%E9%A1%B9%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<h1 id="logsys">logsys</h1><ul><li><p>This is <a href="https://github.com/HWH-2019/logsys">a comprehensive exercise project for linux kernel modification</a>, including adding system calls, modifying the xfs file system, adding block device drivers, timer usage and page fault interrupt statistics.</p></li><li><p>We have combined these five parts into a log management system, of course the effect is very simple, but I believe it is enough for an exercise.</p></li><li><p>In addition to providing the source code of the final effect, a detailed tutorial on the operation of different modules is also specially prepared. Of course, in order to integrate it, we finally made some adjustments, but starting from the simplest, I believe you can understand the linux kernel better.</p></li><li><p>这是<a href="https://github.com/HWH-2019/logsys">linux内核修改的一个综合练习项目</a>，包含了添加系统调用、修改xfs文件系统、添加块设备驱动、定时器使用和缺页中断数统计。</p></li><li><p>我们将这五个部分融合成了一个日志管理系统，当然效果非常简陋，不过我相信用来作为练习已经够用了。</p></li><li><p>除了提供了最终效果的源码外，还专门准备了不同模块操作的详细教程，当然为了融合起来我们最终做了一些调整，但是从最简单的开始我相信你能更加理解linux内核。</p></li></ul><h1 id="environment">Environment</h1><ul><li>虚拟机： <code>VMware workstation pro 16</code></li><li>虚拟机操作系统： <code>ubuntu-20.04.3-desktop-amd64</code></li><li>原系统内核版本：<code>5.11.0-46-generic</code></li><li>内核源码版本：<code>5.11.1</code></li></ul><h1 id="structure">Structure</h1><ul><li><strong>driver</strong> -- Contains a custom block device driver module</li><li><strong>pagefault</strong> -- Contains a custom page fault interrupt statistics module</li><li><strong>syscall</strong> -- Contains system call test files</li><li><strong>xfs</strong> -- Most of the content in this folder comes from the linux kernel, we just modified part of the files</li><li><strong>main.cpp</strong> -- The main program, including the use of system calls and user logic processing</li><li><strong>start.sh</strong> -- Startup scripts, including preparation of various modules</li><li><strong>clean.sh</strong> -- Clean up scripts, remove related modules</li></ul><h1 id="tutorials">Tutorials</h1><ul><li><p><a href="https://blog.csdn.net/h2763246823/article/details/122534644?spm=1001.2014.3001.5501">Adding system calls(添加系统调用)</a></p></li><li><p><a href="https://blog.csdn.net/h2763246823/article/details/122538992?spm=1001.2014.3001.5501">Modifying the xfs file system(修改xfs文件系统)</a></p></li><li><p><a href="https://blog.csdn.net/h2763246823/article/details/122548221?spm=1001.2014.3001.5501">Adding block device drivers(添加块设备驱动)</a></p></li><li><p><a href="https://blog.csdn.net/h2763246823/article/details/122559742">Page fault interrupt statistics(缺页中断数统计)</a></p></li><li><p><a href="https://blog.csdn.net/weixin_45762499/article/details/122566973">Timer usage(定时器使用)</a></p></li></ul><h1 id="related">Related</h1><ul><li><a href="https://github.com/HWH-2019/logsys">Project related source code(项目相关源码)</a></li><li><a href="https://blog.csdn.net/h2763246823/article/details/122522464">Install and create a virtual machine(安装并创建虚拟机)</a></li><li><a href="https://blog.csdn.net/h2763246823/article/details/122523076">Install Ubuntu under VMware virtual machine(VMware虚拟机下安装Ubuntu)</a></li><li><a href="https://blog.csdn.net/h2763246823/article/details/122522326">The latest tutorial on kernel compilation + summary of common problems(内核编译最新教程+常见问题总结)</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
      <category>Projects</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>操作系统</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【linux系列】统计Linux系统缺页的次数</title>
    <link href="/2022/12/10/%E3%80%90linux%E7%B3%BB%E5%88%97%E3%80%91%E7%BB%9F%E8%AE%A1Linux%E7%B3%BB%E7%BB%9F%E7%BC%BA%E9%A1%B5%E7%9A%84%E6%AC%A1%E6%95%B0/"/>
    <url>/2022/12/10/%E3%80%90linux%E7%B3%BB%E5%88%97%E3%80%91%E7%BB%9F%E8%AE%A1Linux%E7%B3%BB%E7%BB%9F%E7%BC%BA%E9%A1%B5%E7%9A%84%E6%AC%A1%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h3 id="编译环境">编译环境</h3><ul><li>虚拟机操作系统： <code>ubuntu-20.04.3-desktop-amd64</code></li><li>原系统内核版本：<code>5.11.0-46-generic</code></li><li>内核源码版本：<code>5.11.1</code></li></ul><h3 id="修改任务">修改任务</h3><ul><li>通过在Linux内核中自建变量，并利用 <code>/proc</code> 文件系统作为中介的方法，统计一段时间内系统缺页的次数。</li><li>在内核中实现缺页次数统计。</li><li>新建内核模块，编译并安装新内核。</li><li>使用定时器设置开始和结束时间，通过 <code>/proc</code> 在用户态下查看该时间段内的缺页次数。</li></ul><h3 id="修改准备">修改准备</h3><ul><li><a href="https://cdn.kernel.org/pub/linux/kernel/">下载内核源码</a></li></ul><h3 id="修改源码">修改源码</h3><ul><li>需要修改的文件(默认从源码目录开始)如下：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">arch</span>/x86/mm/fault.c<br><br>include/linux/mm.h<br><br>kernel/kallsyms.c<br></code></pre></td></tr></table></figure><h4 id="修改-archx86mmfault.c">修改 arch/x86/mm/fault.c</h4><ul><li>定义 <strong>pfcount</strong> 变量</li><li>搜索 <code>trace_page_fault</code>，并插入如下代码：</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-keyword">volatile</span> pfcount;<br></code></pre></td></tr></table></figure><ul><li>效果如下：</li></ul><p><img src="https://img-blog.csdnimg.cn/76a9a2504ce24e6ca2a4fc81b1cf372b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>搜索 <code>good_area:</code>，并添加如下代码</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">pfcount++;<br></code></pre></td></tr></table></figure><ul><li>效果如下：</li></ul><p><img src="https://img-blog.csdnimg.cn/72f2a55af24f4e118769d5df0f89ea2d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h4 id="修改-includelinuxmm.h">修改 include/linux/mm.h</h4><ul><li>在 <code>extern int page_cluster;</code> 语句之后，添加如下代码：</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">extern</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-keyword">volatile</span> pfcount;<br></code></pre></td></tr></table></figure><ul><li>效果如下：</li></ul><p><img src="https://img-blog.csdnimg.cn/7775e4df98ec4a6b95963cada051ad11.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h4 id="修改-kernelkallsyms.c">修改 kernel/kallsyms.c</h4><ul><li>在最后一行添加如下代码：</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">EXPORT_SYMBOL(pfcount);<br></code></pre></td></tr></table></figure><ul><li>效果如下：</li></ul><p><img src="https://img-blog.csdnimg.cn/a58f8ec248cc4078b1df04ba9e01e842.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h3 id="编译安装">编译安装</h3><ul><li>无需修改配置文件，直接编译即可</li><li>安装后重启进入新系统</li><li>内核编译相关问题可以参考我之前的文章，<a href="https://blog.csdn.net/h2763246823/article/details/122522326">【linux系列】内核编译最新教程+常见问题总结</a></li></ul><h3 id="编写模块">编写模块</h3><ul><li>这里提供一份完整源码(readpfcount.c)：</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/module.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/sched.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/uaccess.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/proc_fs.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/fs.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/mm.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/seq_file.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/slab.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/kernel.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/timer.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/jiffies.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdarg.h&gt;</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-keyword">volatile</span> pfcount;<br><span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timer_list</span> <span class="hljs-title">test_timer</span>;</span><br><span class="hljs-type">static</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> pfcount_last;<br><span class="hljs-type">static</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> pfcount_in_2;<br><span class="hljs-type">static</span> <span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;<br><br>MODULE_LICENSE(<span class="hljs-string">&quot;GPL&quot;</span>);<br><br><br><span class="hljs-comment">/*5,实现show函数</span><br><span class="hljs-comment">  作用是将内核数据输出到用户空间</span><br><span class="hljs-comment">  将在proc file输出时被调用</span><br><span class="hljs-comment">  */</span><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">my_proc_show</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v)</span><br>&#123;<br>    <span class="hljs-comment">/*这里不能使用printfk之类的函数</span><br><span class="hljs-comment">      要使用seq_file输出的一组特殊函数</span><br><span class="hljs-comment">      */</span><br>seq_printf(m, <span class="hljs-string">&quot;[latest] Number of page fault interrupts in 2 seconds: %ld !\n&quot;</span>, pfcount_in_2);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">//定时器的回调函数</span><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">irq_test_timer_function</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> timer_list  *timer)</span><br>&#123;<br><br>printk(<span class="hljs-string">&quot;%d Number of page fault interrupts in 2 seconds: %ld\n&quot;</span>,count,pfcount - pfcount_last);<br>pfcount_in_2 = pfcount - pfcount_last;<br><br>pfcount_last = pfcount;<br>mod_timer(&amp;test_timer, jiffies + <span class="hljs-number">2</span> * HZ);<br>count++;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">my_proc_open</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> inode *inode, <span class="hljs-keyword">struct</span> file *file)</span><br>&#123;<br>    <span class="hljs-comment">/*4,在open函数中调用single_open绑定seq_show函数指针*/</span><br>    <span class="hljs-keyword">return</span> single_open(file, my_proc_show, <span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-comment">/*2,填充proc_create函数中调用的flie_operations结构体</span><br><span class="hljs-comment">  其中my开头的函数为自己实现的函数，</span><br><span class="hljs-comment">  seq和single开头为内核实现好的函数，直接填充上就行</span><br><span class="hljs-comment">  open为必须填充函数</span><br><span class="hljs-comment">  */</span><br><span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc_ops</span> <span class="hljs-title">my_fops</span> =</span> &#123;<br>  .proc_open = my_proc_open,<br>  .proc_read = seq_read,<br>  .proc_lseek = seq_lseek,<br>  .proc_release = single_release,<br>&#125;;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> __init <span class="hljs-title function_">my_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><br><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc_dir_entry</span> *<span class="hljs-title">file</span>;</span><br>    <span class="hljs-comment">//创建父级目录，第二个参数NULL表示在/proc下</span><br>    <span class="hljs-comment">//这里用我的学号当做文件名</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc_dir_entry</span> *<span class="hljs-title">parent</span> =</span> proc_mkdir(<span class="hljs-string">&quot;3190608027&quot;</span>,<span class="hljs-literal">NULL</span>);<br><br>    <span class="hljs-comment">/*1,</span><br><span class="hljs-comment">      首先要调用创建proc文件的函数，需要绑定flie_operations</span><br><span class="hljs-comment">      参数1：要创建的文件</span><br><span class="hljs-comment">      参数2：权限设置</span><br><span class="hljs-comment">      参数3：父级目录，如果传NULL，则在/proc下</span><br><span class="hljs-comment">      参数4：绑定flie_operations</span><br><span class="hljs-comment">      */</span><br>    file = proc_create(<span class="hljs-string">&quot;readpfcount&quot;</span>, <span class="hljs-number">0644</span>, parent, &amp;my_fops);<br>    <span class="hljs-keyword">if</span>(!file)<br>        <span class="hljs-keyword">return</span> -ENOMEM;<br><br>    <span class="hljs-comment">//创建定时器</span><br>    pfcount_last = pfcount;<br>test_timer.expires  = jiffies + <span class="hljs-number">2</span> * HZ;<br>timer_setup(&amp;test_timer, irq_test_timer_function, <span class="hljs-number">0</span>);<br><br>add_timer(&amp;test_timer);<br><br>printk(KERN_INFO <span class="hljs-string">&quot;already init and add timer\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">/*6,删除proc文件*/</span><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> __exit <span class="hljs-title function_">my_exit</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  printk(KERN_INFO <span class="hljs-string">&quot;exit timer drv\n&quot;</span>);<br>  del_timer(&amp;test_timer);<br>  <span class="hljs-comment">//移除目录及文件</span><br>  remove_proc_entry(<span class="hljs-string">&quot;readpfcount&quot;</span>, <span class="hljs-literal">NULL</span>);<br>&#125;<br><br>module_init(my_init);<br>module_exit(my_exit);<br></code></pre></td></tr></table></figure><ul><li>对应的 <strong>Makefile</strong> 文件：</li></ul><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Makefile"><span class="hljs-keyword">ifneq</span> (<span class="hljs-variable">$(KERNELRELEASE)</span>,)<br>obj-m:=readpfcount.o<br><span class="hljs-keyword">else</span><br>KDIR:= /usr/src/linux-5.11.1/<br>PWD:= <span class="hljs-variable">$(<span class="hljs-built_in">shell</span> pwd)</span><br><br><span class="hljs-section">default:</span><br><span class="hljs-variable">$(MAKE)</span> -C <span class="hljs-variable">$(KDIR)</span> M=<span class="hljs-variable">$(PWD)</span> modules<br><span class="hljs-section">clean:</span><br><span class="hljs-variable">$(MAKE)</span> -C <span class="hljs-variable">$(KDIR)</span> M=<span class="hljs-variable">$(PWD)</span> clean<br><span class="hljs-keyword">endif</span><br></code></pre></td></tr></table></figure><h3 id="编译安装模块">编译安装模块</h3><ul><li>根据对应的 <strong>Makefile</strong> 文件，可以直接使用 <code>sudo make</code> 进行编译</li><li>编译成功后会在当前文件夹下生成 <code>.ko</code> 文件</li><li>使用 <code>insmod</code> 安装模块</li><li>可以通过 <code>dmesg</code> 查看内核打印的信息</li><li>可以通过 <code>cat /proc/readpfcount</code> 命令，通过 <code>/proc</code> 在用户态下查看该时间段内的缺页次数。</li><li>效果如下图所示：</li></ul><p><img src="https://img-blog.csdnimg.cn/f3ab538c527b44d8aa39039a8a4526b4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>操作系统</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【linux系列】新增Linux块设备驱动</title>
    <link href="/2022/12/10/%E3%80%90linux%E7%B3%BB%E5%88%97%E3%80%91%E6%96%B0%E5%A2%9ELinux%E5%9D%97%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/"/>
    <url>/2022/12/10/%E3%80%90linux%E7%B3%BB%E5%88%97%E3%80%91%E6%96%B0%E5%A2%9ELinux%E5%9D%97%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="编译环境">编译环境</h3><ul><li>虚拟机操作系统： <code>ubuntu-20.04.3-desktop-amd64</code></li><li>原系统内核版本：<code>5.11.0-46-generic</code></li><li>内核源码版本：<code>5.11.1</code></li></ul><h3 id="修改任务">修改任务</h3><h4 id="普通任务">普通任务</h4><ul><li>写一个块设备驱动，可以动态加载和卸载该设备驱动，进行读写操作，使用模块编译方式。</li><li>向系统注册、注销块设备，可以通过程序或命令行使用该块设备。</li><li>使用内存分配的函数，设置块设备的最小容量为128MB ，可以把数据写入块设备，并读取出来。</li></ul><h4 id="进阶任务">进阶任务</h4><ul><li>重新编译Linux内核，将驱动以模块的形式编译入内核。</li></ul><h3 id="编写驱动">编写驱动</h3><ul><li>这里提供一段编写好的块设备驱动程序(<a href="https://github.com/CodeImp/sblkdev">代码来源</a> 在此致以感谢)</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/module.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/moduleparam.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/init.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/device.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/blk_types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/blkdev.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/blk-mq.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;uapi/linux/hdreg.h&gt;</span> <span class="hljs-comment">//for struct hd_geometry</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;uapi/linux/cdrom.h&gt;</span> <span class="hljs-comment">//for CDROM_GET_CAPABILITY</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SUCCESS</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SUCCESS 0</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-comment">//This defines are available in blkdev.h from kernel 4.17 (vanilla).</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SECTOR_SHIFT</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SECTOR_SHIFT 9</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SECTOR_SIZE</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SECTOR_SIZE (1 &lt;&lt; SECTOR_SHIFT)</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-comment">// constants - instead defines</span><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span>* _hwhdev_name = <span class="hljs-string">&quot;hwhdev&quot;</span>;<br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">size_t</span> _hwhdev_buffer_size = <span class="hljs-number">32</span> *<span class="hljs-number">1024</span> * PAGE_SIZE;<br><br><span class="hljs-comment">// types</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hwhdev_cmd_s</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-comment">//nothing</span><br>&#125; <span class="hljs-type">hwhdev_cmd_t</span>;<br><br><span class="hljs-comment">// The internal representation of our device</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hwhdev_device_s</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">sector_t</span> capacity;    <span class="hljs-comment">// Device size in bytes</span><br>    u8* data;    <span class="hljs-comment">// The data aray. u8 - 8 bytes</span><br>    <span class="hljs-type">atomic_t</span> open_counter;<span class="hljs-comment">// How many openers</span><br><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">blk_mq_tag_set</span> <span class="hljs-title">tag_set</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">request_queue</span> *<span class="hljs-title">queue</span>;</span><span class="hljs-comment">// For mutual exclusion</span><br><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">gendisk</span> *<span class="hljs-title">disk</span>;</span><span class="hljs-comment">// The gendisk structure</span><br>&#125; <span class="hljs-type">hwhdev_device_t</span>;<br><br><span class="hljs-comment">// global variables</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> _hwhdev_major = <span class="hljs-number">0</span>;<br><span class="hljs-type">static</span> <span class="hljs-type">hwhdev_device_t</span>* _hwhdev_device = <span class="hljs-literal">NULL</span>;<br><br><br><span class="hljs-comment">// functions</span><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hwhdev_allocate_buffer</span><span class="hljs-params">(<span class="hljs-type">hwhdev_device_t</span>* dev)</span><br>&#123;<br>    dev-&gt;capacity = _hwhdev_buffer_size &gt;&gt; SECTOR_SHIFT;<br>    <span class="hljs-comment">//dev-&gt;data = kmalloc(dev-&gt;capacity &lt;&lt; SECTOR_SHIFT, GFP_KERNEL); //</span><br>    dev-&gt;data = vmalloc(dev-&gt;capacity &lt;&lt; SECTOR_SHIFT);<br>    <span class="hljs-keyword">if</span> (dev-&gt;data == <span class="hljs-literal">NULL</span>) &#123;<br>        printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: vmalloc failure.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> -ENOMEM;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">hwhdev_free_buffer</span><span class="hljs-params">(<span class="hljs-type">hwhdev_device_t</span>* dev)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (dev-&gt;data) &#123;<br>        vfree(dev-&gt;data);<br><br>        dev-&gt;data = <span class="hljs-literal">NULL</span>;<br>        dev-&gt;capacity = <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">hwhdev_remove_device</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">hwhdev_device_t</span>* dev = _hwhdev_device;<br>    <span class="hljs-keyword">if</span> (dev == <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-keyword">return</span>;<br><br>    <span class="hljs-keyword">if</span> (dev-&gt;disk)<br>        del_gendisk(dev-&gt;disk);<br><br>    <span class="hljs-keyword">if</span> (dev-&gt;<span class="hljs-built_in">queue</span>) &#123;<br>        blk_cleanup_queue(dev-&gt;<span class="hljs-built_in">queue</span>);<br>        dev-&gt;<span class="hljs-built_in">queue</span> = <span class="hljs-literal">NULL</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (dev-&gt;tag_set.tags)<br>        blk_mq_free_tag_set(&amp;dev-&gt;tag_set);<br><br>    <span class="hljs-keyword">if</span> (dev-&gt;disk) &#123;<br>        put_disk(dev-&gt;disk);<br>        dev-&gt;disk = <span class="hljs-literal">NULL</span>;<br>    &#125;<br><br>    hwhdev_free_buffer(dev);<br><br>    vfree(dev);<br>    _hwhdev_device = <span class="hljs-literal">NULL</span>;<br><br>    printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: simple block device was removed\n&quot;</span>);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">do_simple_request</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> request *rq, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *nr_bytes)</span><br>&#123;<br>    <span class="hljs-type">int</span> ret = SUCCESS;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bio_vec</span> <span class="hljs-title">bvec</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">req_iterator</span> <span class="hljs-title">iter</span>;</span><br>    <span class="hljs-type">hwhdev_device_t</span> *dev = rq-&gt;q-&gt;queuedata;<br>    <span class="hljs-type">loff_t</span> pos = blk_rq_pos(rq) &lt;&lt; SECTOR_SHIFT;<br>    <span class="hljs-type">loff_t</span> dev_size = (<span class="hljs-type">loff_t</span>)(dev-&gt;capacity &lt;&lt; SECTOR_SHIFT);<br><br>    printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: request start from sector %lld \n&quot;</span>, blk_rq_pos(rq));<br><br>    rq_for_each_segment(bvec, rq, iter)<br>    &#123;<br>        <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> b_len = bvec.bv_len;<br><br>        <span class="hljs-type">void</span>* b_buf = page_address(bvec.bv_page) + bvec.bv_offset;<br><br>        <span class="hljs-keyword">if</span> ((pos + b_len) &gt; dev_size)<br>            b_len = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>)(dev_size - pos);<br><br>        <span class="hljs-keyword">if</span> (rq_data_dir(rq))<span class="hljs-comment">//WRITE</span><br>            <span class="hljs-built_in">memcpy</span>(dev-&gt;data + pos, b_buf, b_len);<br>        <span class="hljs-keyword">else</span><span class="hljs-comment">//READ</span><br>            <span class="hljs-built_in">memcpy</span>(b_buf, dev-&gt;data + pos, b_len);<br><br>        pos += b_len;<br>        *nr_bytes += b_len;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> ret;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">blk_status_t</span> _queue_rq(<span class="hljs-keyword">struct</span> blk_mq_hw_ctx *hctx, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> blk_mq_queue_data* bd)<br>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> nr_bytes = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">blk_status_t</span> status = BLK_STS_OK;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">request</span> *<span class="hljs-title">rq</span> =</span> bd-&gt;rq;<br><br>    <span class="hljs-comment">//we cannot use any locks that make the thread sleep</span><br>    blk_mq_start_request(rq);<br><br>    <span class="hljs-keyword">if</span> (do_simple_request(rq, &amp;nr_bytes) != SUCCESS)<br>        status = BLK_STS_IOERR;<br><br>    printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: request process %d bytes\n&quot;</span>, nr_bytes);<br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> 0 <span class="hljs-comment">//simply and can be called from proprietary module</span></span><br>    blk_mq_end_request(rq, status);<br><span class="hljs-meta">#<span class="hljs-keyword">else</span> <span class="hljs-comment">//can set real processed bytes count</span></span><br>    <span class="hljs-keyword">if</span> (blk_update_request(rq, status, nr_bytes)) <span class="hljs-comment">//GPL-only symbol</span><br>        BUG();<br>    __blk_mq_end_request(rq, status);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-keyword">return</span> BLK_STS_OK;<span class="hljs-comment">//always return ok</span><br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">blk_mq_ops</span> _<span class="hljs-title">mq_ops</span> =</span> &#123;<br>    .queue_rq = _queue_rq,<br>&#125;;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> _open(<span class="hljs-keyword">struct</span> block_device *bdev, <span class="hljs-type">fmode_t</span> mode)<br>&#123;<br>    <span class="hljs-type">hwhdev_device_t</span>* dev = bdev-&gt;bd_disk-&gt;private_data;<br>    <span class="hljs-keyword">if</span> (dev == <span class="hljs-literal">NULL</span>) &#123;<br>        printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: invalid disk private_data\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> -ENXIO;<br>    &#125;<br><br>    <span class="hljs-type">atomic_inc</span>(&amp;dev-&gt;open_counter);<br><br>    printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: device was opened\n&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<br><span class="hljs-type">static</span> <span class="hljs-type">void</span> _release(<span class="hljs-keyword">struct</span> gendisk *disk, <span class="hljs-type">fmode_t</span> mode)<br>&#123;<br>    <span class="hljs-type">hwhdev_device_t</span>* dev = disk-&gt;private_data;<br>    <span class="hljs-keyword">if</span> (dev) &#123;<br>        <span class="hljs-type">atomic_dec</span>(&amp;dev-&gt;open_counter);<br><br>        printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: device was closed\n&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>        printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: invalid disk private_data\n&quot;</span>);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> _getgeo(<span class="hljs-type">hwhdev_device_t</span>* dev, <span class="hljs-keyword">struct</span> hd_geometry* geo)<br>&#123;<br>    <span class="hljs-type">sector_t</span> quotient;<br><br>    geo-&gt;start = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (dev-&gt;capacity &gt; <span class="hljs-number">63</span>) &#123;<br><br>        geo-&gt;sectors = <span class="hljs-number">63</span>;<br>        quotient = (dev-&gt;capacity + (<span class="hljs-number">63</span> - <span class="hljs-number">1</span>)) / <span class="hljs-number">63</span>;<br><br>        <span class="hljs-keyword">if</span> (quotient &gt; <span class="hljs-number">255</span>) &#123;<br>            geo-&gt;heads = <span class="hljs-number">255</span>;<br>            geo-&gt;cylinders = (<span class="hljs-type">unsigned</span> <span class="hljs-type">short</span>)((quotient + (<span class="hljs-number">255</span> - <span class="hljs-number">1</span>)) / <span class="hljs-number">255</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            geo-&gt;heads = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>)quotient;<br>            geo-&gt;cylinders = <span class="hljs-number">1</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        geo-&gt;sectors = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>)dev-&gt;capacity;<br>        geo-&gt;cylinders = <span class="hljs-number">1</span>;<br>        geo-&gt;heads = <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> _ioctl(<span class="hljs-keyword">struct</span> block_device *bdev, <span class="hljs-type">fmode_t</span> mode, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cmd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg)<br>&#123;<br>    <span class="hljs-type">int</span> ret = -ENOTTY;<br>    <span class="hljs-type">hwhdev_device_t</span>* dev = bdev-&gt;bd_disk-&gt;private_data;<br><br>    printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: ioctl %x received\n&quot;</span>, cmd);<br><br>    <span class="hljs-keyword">switch</span> (cmd) &#123;<br>        <span class="hljs-keyword">case</span> HDIO_GETGEO:<br>        &#123;<br>            <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hd_geometry</span> <span class="hljs-title">geo</span>;</span><br><br>            ret = _getgeo(dev, &amp;geo );<br>            <span class="hljs-keyword">if</span> (copy_to_user((<span class="hljs-type">void</span> *)arg, &amp;geo, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> hd_geometry)))<br>                ret = -EFAULT;<br>            <span class="hljs-keyword">else</span><br>                ret = SUCCESS;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">case</span> CDROM_GET_CAPABILITY: <span class="hljs-comment">//0x5331  / * get capabilities * /</span><br>        &#123;<br>            <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">gendisk</span> *<span class="hljs-title">disk</span> =</span> bdev-&gt;bd_disk;<br><br>            <span class="hljs-keyword">if</span> (bdev-&gt;bd_disk &amp;&amp; (disk-&gt;flags &amp; GENHD_FL_CD))<br>                ret = SUCCESS;<br>            <span class="hljs-keyword">else</span><br>                ret = -EINVAL;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> ret;<br>&#125;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_COMPAT</span><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> _compat_ioctl(<span class="hljs-keyword">struct</span> block_device *bdev, <span class="hljs-type">fmode_t</span> mode, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cmd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg)<br>&#123;<br>    <span class="hljs-comment">// CONFIG_COMPAT is to allow running 32-bit userspace code on a 64-bit kernel</span><br>    <span class="hljs-keyword">return</span> -ENOTTY; <span class="hljs-comment">// not supported</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">block_device_operations</span> _<span class="hljs-title">fops</span> =</span> &#123;<br>    .owner = THIS_MODULE,<br>    .open = _open,<br>    .release = _release,<br>    .ioctl = _ioctl,<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_COMPAT</span><br>    .compat_ioctl = _compat_ioctl,<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;;<br><br><span class="hljs-comment">//添加设备</span><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hwhdev_add_device</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">int</span> ret = SUCCESS;<br><br>    <span class="hljs-type">hwhdev_device_t</span>* dev = kzalloc(<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">hwhdev_device_t</span>), GFP_KERNEL);<br>    <span class="hljs-keyword">if</span> (dev == <span class="hljs-literal">NULL</span>) &#123;<br>        printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: unable to allocate %ld bytes\n&quot;</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">hwhdev_device_t</span>));<br>        <span class="hljs-keyword">return</span> -ENOMEM;<br>    &#125;<br>    _hwhdev_device = dev;<br><br>    <span class="hljs-keyword">do</span>&#123;<br>        ret = hwhdev_allocate_buffer(dev);<br>        <span class="hljs-keyword">if</span>(ret)<br>            <span class="hljs-keyword">break</span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> 0 <span class="hljs-comment">//simply variant with helper function blk_mq_init_sq_queue. It`s available from kernel 4.20 (vanilla).</span></span><br>        &#123;<span class="hljs-comment">//configure tag_set</span><br>            <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">request_queue</span> *<span class="hljs-title">queue</span>;</span><br><br>            dev-&gt;tag_set.cmd_size = <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">hwhdev_cmd_t</span>);<br>            dev-&gt;tag_set.driver_data = dev;<br><br>            <span class="hljs-built_in">queue</span> = blk_mq_init_sq_queue(&amp;dev-&gt;tag_set, &amp;_mq_ops, <span class="hljs-number">128</span>, BLK_MQ_F_SHOULD_MERGE | BLK_MQ_F_SG_MERGE);<br>            <span class="hljs-keyword">if</span> (IS_ERR(<span class="hljs-built_in">queue</span>)) &#123;<br>                ret = PTR_ERR(<span class="hljs-built_in">queue</span>);<br>                printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: unable to allocate and initialize tag set\n&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            dev-&gt;<span class="hljs-built_in">queue</span> = <span class="hljs-built_in">queue</span>;<br>        &#125;<br><span class="hljs-meta">#<span class="hljs-keyword">else</span>   <span class="hljs-comment">// more flexible variant</span></span><br>        &#123;<span class="hljs-comment">//configure tag_set</span><br>            dev-&gt;tag_set.ops = &amp;_mq_ops;<br>            dev-&gt;tag_set.nr_hw_queues = <span class="hljs-number">1</span>;<br>            dev-&gt;tag_set.queue_depth = <span class="hljs-number">128</span>;<br>            dev-&gt;tag_set.numa_node = NUMA_NO_NODE;<br>            dev-&gt;tag_set.cmd_size = <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">hwhdev_cmd_t</span>);<br>            dev-&gt;tag_set.flags = BLK_MQ_F_SHOULD_MERGE ;<br>            dev-&gt;tag_set.driver_data = dev;<br><br>            ret = blk_mq_alloc_tag_set(&amp;dev-&gt;tag_set);<br>            <span class="hljs-keyword">if</span> (ret) &#123;<br>                printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: unable to allocate tag set\n&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br><br>        &#123;<span class="hljs-comment">//configure queue</span><br>            <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">request_queue</span> *<span class="hljs-title">queue</span> =</span> blk_mq_init_queue(&amp;dev-&gt;tag_set);<br>            <span class="hljs-keyword">if</span> (IS_ERR(<span class="hljs-built_in">queue</span>)) &#123;<br>                ret = PTR_ERR(<span class="hljs-built_in">queue</span>);<br>                printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: Failed to allocate queue\n&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            dev-&gt;<span class="hljs-built_in">queue</span> = <span class="hljs-built_in">queue</span>;<br>        &#125;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>        dev-&gt;<span class="hljs-built_in">queue</span>-&gt;queuedata = dev;<br><br>        &#123;<span class="hljs-comment">// configure disk</span><br>            <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">gendisk</span> *<span class="hljs-title">disk</span> =</span> alloc_disk(<span class="hljs-number">1</span>); <span class="hljs-comment">//only one partition</span><br>            <span class="hljs-keyword">if</span> (disk == <span class="hljs-literal">NULL</span>) &#123;<br>                printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: Failed to allocate disk\n&quot;</span>);<br>                ret = -ENOMEM;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br><br>            disk-&gt;flags |= GENHD_FL_NO_PART_SCAN; <span class="hljs-comment">//only one partition</span><br>            <span class="hljs-comment">//disk-&gt;flags |= GENHD_FL_EXT_DEVT;</span><br>            disk-&gt;flags |= GENHD_FL_REMOVABLE;<br><br>            disk-&gt;major = _hwhdev_major;<br>            disk-&gt;first_minor = <span class="hljs-number">0</span>;<br>            disk-&gt;fops = &amp;_fops;<br>            disk-&gt;private_data = dev;<br>            disk-&gt;<span class="hljs-built_in">queue</span> = dev-&gt;<span class="hljs-built_in">queue</span>;<br>            <span class="hljs-built_in">sprintf</span>(disk-&gt;disk_name, <span class="hljs-string">&quot;hwhdev%d&quot;</span>, <span class="hljs-number">0</span>);<br>            set_capacity(disk, dev-&gt;capacity);<br><br>            dev-&gt;disk = disk;<br>            add_disk(disk);<br>        &#125;<br><br>        printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: simple block device was created\n&quot;</span>);<br>    &#125;<span class="hljs-keyword">while</span>(<span class="hljs-literal">false</span>);<br><br>    <span class="hljs-keyword">if</span> (ret)&#123;<br>        hwhdev_remove_device();<br>        printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: Failed add block device\n&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> ret;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> __init <span class="hljs-title function_">hwhdev_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">int</span> ret = SUCCESS;<br><br>    _hwhdev_major = register_blkdev(_hwhdev_major, _hwhdev_name);<br>    <span class="hljs-keyword">if</span> (_hwhdev_major &lt;= <span class="hljs-number">0</span>)&#123;<br>        printk(KERN_WARNING <span class="hljs-string">&quot;hwhdev: unable to get major number\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> -EBUSY;<br>    &#125;<br><br>    ret = hwhdev_add_device();<br>    <span class="hljs-keyword">if</span> (ret)<br>        unregister_blkdev(_hwhdev_major, _hwhdev_name);<br><br>    <span class="hljs-keyword">return</span> ret;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> __exit <span class="hljs-title function_">hwhdev_exit</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    hwhdev_remove_device();<br><br>    <span class="hljs-keyword">if</span> (_hwhdev_major &gt; <span class="hljs-number">0</span>)<br>        unregister_blkdev(_hwhdev_major, _hwhdev_name);<br>&#125;<br><br>module_init(hwhdev_init);<br>module_exit(hwhdev_exit);<br><br>MODULE_LICENSE(<span class="hljs-string">&quot;GPL&quot;</span>);<br>MODULE_AUTHOR(<span class="hljs-string">&quot;Code Imp&quot;</span>);<br></code></pre></td></tr></table></figure><ul><li>修改 <code>_sblkdev_buffer_size</code> 设置块设备的大小</li></ul><h3 id="编写-makefile">编写 Makefile</h3><ul><li>这里提供一段自行编写的 Makefile</li></ul><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Makefile"><span class="hljs-keyword">ifneq</span> (<span class="hljs-variable">$(KERNELRELEASE)</span>,)<br>obj-m := hwhdev.o<br><br><span class="hljs-keyword">else</span><br>PWD := <span class="hljs-variable">$(<span class="hljs-built_in">shell</span> pwd)</span> <span class="hljs-comment">#当前文件夹目录</span><br>KDIR := /usr/src/linux-5.11.1/ <span class="hljs-comment">#内核源码目录</span><br><span class="hljs-section">all:</span><br><span class="hljs-variable">$(MAKE)</span> -C <span class="hljs-variable">$(KDIR)</span> M=<span class="hljs-variable">$(PWD)</span> modules<br><span class="hljs-section">clean:</span><br>rm -rf .*.cmd *.o *.mod.c *.ko .tmp_versions<br><span class="hljs-keyword">endif</span><br></code></pre></td></tr></table></figure><h3 id="编译驱动模块">编译驱动模块</h3><ul><li>由于 <strong>Makefile</strong> 中提供了 <strong>all</strong> 指令，可以直接执行 <code>sudo make all</code>，进行编译</li><li>这里 <code>sudo make all</code> 等价于执行了 <code>sudo make -C /usr/src/linux-5.11.1 M=$PWD</code></li></ul><h3 id="安装驱动模块">安装驱动模块</h3><ul><li>安装模块</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo insmod hwhdev.ko<br></code></pre></td></tr></table></figure><ul><li>查看已安装模块</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">lsmod<br></code></pre></td></tr></table></figure><p>效果如下： <img src="https://img-blog.csdnimg.cn/10852c61d83e45dba4d27619ec94a55e.png" /></p><h3 id="挂载设备">挂载设备</h3><ul><li>格式化磁盘</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo mkdosfs /dev/hwhdev0<br></code></pre></td></tr></table></figure><p>注：其中 <code>hwhdev0</code> 是设备名，可以使用 <code>lsblk</code> 命令查看</p><ul><li>挂载设备到 <code>/mnt</code></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo <span class="hljs-built_in">mount</span> /dev/hwhdev0 /mnt<br></code></pre></td></tr></table></figure><p>效果如下： <img src="https://img-blog.csdnimg.cn/753a62aa3e2648899da9fedcc7e56a12.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>卸载设备</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo umount /mnt<br></code></pre></td></tr></table></figure><p>效果如下： <img src="https://img-blog.csdnimg.cn/9a636cdf391a499c94d72b512cf603c2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h3 id="进阶任务-1">进阶任务</h3><ul><li>将驱动以模块的形式编译入内核</li><li>所需修改的文件(从源码目录开始)如下</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Kconfig">drivers/Kconfig<br>drivers/Makefile<br><br>drivers/hwhdev/Kconfig #需要新建<br>drivers/hwhdev/Makefile<br></code></pre></td></tr></table></figure><h4 id="修改-drivershwhdevkconfig">修改 drivers/hwhdev/Kconfig</h4><ul><li>新建 <strong>Kconfig</strong> 并添加如下内容</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Kconfig">config HWH_DEV<br>tristate &quot;HWH_DEV driver support&quot;<br></code></pre></td></tr></table></figure><p>效果如下： <img src="https://img-blog.csdnimg.cn/e1e86b21bf194ac4b489f46f07c6e412.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h4 id="修改-drivershwhdevmakefile">修改 drivers/hwhdev/Makefile</h4><ul><li>对应添加一行 <code>obj-</code></li></ul><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Makefile">obj-<span class="hljs-variable">$(CONFIG_HWH_DEV)</span>+= hwhdev.o<br></code></pre></td></tr></table></figure><p>效果如下：</p><p><img src="https://img-blog.csdnimg.cn/02080c38e0f34b38a0f5fa6edc364248.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h4 id="修改-deviceskconfig">修改 devices/Kconfig</h4><ul><li>在 <code>endmenu</code> 上面对应添加一行 <code>source</code> 效果如下：</li></ul><p><img src="https://img-blog.csdnimg.cn/b787415d31974d3db4e4ee84144c2c16.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h4 id="修改-devicesmakefile">修改 devices/Makefile</h4><ul><li>在最后一行对应添加一行 <code>obj-</code></li></ul><p><img src="https://img-blog.csdnimg.cn/dfa08663b99f48ffb2dae850684a51d2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h4 id="编译安装">编译安装</h4><ul><li>修改配置</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo make gconfig<br></code></pre></td></tr></table></figure><ul><li>在 <code>Device drivers</code> 下找到 <code>HWH_DEV</code> 设置为<strong>模块编译</strong>(若想要<strong>永久安装模块</strong>可以设为<strong>内核编译</strong>)，如下图</li></ul><p><img src="https://img-blog.csdnimg.cn/7b29b8c7e1b14c2e868ab3e1137e3bd4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>保存配置</li><li>编译安装内核，重启</li><li>使用 <code>modprobe hwhdev</code> 安装模块</li></ul>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>操作系统</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【linux系列】实现基于模块的文件系统</title>
    <link href="/2022/12/10/%E3%80%90linux%E7%B3%BB%E5%88%97%E3%80%91%E5%AE%9E%E7%8E%B0%E5%9F%BA%E4%BA%8E%E6%A8%A1%E5%9D%97%E7%9A%84%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"/>
    <url>/2022/12/10/%E3%80%90linux%E7%B3%BB%E5%88%97%E3%80%91%E5%AE%9E%E7%8E%B0%E5%9F%BA%E4%BA%8E%E6%A8%A1%E5%9D%97%E7%9A%84%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/</url>
    
    <content type="html"><![CDATA[<h3 id="编译环境">编译环境</h3><ul><li>虚拟机操作系统： <code>ubuntu-20.04.3-desktop-amd64</code></li><li>原系统内核版本：<code>5.11.0-46-generic</code></li><li>内核源码版本：<code>5.11.1</code></li></ul><h3 id="修改任务">修改任务</h3><h4 id="基础任务">基础任务</h4><ul><li>修改XFS文件系统的源代码，实现新的文件系统。</li><li>至少需要修改文件系统的名称。</li><li>可以动态加载和卸载新的文件系统。</li><li>列出操作系统中包含的文件系统列表，其中要有自己改名后的文件系统。</li></ul><h4 id="进阶任务">进阶任务</h4><ul><li>重新编译Linux内核，以模块编译方式，将文件系统编入内核。 ### 修改准备</li><li><a href="https://cdn.kernel.org/pub/linux/kernel/">下载内核源码</a></li><li>进入到 <strong>fs</strong> 文件夹下，复制 <strong>xfs</strong> 源码，以防修改错误导致无法恢复</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo <span class="hljs-built_in">cp</span> <span class="hljs-literal">-r</span> xfs hwhxfs<br></code></pre></td></tr></table></figure><ul><li>如下图所示</li></ul><p><img src="https://img-blog.csdnimg.cn/9cd52b588d764949982a61e2cc3b4dc8.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h3 id="修改源码">修改源码</h3><ul><li>所需修改的文件，均在 <strong>hwhxfs</strong> 文件夹下</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">Makefile<br><br>xfs_super.c<br><br>xfs_sysctl.c<br></code></pre></td></tr></table></figure><h4 id="修改-makefile">修改 Makefile</h4><ul><li>使用 <strong>gedit</strong> 打开 <strong>Makefile</strong></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo gedit Makefile<br></code></pre></td></tr></table></figure><ul><li>修改 <code>ccflags-y</code></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 修改后</span><br>ccflags<span class="hljs-literal">-y</span> += <span class="hljs-literal">-I</span> <span class="hljs-variable">$</span>(src)<span class="hljs-comment"># needed for trace events</span><br>ccflags<span class="hljs-literal">-y</span> += <span class="hljs-literal">-I</span> <span class="hljs-variable">$</span>(src)/libxfs<br></code></pre></td></tr></table></figure><ul><li>修改 <code>obj-$(CONFIG_XFS_FS)</code></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 修改后</span><br>obj-<span class="hljs-variable">$</span>(CONFIG_XFS_FS)+= hwhxfs.o<br></code></pre></td></tr></table></figure><ul><li>修改左侧所有 <strong>xfs</strong> 为自己的名称，这里均修改为 <strong>hwhxfs</strong></li></ul><p><img src="https://img-blog.csdnimg.cn/e06721e0dab64188a7e4ea80d84a15d9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h4 id="修改-xfs_super.c">修改 xfs_super.c</h4><ul><li>使用 <strong>gedit</strong> 打开 <strong>xfs_super.c</strong></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo gedit xfs_super.c<br></code></pre></td></tr></table></figure><ul><li>搜索 <code>"xfs"</code></li></ul><p><img src="https://img-blog.csdnimg.cn/66f7dc6bee604c82bf04884f288d0d46.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>将这两个对应修改为自己的名字，这里修改为 <strong>hwhxfs</strong>，如下图</li></ul><p><img src="https://img-blog.csdnimg.cn/52a4913edb734d8189cc8fd407c33847.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h4 id="修改-xfs_sysctl.c">修改 xfs_sysctl.c</h4><ul><li>使用 <strong>gedit</strong> 打开 <strong>xfs_sysctl.c</strong></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo gedit xfs_sysctl.c<br></code></pre></td></tr></table></figure><ul><li>搜索 <code>"xfs"</code></li></ul><p><img src="https://img-blog.csdnimg.cn/2cf639677438443991a8c4b68ddee214.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>将其对应修改为自己的名字，这里修改为 <strong>hwhxfs</strong>，如下图</li></ul><p><img src="https://img-blog.csdnimg.cn/a4a25988647c492e829d9ae351125050.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h3 id="编译模块">编译模块</h3><ul><li>确保在 <strong>hwhxfs</strong> 目录下</li><li>执行编译命令</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo make <span class="hljs-literal">-C</span> /usr/src/linux<span class="hljs-literal">-5</span>.<span class="hljs-number">11.1</span>/ M=<span class="hljs-variable">$PWD</span><br></code></pre></td></tr></table></figure><ul><li>编译成功后会在 <strong>hwhxfs</strong> 目录下生成 <strong>hwhxfs.ko</strong> 文件</li></ul><p><img src="https://img-blog.csdnimg.cn/f06bb8b43ff7488a96adf853e9411234.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h3 id="安装模块">安装模块</h3><ul><li>添加依赖</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo modprobe libcrc32c<br></code></pre></td></tr></table></figure><p>注：一般会缺少此依赖，并在安装模块时报告如下错误</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">insmod: ERROR: could not insert module hwhxfs.ko: Unknown symbol <span class="hljs-keyword">in</span> module<br></code></pre></td></tr></table></figure><p>可以使用 <code>modinfo  ./hwhxfs.ko | grep depend</code> 命令查看需要加载的依赖</p><hr /><ul><li>安装模块</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo insmod hwhxfs.ko<br></code></pre></td></tr></table></figure><ul><li>查看已安装模块</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">lsmod<br></code></pre></td></tr></table></figure><p>效果如下： <img src="https://img-blog.csdnimg.cn/339e67de5fac49f9addafd9264e17e60.png" /></p><hr /><h3 id="挂载文件系统">挂载文件系统</h3><ul><li>为什么要进行挂载呢？<ul><li>每个文件系统都有独立的inode、区块、超级区块等信息，这个文件系统要能够链接到目录树才能被我们使用。而将文件系统与目录树结合的操作称之为挂载。</li></ul></li><li>挂载文件系统的命令</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">mount</span> <span class="hljs-literal">-t</span> 文件系统 设备文件名 挂载点<br></code></pre></td></tr></table></figure><ul><li>文件系统：这里已经准备好了 <strong>hwhxfs</strong> 文件系统</li><li>挂载点：一个目录，是文件系统的入口，我们可以在 <code>/mnt</code> 下新建个目录作为挂载点</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo mkdir /mnt/xfs<br></code></pre></td></tr></table></figure><ul><li>设备文件名：设备文件，我们需要对磁盘进行分区以分配给文件系统一个存储设备</li><li>查看磁盘信息</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo parted /dev/sda print<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/12c6b8dc02a44d17a71fb2d1e352fa65.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>分区表格式有两种，即MBR（msdos）和GPT，MBR使用 <code>fdisk</code> 分区，GPT使用 <code>gdisk</code> 进行分区。</li><li>这里使用 <code>fdisk</code> 进行分区</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo fdisk /dev/sda<br></code></pre></td></tr></table></figure><ul><li>按 <code>n</code> 新建分区</li><li>若出现 <strong>无空闲扇区可用</strong> 表明当前磁盘空间不足无法进行分区</li></ul><p><img src="https://img-blog.csdnimg.cn/8534677c0a884bea9dc9d51952a7094c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>此时如果是虚拟机，可以通过添加磁盘来解决</li><li>关机打开虚拟机设置，添加磁盘</li></ul><p><img src="https://img-blog.csdnimg.cn/f28a1c4361524a6ab873dc91e77e2800.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>一律下一步，分配磁盘空间时分配 <strong>1G</strong> 即可，更多也可以</li></ul><p><img src="https://img-blog.csdnimg.cn/8a7099861f4a4217a9bd8680b636c474.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>添加新磁盘完成后，重启虚拟机</li><li>查看新增磁盘的名字</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">lsblk <span class="hljs-literal">-l</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/ad1660d6b39b4078819de7a4a7d48fee.png" /></p><ul><li>用 <code>fdisk</code> 对新增磁盘进行分区（建议先输入 m 获取 fdisk 使用帮助）</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo fdisk /dev/sdb<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/61a6cdfc91ee455f8ae6ef8a98a7c4e0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>安装 <strong>xfsprogs</strong></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo apt install xfsprogs<br></code></pre></td></tr></table></figure><ul><li>格式化分区，将分区格式化为 <strong>xfs</strong> 类型</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo mkfs.xfs /dev/sdb4<br></code></pre></td></tr></table></figure><ul><li>挂载文件系统</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo <span class="hljs-built_in">mount</span> <span class="hljs-literal">-t</span> hwhxfs /dev/sdb4 /mnt/xfs<br></code></pre></td></tr></table></figure><ul><li>使用 <code>df -h</code> 命令查看</li></ul><p><img src="https://img-blog.csdnimg.cn/c5e54d8f636a4fa3951c2b464cfeb373.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>卸载文件系统</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo umount /mnt/xfs<br></code></pre></td></tr></table></figure><h3 id="进阶任务-1">进阶任务</h3><ul><li>将文件系统以模块的形式编入内核</li><li>所需修改的文件如下</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">fs/Kconfig<br>fs/Makefile<br><br>fs/hwhxfs/Kconfig<br>fs/hwhxfs/Makefile<br></code></pre></td></tr></table></figure><h4 id="修改-fshwhxfskconfig">修改 fs/hwhxfs/Kconfig</h4><ul><li>将 <strong>Kconfig</strong> 中所有 <code>XFS</code> 替换为 <code>HWHXFS</code></li></ul><p><img src="https://img-blog.csdnimg.cn/b977abb6eab540ca939538c84b42d3a8.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h4 id="修改-fshwhxfsmakefile">修改 fs/hwhxfs/Makefile</h4><ul><li>将 Makefile 中所有 <code>XFS</code> 替换为 <code>HWHXFS</code></li></ul><p><img src="https://img-blog.csdnimg.cn/70b6920910784279b4b2413cf8654e30.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h4 id="修改-fskconfig">修改 fs/Kconfig</h4><ul><li>在 <strong>Kconfig</strong> 中搜索 <code>xfs</code>，对应添加一行 <code>source</code></li></ul><p><img src="https://img-blog.csdnimg.cn/0167fac1c7de42f89e11d1c98ba51c98.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h4 id="修改-fsmakefile">修改 fs/Makefile</h4><ul><li>在 <strong>Makefile</strong> 中搜索 <code>xfs</code>，对应添加一行 <code>obj-</code></li></ul><p><img src="https://img-blog.csdnimg.cn/1ebe5b92f122429ab35233b583687afc.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><hr /><h4 id="编译安装">编译安装</h4><ul><li>修改配置</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo make gconfig<br></code></pre></td></tr></table></figure><ul><li>在 <code>File systems</code> 下找到 <code>HWHXFS</code> 设置为模块编译，如下图</li></ul><p><img src="https://img-blog.csdnimg.cn/99e5537c91c54499960416b0f000790d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>保存配置</li><li>编译安装内核，重启</li><li>使用 <code>modprobe hwhxfs</code> 安装模块</li><li>内核编译相关问题可以参考我之前的文章，<a href="https://blog.csdn.net/h2763246823/article/details/122522326">【linux系列】内核编译最新教程+常见问题总结</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>操作系统</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【Linux系列】添加系统调用</title>
    <link href="/2022/12/03/%E3%80%90Linux%E7%B3%BB%E5%88%97%E3%80%91%E6%B7%BB%E5%8A%A0%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/"/>
    <url>/2022/12/03/%E3%80%90Linux%E7%B3%BB%E5%88%97%E3%80%91%E6%B7%BB%E5%8A%A0%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="编译环境">编译环境</h3><ul><li>虚拟机操作系统： <code>ubuntu-20.04.3-desktop-amd64</code></li><li>原系统内核版本：<code>5.11.0-46-generic</code></li><li>内核源码版本：<code>5.11.1</code></li></ul><h3 id="修改任务">修改任务</h3><h4 id="基础任务">基础任务</h4><ul><li>采用内核编译法增加两个系统调用</li><li>一个系统调用把用户输入的字符串保存到 <strong>text.txt</strong> 中</li><li>一个系统调用把 <strong>text.txt</strong> 中的字符串读出</li><li>写个主程序调用两个系统调用</li></ul><h4 id="进阶任务">进阶任务</h4><ul><li>用户可以指定用户输入字符串保存的位置和文件名</li><li>程序可以将系统调用读取出的字符串打印到用户终端</li></ul><h3 id="修改准备">修改准备</h3><ul><li><a href="https://cdn.kernel.org/pub/linux/kernel/">下载内核源码</a></li><li><a href="https://blog.csdn.net/h2763246823/article/details/122522326">掌握内核编译</a></li></ul><h3 id="修改源码">修改源码</h3><ul><li>所需修改的文件(路径默认从源码目录开始)如下：</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">arch/x86/entry/syscalls/syscall_64.tbl      //设置系统调用号，如果是<span class="hljs-number">32</span>位就用syscall_32.tbl<br><br>include/linux/syscalls.h                     //系统调用的头文件<br><br>kernel/sys.c                                 //定义系统调用函数<br></code></pre></td></tr></table></figure><h4 id="添加系统调用号">添加系统调用号</h4><ul><li>使用 <strong>gedit</strong> 打开 <strong>syscall_64.tbl</strong> 文件</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo gedit arch/x86/entry/syscalls/syscall_64.tbl<br></code></pre></td></tr></table></figure><ul><li>根据规则在后面添加自己的系统调用号和系统调用名，如下图所示</li></ul><p><img src="https://img-blog.csdnimg.cn/72bc1b5f98ea4fd48bbc83bdb75c0337.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>这里我添加了两个系统调用分别是读和写</li></ul><h4 id="修改系统调用头文件">修改系统调用头文件</h4><ul><li>使用 <strong>gedit</strong> 打开 <strong>syscalls.h</strong> 文件</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo gedit include/linux/syscalls.h<br></code></pre></td></tr></table></figure><ul><li>添加对应系统调用的函数声明，如下图</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">asmlinkage <span class="hljs-type">long</span> <span class="hljs-title function_">sys_fwrite</span><span class="hljs-params">(<span class="hljs-type">int</span> strcount,<span class="hljs-type">char</span> __user* <span class="hljs-built_in">string</span>)</span>;<br>asmlinkage <span class="hljs-type">long</span> <span class="hljs-title function_">sys_fread</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/22717168a74447a0a676db3750107a98.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h4 id="修改系统调用函数定义">修改系统调用函数定义</h4><ul><li>使用 <strong>gedit</strong> 打开 <strong>sys.c</strong> 文件</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo gedit kernel/sys.c<br></code></pre></td></tr></table></figure><ul><li>添加对应系统调用的函数定义，内容如下：</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//写文件系统调用</span><br>SYSCALL_DEFINE2(fwrite,<span class="hljs-type">int</span>,strcount,<span class="hljs-type">char</span> __user *,<span class="hljs-built_in">string</span>)<br>&#123;<br>        printk(<span class="hljs-string">&quot;fwrite executing&quot;</span>);<br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">filp</span>;</span><br>        <span class="hljs-type">char</span>* filename=<span class="hljs-string">&quot;/usr/src/text.txt\0&quot;</span>;<br><br><br>        printk(<span class="hljs-string">&quot;open file&quot;</span>);<br><br>        filp = filp_open(filename, O_RDWR|O_TRUNC, <span class="hljs-number">0755</span>);<br>        <span class="hljs-keyword">if</span>(IS_ERR(filp))<br>        &#123;<br>                printk(<span class="hljs-string">&quot;open error...\n&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>        &#125;<br><br>        printk(<span class="hljs-string">&quot;writing\n&quot;</span>);<br>        <span class="hljs-type">char</span>* buf;<br>        buf = (<span class="hljs-type">char</span> *)kmalloc(<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">char</span>) * strcount, GFP_KERNEL);<br>        <span class="hljs-keyword">if</span>(!copy_from_user(buf, <span class="hljs-built_in">string</span>, strcount))<br>        &#123;<br>                printk(<span class="hljs-string">&quot;input is %s \n&quot;</span>, buf);<br>        &#125;<br><br>        kernel_write(filp, buf, <span class="hljs-built_in">strlen</span>(buf),&amp;filp-&gt;f_pos);<br><br>        filp_close(filp,<span class="hljs-literal">NULL</span>);<br>        printk(<span class="hljs-string">&quot;fwrite end\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 读文件系统调用</span><br>SYSCALL_DEFINE0(fread)<br>&#123;<br>        printk(<span class="hljs-string">&quot;fread executing&quot;</span>);<br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">filp</span>;</span><br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">inode</span>;</span><br>        <span class="hljs-type">const</span> <span class="hljs-type">char</span>* filename=<span class="hljs-string">&quot;/usr/src/text.txt\0&quot;</span>;<br>        <span class="hljs-type">off_t</span> fsize;<br>        <span class="hljs-type">char</span> *buf;<br>        <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> magic;<br><br><br>        printk(<span class="hljs-string">&quot;start....\n&quot;</span>);<br>        filp=filp_open(filename,O_RDONLY,<span class="hljs-number">0</span>);<br>        inode=file_inode(filp);<br><br>        magic=inode-&gt;i_sb-&gt;s_magic;<br><br>        printk(<span class="hljs-string">&quot;file system magic:%li \n&quot;</span>,magic);<br>        printk(<span class="hljs-string">&quot;super blocksize:%li \n&quot;</span>,inode-&gt;i_sb-&gt;s_blocksize);<br>        printk(<span class="hljs-string">&quot;inode %li \n&quot;</span>,inode-&gt;i_ino);<br><br>        fsize=inode-&gt;i_size;<br>        printk(<span class="hljs-string">&quot;file size:%i \n&quot;</span>,(<span class="hljs-type">int</span>)fsize);<br>        buf=(<span class="hljs-type">char</span> *) kmalloc(fsize+<span class="hljs-number">1</span>,GFP_ATOMIC);<br>        printk(<span class="hljs-string">&quot;buf correct\n&quot;</span>);<br><br><br>        kernel_read(filp,buf,fsize,&amp;(filp-&gt;f_pos));<br>        buf[fsize]=<span class="hljs-string">&#x27;\0&#x27;</span>;<br>        printk(<span class="hljs-string">&quot;The File Content is:\n&quot;</span>);<br>        printk(<span class="hljs-string">&quot;%s\n&quot;</span>,buf);<br><br><br>        filp_close(filp,<span class="hljs-literal">NULL</span>);<br>        printk(<span class="hljs-string">&quot;fread end\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>将两个函数定义写在 sys.c 文件的尾部</li></ul><p><img src="https://img-blog.csdnimg.cn/0423b3747a8b4b88964c631c5a901277.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>其中 <strong>SYSCALL_DEFINE</strong> 为系统定义，之后的数字代表系统调用参数的个数，其中第一个参数为系统调用函数的名称，需要与调用号定义(调用号定义第三个参)，声明(sys_xxx中xxx部分)一致。</li><li>注意系统调用定义时的参数书写格式。</li></ul><h3 id="编译安装内核">编译安装内核</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">#编译内核</span><br>sudo make <span class="hljs-literal">-j4</span><br><br><span class="hljs-comment">#安装内核模块</span><br>sudo make modules_install<br><br><span class="hljs-comment">#安装内核</span><br>sudo make install<br><br><span class="hljs-comment">#重启</span><br>reboot<br></code></pre></td></tr></table></figure><h3 id="编写主程序">编写主程序</h3><ul><li>在指定目录下新建文件 <strong>text.txt</strong></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">sudo touch /usr/src/text.txt<br></code></pre></td></tr></table></figure><ul><li>新建 <strong>readAndWrite.c</strong> 文件，内容如下</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;sys/syscall.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;linux/kernel.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">long</span> <span class="hljs-type">int</span> a;<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;this is testwr execution\n&quot;</span>);<br><br><br><span class="hljs-type">char</span> <span class="hljs-built_in">string</span>[<span class="hljs-number">120</span>];<br><span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>,<span class="hljs-built_in">string</span>);<br><span class="hljs-type">int</span> length=<span class="hljs-built_in">strlen</span>(<span class="hljs-built_in">string</span>)+<span class="hljs-number">1</span>;<br><br><br>a = syscall(<span class="hljs-number">442</span>,length,<span class="hljs-built_in">string</span>);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;a=%li\n&quot;</span>,a);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;testwr end\n&quot;</span>);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;this is testwr execution\n&quot;</span>);<br><br> a = syscall(<span class="hljs-number">443</span>);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;a=%li\n&quot;</span>,a);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;testwr end\n&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>编译</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">gcc readAndWrite.c -o readAndWrite.o<br></code></pre></td></tr></table></figure><ul><li>执行</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">sudo ./readAndWrite.o<br></code></pre></td></tr></table></figure><ul><li><p>执行结果，如下图 <img src="https://img-blog.csdnimg.cn/2d41e6988023425c867d67bd83cc9ab9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /><img src="https://img-blog.csdnimg.cn/13035f98526d4d9996e37ee96c83becf.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p></li><li><p>至此基础任务完成，接下来完成进阶任务</p></li></ul><h3 id="进阶任务-1">进阶任务</h3><ul><li><p>重新添加新的系统调用</p></li><li><p>添加系统调用号 <img src="https://img-blog.csdnimg.cn/4456233062114297ad8ee0e38ec9c4b8.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p></li><li><p>添加系统调用函数声明 <img src="https://img-blog.csdnimg.cn/1a4e3b42ae964cc89ad19590a8f4caaf.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">asmlinkage <span class="hljs-type">long</span> <span class="hljs-title function_">sys_fsize</span><span class="hljs-params">(<span class="hljs-type">int</span> pathcount,<span class="hljs-type">char</span> __user * path)</span>;<br>asmlinkage <span class="hljs-type">long</span> <span class="hljs-title function_">sys_fwrite_advance</span><span class="hljs-params">(<span class="hljs-type">int</span> strcount,<span class="hljs-type">char</span> __user * <span class="hljs-built_in">string</span>,<span class="hljs-type">int</span> pathcount,<span class="hljs-type">char</span> __user * path)</span>;<br>asmlinkage <span class="hljs-type">long</span> <span class="hljs-title function_">sys_fread_advance</span><span class="hljs-params">(<span class="hljs-type">char</span> __user * res,<span class="hljs-type">int</span> pathcount,<span class="hljs-type">char</span> __user * path)</span>;<br></code></pre></td></tr></table></figure><ul><li>添加系统调用函数定义</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//获取文件大小系统调用</span><br>SYSCALL_DEFINE2(fsize,<span class="hljs-type">int</span>,pathcount,<span class="hljs-type">char</span> __user *,path)<br>&#123;<br>        printk(<span class="hljs-string">&quot;fsize executing&quot;</span>);<br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">filp</span>;</span><br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">inode</span>;</span><br><br>        <span class="hljs-type">off_t</span> fsize;<br>        <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> magic;<br><br>        <span class="hljs-type">char</span>* pathbuf;<br>        pathbuf = (<span class="hljs-type">char</span> *)kmalloc(<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">char</span>) * pathcount, GFP_KERNEL);<br>        <span class="hljs-keyword">if</span>(!copy_from_user(pathbuf, path, pathcount))<br>        &#123;<br>                printk(<span class="hljs-string">&quot;input path is %s \n&quot;</span>, pathbuf);<br>        &#125;<br><br>        printk(<span class="hljs-string">&quot;start....\n&quot;</span>);<br>        filp=filp_open(pathbuf,O_RDONLY,<span class="hljs-number">0</span>);<br>        inode=file_inode(filp);<br><br>        magic=inode-&gt;i_sb-&gt;s_magic;<br><br>        printk(<span class="hljs-string">&quot;file system magic:%li \n&quot;</span>,magic);<br>        printk(<span class="hljs-string">&quot;super blocksize:%li \n&quot;</span>,inode-&gt;i_sb-&gt;s_blocksize);<br>        printk(<span class="hljs-string">&quot;inode %li \n&quot;</span>,inode-&gt;i_ino);<br><br>        fsize=inode-&gt;i_size;<br>        printk(<span class="hljs-string">&quot;file size:%i \n&quot;</span>,(<span class="hljs-type">int</span>)fsize);<br><br>        filp_close(filp,<span class="hljs-literal">NULL</span>);<br>        printk(<span class="hljs-string">&quot;fsize end\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> fsize+<span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//写文件系统调用</span><br>SYSCALL_DEFINE4(fwrite_advance,<span class="hljs-type">int</span>,strcount,<span class="hljs-type">char</span> __user *,<span class="hljs-built_in">string</span>,<span class="hljs-type">int</span>,pathcount,<span class="hljs-type">char</span> __user *,path)<br>&#123;<br>        printk(<span class="hljs-string">&quot;fwrite_advance executing&quot;</span>);<br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">filp</span>;</span><br><br><br>        <span class="hljs-type">char</span>* pathbuf;<br>        pathbuf = (<span class="hljs-type">char</span> *)kmalloc(<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">char</span>) * pathcount, GFP_KERNEL);<br>        <span class="hljs-keyword">if</span>(!copy_from_user(pathbuf, path, pathcount))<br>        &#123;<br>                printk(<span class="hljs-string">&quot;input path is %s \n&quot;</span>, pathbuf);<br>        &#125;<br><br>        printk(<span class="hljs-string">&quot;%s&quot;</span>,pathbuf);<br>        printk(<span class="hljs-string">&quot;open file&quot;</span>);<br><br>        filp = filp_open(pathbuf, O_RDWR|O_TRUNC, <span class="hljs-number">0755</span>);<br>        <span class="hljs-keyword">if</span>(IS_ERR(filp))<br>        &#123;<br>                printk(<span class="hljs-string">&quot;open error...\n&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>        &#125;<br><br>        printk(<span class="hljs-string">&quot;writing\n&quot;</span>);<br>        <span class="hljs-type">char</span>* buf;<br>        buf = (<span class="hljs-type">char</span> *)kmalloc(<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">char</span>) * strcount, GFP_KERNEL);<br>        <span class="hljs-keyword">if</span>(!copy_from_user(buf, <span class="hljs-built_in">string</span>, strcount))<br>        &#123;<br>                printk(<span class="hljs-string">&quot;input is %s \n&quot;</span>, buf);<br>        &#125;<br><br>        kernel_write(filp, buf, <span class="hljs-built_in">strlen</span>(buf),&amp;filp-&gt;f_pos);<br>        filp_close(filp,<span class="hljs-literal">NULL</span>);<br>        printk(<span class="hljs-string">&quot;fwrite_advance end\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//读文件系统调用</span><br>SYSCALL_DEFINE3(fread_advance,<span class="hljs-type">char</span> __user *,res,<span class="hljs-type">int</span>,pathcount,<span class="hljs-type">char</span> __user *,path)<br>&#123;<br>        printk(<span class="hljs-string">&quot;fread_advance executing&quot;</span>);<br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">filp</span>;</span><br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">inode</span>;</span><br><br>        <span class="hljs-type">off_t</span> fsize;<br>        <span class="hljs-type">char</span> *buf;<br>        <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> magic;<br><br>        <span class="hljs-type">char</span>* pathbuf;<br>        pathbuf = (<span class="hljs-type">char</span> *)kmalloc(<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">char</span>) * pathcount, GFP_KERNEL);<br>        <span class="hljs-keyword">if</span>(!copy_from_user(pathbuf, path, pathcount))<br>        &#123;<br>                printk(<span class="hljs-string">&quot;input path is %s \n&quot;</span>, pathbuf);<br>        &#125;<br><br>        printk(<span class="hljs-string">&quot;start....\n&quot;</span>);<br>        filp=filp_open(pathbuf,O_RDONLY,<span class="hljs-number">0</span>);<br>        inode=file_inode(filp);<br><br>        magic=inode-&gt;i_sb-&gt;s_magic;<br><br>        printk(<span class="hljs-string">&quot;file system magic:%li \n&quot;</span>,magic);<br>        printk(<span class="hljs-string">&quot;super blocksize:%li \n&quot;</span>,inode-&gt;i_sb-&gt;s_blocksize);<br>        printk(<span class="hljs-string">&quot;inode %li \n&quot;</span>,inode-&gt;i_ino);<br><br>        fsize=inode-&gt;i_size;<br>        printk(<span class="hljs-string">&quot;file size:%i \n&quot;</span>,(<span class="hljs-type">int</span>)fsize);<br>        buf=(<span class="hljs-type">char</span> *) kmalloc(fsize+<span class="hljs-number">1</span>,GFP_ATOMIC);<br>        printk(<span class="hljs-string">&quot;buf correct\n&quot;</span>);<br><br><br><br><br>        kernel_read(filp,buf,fsize,&amp;(filp-&gt;f_pos));<br>        buf[fsize]=<span class="hljs-string">&#x27;\0&#x27;</span>;<br>        printk(<span class="hljs-string">&quot;The File Content is:\n&quot;</span>);<br>        printk(<span class="hljs-string">&quot;%s\n&quot;</span>,buf);<br><br><span class="hljs-keyword">if</span>(!copy_to_user(res, buf, fsize+<span class="hljs-number">1</span>))<br>        &#123;<br>                printk(<span class="hljs-string">&quot;output success&quot;</span>);<br>        &#125;<br>        filp_close(filp,<span class="hljs-literal">NULL</span>);<br>        printk(<span class="hljs-string">&quot;fread_advance end\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>编译安装内核</li><li>修改主程序</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;sys/syscall.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;linux/kernel.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">long</span> <span class="hljs-type">int</span> a;<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;this is testwr execution\n&quot;</span>);<br><br><span class="hljs-type">char</span> *res;<br><span class="hljs-type">char</span> <span class="hljs-built_in">string</span>[<span class="hljs-number">120</span>];<br><span class="hljs-type">char</span> path[<span class="hljs-number">120</span>];<br><span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>,<span class="hljs-built_in">string</span>);<br><span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>,path);<br><span class="hljs-type">int</span> length=<span class="hljs-built_in">strlen</span>(<span class="hljs-built_in">string</span>)+<span class="hljs-number">1</span>;<br><span class="hljs-type">int</span> plength=<span class="hljs-built_in">strlen</span>(path)+<span class="hljs-number">1</span>;<br><br><br>a = syscall(<span class="hljs-number">444</span>,length,<span class="hljs-built_in">string</span>,plength,path);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;a=%li\n&quot;</span>,a);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;testwr end\n&quot;</span>);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;this is testwr execution\n&quot;</span>);<br>a = syscall(<span class="hljs-number">446</span>,plength,path);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;a=%li\n&quot;</span>,a);<br><br>res = <span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">char</span>)*a);<br> a = syscall(<span class="hljs-number">445</span>,res,plength,path);<br><br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>,res);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;a=%li\n&quot;</span>,a);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;testwr end\n&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>在所需目录下新建所需文件</li><li>编译运行，结果如下</li></ul><p><img src="https://img-blog.csdnimg.cn/87e8890d75744ed6a589a59e9253e2a8.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><p><img src="https://img-blog.csdnimg.cn/73d3143054214904848a7eb69f87852f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h3 id="总结">总结</h3><ul><li>增加系统调用主要是修改三个文件，分别添加系统调用号、系统调用函数声明和系统调用函数定义</li><li>增加文件读写系统调用的核心函数是：filp_open、filp_close、kernel_read、kernel_write、copy_from_user、copy_to_user</li><li>关于文件读写和系统调用传参最大且最容易出现的问题往往是<strong>字符指针</strong>和<strong>字符数组</strong>的问题</li></ul>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>操作系统</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【linux系列】内核编译最新教程+常见问题总结</title>
    <link href="/2022/12/03/%E3%80%90linux%E7%B3%BB%E5%88%97%E3%80%91%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E6%9C%80%E6%96%B0%E6%95%99%E7%A8%8B-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/"/>
    <url>/2022/12/03/%E3%80%90linux%E7%B3%BB%E5%88%97%E3%80%91%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E6%9C%80%E6%96%B0%E6%95%99%E7%A8%8B-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h3 id="编译环境">编译环境</h3><ul><li>虚拟机： <code>VMware workstation pro 16</code></li><li>虚拟机操作系统： <code>ubuntu-20.04.3-desktop-amd64</code></li><li>原系统内核版本：<code>5.11.0-46-generic</code></li><li>内核源码版本：<code>5.11.1</code></li></ul><h3 id="环境准备">环境准备</h3><ul><li><a href="https://blog.csdn.net/h2763246823/article/details/122522464">安装VMware虚拟机并创建虚拟机</a></li><li>安装Ubuntu系统</li><li><a href="https://cdn.kernel.org/pub/linux/kernel/">下载内核源码</a><ul><li>新编译的内核源码版本建议和原系统内核版本相近(大版本一致)</li><li>查看系统内核版本命令 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">uname <span class="hljs-literal">-r</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><h3 id="编译准备">编译准备</h3><ul><li>建议将内核源码移动到 <code>/usr/src/</code>下</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo <span class="hljs-built_in">cp</span> linux<span class="hljs-literal">-5</span>.<span class="hljs-number">11.1</span>.tar.xz /usr/src/<br></code></pre></td></tr></table></figure><ul><li>切换目录到 <code>/usr/src/</code> 下</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cd</span> /usr/src/<br></code></pre></td></tr></table></figure><ul><li>将内核源码解压，这里使用的是 <code>linux-5.11.1.tar.xz</code> ，<code>.xz</code>为双重压缩，因此先使用 <code>xz命令</code>解压</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo xz <span class="hljs-literal">-d</span> linux<span class="hljs-literal">-5</span>.<span class="hljs-number">11.1</span>.tar.xz<br></code></pre></td></tr></table></figure><ul><li>然后使用 <code>tar命令</code> 解压</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo tar <span class="hljs-literal">-xf</span> linux<span class="hljs-literal">-5</span>.<span class="hljs-number">11.1</span>.tar<br></code></pre></td></tr></table></figure><ul><li>切换到 <code>linux-5.11.1</code> 目录下</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cd</span> linux<span class="hljs-literal">-5</span>.<span class="hljs-number">11.1</span><br></code></pre></td></tr></table></figure><h3 id="修改配置">修改配置</h3><h4 id="linux-提供的三种配置命令">linux 提供的三种配置命令</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br><span class="hljs-regexp">//</span> 不建议使用<br>sudo make config<br><br><br><span class="hljs-regexp">//</span> 建议使用（图形界面，键盘操作）<br>sudo make menuconfig<br><br><br><br><span class="hljs-regexp">//</span> 强烈建议使用（图形界面，鼠标操作）<br>sudo make gconfig<br><br></code></pre></td></tr></table></figure><h4 id="使用-gconfig-配置">使用 gconfig 配置</h4><ul><li>安装 <code>make</code></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo apt install make<br></code></pre></td></tr></table></figure><ul><li>安装 <code>gcc</code></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo apt install gcc<br></code></pre></td></tr></table></figure><ul><li>安装 <code>gtk+-2.0</code> 、<code>gmodule-2.0</code> 和 <code>libglade-2.0</code></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo apt install libgtk2.<span class="hljs-number">0</span><span class="hljs-literal">-dev</span> libglib2.<span class="hljs-number">0</span><span class="hljs-literal">-dev</span> libglade2<span class="hljs-literal">-dev</span><br></code></pre></td></tr></table></figure><ul><li>安装 <code>flex</code></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo apt install flex<br></code></pre></td></tr></table></figure><ul><li>安装 <code>bison</code></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo apt install bison<br></code></pre></td></tr></table></figure><ul><li>启动 gconfig</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo make gconfig<br></code></pre></td></tr></table></figure><figure><img src="https://img-blog.csdnimg.cn/c2e9b73fc0a4448ca8447939159789e3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" alt="gconfig界面" /><figcaption aria-hidden="true">gconfig界面</figcaption></figure><ul><li>如果需要修改配置可以在 <strong>gconfig</strong>中图形化进行设置，在这里需要注意，配置选项有时分为三类，分别对应 <code>N</code>、<code>M</code> 和 <code>Y</code><ul><li><code>N</code> 未选中，即编译时不加入，gconfig中为不选中</li><li><code>M</code> 编译成模块，gconfig中选中时为 <code>-</code> 表示</li><li><code>Y</code> 编译入内核，gconfig中选中时为 <code>√</code> 表示</li></ul></li><li>配置好后点击 <code>Save</code> 即可保存配置，生成 <code>.config</code> 文件</li><li>通常源码所带的默认配置所需编译的内核和模块很多，编译一次时间大约在 2-3小时左右(与虚拟机的配置和电脑的性能有关)</li><li>因此在开发中遇到需要编译内核的情况，往往对内核进行裁剪，这里我准备了一份<a href="https://drive.google.com/file/d/1kG54AP5PTmyKTvRBmmVBWRQmwQjs5mJN/view?usp=sharing">裁剪过的内核配置</a>(裁剪的较多，很多模块缺失，谨慎使用)</li><li><strong>使用方式</strong>：<ul><li>【建议】先使用 <strong>gconfig</strong> 生成 <code>.config</code> 文件，并做好<strong>备份</strong></li><li>下载 <a href="https://drive.google.com/file/d/1kG54AP5PTmyKTvRBmmVBWRQmwQjs5mJN/view?usp=sharing">.config(Google 云端硬盘)</a> 或者<a href="https://pan.baidu.com/s/1wWb4qSK69_rADOkFnuiSMg">.config(百度网盘 提取码 2022 )</a>后替换原本内核中的 <code>.config</code></li><li>执行 <code>sudo make gconfig</code> 检查是否替换成功，点击 <code>Save</code> 保存</li></ul></li></ul><h4 id="编译内核">编译内核</h4><ul><li>安装 <code>ssl</code></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo apt install libssl<span class="hljs-literal">-dev</span><br></code></pre></td></tr></table></figure><ul><li>安装 <code>elf</code></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo apt install libelf<span class="hljs-literal">-dev</span><br></code></pre></td></tr></table></figure><ul><li>执行编译命令</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo make <span class="hljs-literal">-j4</span><br></code></pre></td></tr></table></figure><ul><li>编译时间大概为半小时，开把游戏，倒杯茶，走几圈。</li><li>编译成功如下图</li></ul><p><img src="https://img-blog.csdnimg.cn/53d259b602ad4378b5ada1cf36d096d2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h3 id="安装内核">安装内核</h3><ul><li>安装模块</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo make modules_install<br></code></pre></td></tr></table></figure><ul><li>安装成功如下图</li></ul><p><img src="https://img-blog.csdnimg.cn/0f736189f2cb431eb7b31f991caa84e3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>安装内核</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo make install<br></code></pre></td></tr></table></figure><ul><li>安装成功如下图</li></ul><p><img src="https://img-blog.csdnimg.cn/48aa76ce139248ee90c309a90d1369b6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h3 id="载入新内核">载入新内核</h3><ul><li><p>重启 Ubuntu</p><p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">reboot<br></code></pre></td></tr></table></figure></p></li><li><p>系统会默认将新安装的内核作为 <strong>grub</strong> 的第一个启动项</p></li><li><p>如果想要自行切换不同内核，在出现载入进度条时，点击 <code>shift</code></p></li></ul><p><img src="https://img-blog.csdnimg.cn/ca3044cc312049e7b0ef17200c9761b0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>进入 <strong>grub</strong> 后选择 <code>ubuntu 高级选项</code></li></ul><p><img src="https://img-blog.csdnimg.cn/a7318e3b593340cfb43dce6e3f5474e5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>回车进入后，上下选择自己想要进入的内核，回车进入</li></ul><p><img src="https://img-blog.csdnimg.cn/ac1b9c5bf77a4b3c851f8f7b0a245025.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h3 id="检查内核">检查内核</h3><ul><li><p>检查内核版本</p><p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">uname <span class="hljs-literal">-r</span><br></code></pre></td></tr></table></figure></p></li><li><p>结果如下</p></li></ul><p><img src="https://img-blog.csdnimg.cn/d2f5ef8020da4f5d8aad24f2ed0182c0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h3 id="常见问题">常见问题</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sudo: make：找不到命令<br></code></pre></td></tr></table></figure><p><strong>解决办法：</strong> 安装 <code>make</code></p><hr /><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">/bin/sh: <span class="hljs-number">1</span>: gcc: not found<br>make[<span class="hljs-number">1</span>]: *** [<span class="hljs-type">scripts</span>/<span class="hljs-type">Makefile.host</span>:<span class="hljs-number">95</span>：<span class="hljs-type">scripts</span>/<span class="hljs-type">basic</span>/<span class="hljs-type">fixdep</span>] 错误 <span class="hljs-number">127</span><br>make: *** [<span class="hljs-type">Makefile</span>:<span class="hljs-number">534</span>：<span class="hljs-type">scripts_basic</span>] 错误 <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p><strong>解决办法：</strong> 安装 <code>gcc</code></p><hr /><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*<br>* Unable to find the GTK+ installation. Please make sure that<br>* the GTK+ <span class="hljs-number">2.0</span> development package is correctly installed.<br>* You need gtk+<span class="hljs-literal">-2</span>.<span class="hljs-number">0</span> gmodule<span class="hljs-literal">-2</span>.<span class="hljs-number">0</span> libglade<span class="hljs-literal">-2</span>.<span class="hljs-number">0</span><br>*<br>make[<span class="hljs-number">1</span>]: *** [<span class="hljs-type">scripts</span>/<span class="hljs-type">kconfig</span>/<span class="hljs-type">Makefile</span>:<span class="hljs-number">204</span>：<span class="hljs-type">scripts</span>/<span class="hljs-type">kconfig</span>/<span class="hljs-type">gconf</span>-<span class="hljs-type">cfg</span>] 错误 <span class="hljs-number">1</span><br>make: *** [<span class="hljs-type">Makefile</span>:<span class="hljs-number">601</span>：<span class="hljs-type">gconfig</span>] 错误 <span class="hljs-number">2</span><br><br></code></pre></td></tr></table></figure><p><strong>解决办法：</strong> 安装 <code>gtk+-2.0</code> 、<code>gmodule-2.0</code> 和 <code>libglade-2.0</code></p><hr /><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">/bin/sh: <span class="hljs-number">1</span>: flex: not found<br>make[<span class="hljs-number">1</span>]: *** [<span class="hljs-type">scripts</span>/<span class="hljs-type">Makefile.host</span>:<span class="hljs-number">9</span>：<span class="hljs-type">scripts</span>/<span class="hljs-type">kconfig</span>/<span class="hljs-type">lexer.lex.c</span>] 错误 <span class="hljs-number">127</span><br>make: *** [<span class="hljs-type">Makefile</span>:<span class="hljs-number">601</span>：<span class="hljs-type">gconfig</span>] 错误 <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p><strong>解决办法：</strong> 安装 <code>flex</code></p><hr /><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">/bin/sh: <span class="hljs-number">1</span>: bison: not found<br>make[<span class="hljs-number">1</span>]: *** [<span class="hljs-type">scripts</span>/<span class="hljs-type">Makefile.host</span>:<span class="hljs-number">17</span>：<span class="hljs-type">scripts</span>/<span class="hljs-type">kconfig</span>/<span class="hljs-type">parser.tab.h</span>] 错误 <span class="hljs-number">127</span><br>make: *** [<span class="hljs-type">Makefile</span>:<span class="hljs-number">601</span>：<span class="hljs-type">gconfig</span>] 错误 <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p><strong>解决办法：</strong> 安装 <code>bison</code></p><hr /><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scripts/extract<span class="hljs-literal">-cert</span>.c:<span class="hljs-number">21</span>:<span class="hljs-number">10</span>: fatal error: openssl/bio.h: 没有那个文件或目录<br>   <span class="hljs-number">21</span> | <span class="hljs-comment">#include &lt;openssl/bio.h&gt;</span><br>      |          ^~~~~~~~~~~~~~~<br>compilation terminated.<br>make[<span class="hljs-number">1</span>]: *** [<span class="hljs-type">scripts</span>/<span class="hljs-type">Makefile.host</span>:<span class="hljs-number">95</span>：<span class="hljs-type">scripts</span>/<span class="hljs-type">extract</span>-<span class="hljs-type">cert</span>] 错误 <span class="hljs-number">1</span><br>make[<span class="hljs-number">1</span>]: *** 正在等待未完成的任务....<br>make: *** [<span class="hljs-type">Makefile</span>:<span class="hljs-number">1185</span>：<span class="hljs-type">scripts</span>] 错误 <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p><strong>解决办法：</strong> 安装 <code>ssl</code></p><hr /><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">error: Cannot generate ORC metadata <span class="hljs-keyword">for</span> CONFIG_UNWINDER_ORC=y, please install libelf<span class="hljs-literal">-dev</span>, libelf<span class="hljs-literal">-devel</span> or elfutils<span class="hljs-literal">-libelf-devel</span><br>make: *** [<span class="hljs-type">Makefile</span>:<span class="hljs-number">1222</span>：<span class="hljs-type">prepare</span>-<span class="hljs-type">objtool</span>] 错误 <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><strong>解决办法：</strong> 安装 <code>elf</code></p><hr /><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">进入initramfs<br>alert：uuid=xxxxxx does not exist，<br><span class="hljs-built_in">ls</span> /dev下没有sda<br></code></pre></td></tr></table></figure><p><strong>原因分析：</strong> 内核裁剪过度，将 <strong>SCSI</strong> 模块裁剪，<strong>MPT</strong>模块裁剪 <strong>解决办法：</strong> 重新修改内核配置，将 <strong>Device Drivers</strong>下， - <strong>Fusion MPT device suppot</strong>中所有模块加入 - <strong>SCSI device support</strong>下与 <strong>SCSI</strong> 有关的模块加入 - <strong>SCSI device support</strong>下 <strong>SCSI low-level drivers</strong> 下 <strong>LSI MPT Fusion SAS 3.0 &amp; SAS 2.0 Device Driver</strong>加入</p>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
      <category>Solutions</category>
      
      <category>Summarize</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Kernel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【Linux系列】VMware虚拟机下安装Ubuntu</title>
    <link href="/2022/12/03/%E3%80%90Linux%E7%B3%BB%E5%88%97%E3%80%91VMware%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8B%E5%AE%89%E8%A3%85Ubuntu/"/>
    <url>/2022/12/03/%E3%80%90Linux%E7%B3%BB%E5%88%97%E3%80%91VMware%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8B%E5%AE%89%E8%A3%85Ubuntu/</url>
    
    <content type="html"><![CDATA[<h3 id="安装环境">安装环境</h3><ul><li>本机操作系统：<code>Windows10/11</code></li><li>虚拟机： <code>VMware workstation pro 16</code></li><li>虚拟机操作系统： <code>ubuntu-20.04.3-desktop-amd64</code></li></ul><h3 id="安装准备">安装准备</h3><ul><li><a href="https://blog.csdn.net/h2763246823/article/details/122522464">安装VMware虚拟机并创建虚拟机</a></li><li><a href="https://ubuntu.com/download/desktop">下载Ubuntu操作系统镜像</a></li></ul><h3 id="加载镜像">加载镜像</h3><ul><li>点击 <code>Edit virtual machine settings</code> 进入虚拟机配置</li><li>点击 <code>CD/DVD</code>，选择下载Ubuntu镜像文件位置，如下图</li></ul><p><img src="https://img-blog.csdnimg.cn/bf05b4c75c1048e6b79462bb86a4ebf0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>确认后启动虚拟机</li></ul><h3 id="安装系统">安装系统</h3><ul><li><p>虚拟机启动后将会先进行磁盘检查，然后进入操作系统安装引导界面。 <img src="https://img-blog.csdnimg.cn/bb865f3831c742a792d26b68165f5ea3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /> 注：下方出现提示 <strong>切勿点击</strong> <code>I Finished Installing</code>， <strong>点击右上角叉</strong>就行</p></li><li><p>进入选择语言，默认为 <code>English</code> ，这里选择<code>简体中文</code>，点击 <code>安装Ubuntu</code> <img src="https://img-blog.csdnimg.cn/2490f180c6f14aae93413450b4ebe196.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /> <img src="https://img-blog.csdnimg.cn/f13cb80fe2fb45f08e436fe57b6e0432.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /> 注：下方提示安装 VMware Tools，选择 <code>Remind Me Later</code>，点 <code>Install Tools</code> 可能会出现些未知的错误</p></li><li><p>进入选择键盘布局界面，默认即可，选择继续 <img src="https://img-blog.csdnimg.cn/414a77e25d6d4e43a07f0d03e81f4ced.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /> 注：从这开始时常会出现，下方下一步的选项在界面外部，鼠标无法点击到，这里提供一个方法，按住 <code>F7</code>，然后再用鼠标拖动引导界面的窗口就可将下面的内容移动上来(游戏本可能需要按<code>Fn</code>) <img src="https://img-blog.csdnimg.cn/4324f521b02a415f89b7d65776fcca21.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p></li><li><p>进入更新和其他软件界面，这里默认，选择继续 <img src="https://img-blog.csdnimg.cn/1c87de7f37cc4935bd5b271d3cb60c0f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p></li><li><p>进安装类型，这里默认，选择现在安装 <img src="https://img-blog.csdnimg.cn/a9fa9c2e66e34834862fec885b27d3de.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p></li><li><p>提示格式化磁盘，点击继续 <img src="https://img-blog.csdnimg.cn/a581ae2fc2eb4c039190a7e7961bb83b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p></li><li><p>进入选择时区，这里选择 <code>Shanghai</code>，点击继续 <img src="https://img-blog.csdnimg.cn/0aa1be7418844156ae059c3cb37d1332.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p></li><li><p>进入设置用户名，密码，填写后，点击继续 <img src="https://img-blog.csdnimg.cn/be442e5c93464ee39f83f381b3d7f382.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p></li><li><p>安装引导结束，开始安装，大约等待时间为半小时后即可安装成功，现在可以泡杯茶去走一圈。</p></li><li><p>安装完成后重启</p></li></ul><h3 id="总结">总结</h3><ul><li>按照上述流程一般能正常安装 Ubuntu，但有时候会出现一些问题(解决办法是自己总结的，如果有好的思路可以在评论区评论哦，会及时更新)</li><li><strong>【问题1】进入 Network boot</strong></li></ul><p><img src="https://img-blog.csdnimg.cn/41e674bf72134cba81f04748b1b9d975.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><p><strong>解决办法：</strong> 1. 重启，是不是进入的时候按了 <code>F12</code> 2. 重头来过</p><ul><li><strong>【问题2】虚拟机内桌面很小</strong> <strong>解决办法：</strong> <a href="">安装 VMware Tools</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Virtual Machine</tag>
      
      <tag>Ubuntu</tag>
      
      <tag>VMware</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【linux系列】安装并创建虚拟机</title>
    <link href="/2022/12/03/%E3%80%90linux%E7%B3%BB%E5%88%97%E3%80%91%E5%AE%89%E8%A3%85%E5%B9%B6%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
    <url>/2022/12/03/%E3%80%90linux%E7%B3%BB%E5%88%97%E3%80%91%E5%AE%89%E8%A3%85%E5%B9%B6%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA/</url>
    
    <content type="html"><![CDATA[<h3 id="安装准备">安装准备</h3><ul><li><a href="https://drive.google.com/file/d/1XZQPF-R-hmgBtO8CUCdq2WxjFL3ZxCrJ/view?usp=sharing">下载 VMwave workstation pro 16</a></li></ul><h3 id="安装虚拟机">安装虚拟机</h3><ul><li>下载解压压缩包后双击运行 <code>VMware-workstation-full-16.1.0-17198959.exe</code> 文件。</li><li>按照安装引导程序安装，一般默认选项下一步即可。</li><li>遇到填写授权码时，将压缩包中的授权码填入确认即可。</li></ul><p>注：安装虚拟机的过程比较简单，在此不再赘述，需要注意的是安装路径<strong>不要有中文</strong>，（这点得养成习惯，安装软件路径一般不包含中文）</p><h3 id="创建虚拟机">创建虚拟机</h3><ul><li>安装好虚拟机后启动虚拟机，如下图</li></ul><p><img src="https://img-blog.csdnimg.cn/ce703040c2f74af49064ce6244e3bdfe.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>点击 <code>Create a New Virtual Machine</code> 开始创建一个新的虚拟机，这里选 <code>Custom</code> 具有更多更详细的配置，如下图</li></ul><p><img src="https://img-blog.csdnimg.cn/336d724cad824a44bc0a5e2fa773e6e1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>点击下一步，进入选择虚拟机硬件兼容性，一般默认，<strong>选择下一步</strong></li></ul><p><img src="https://img-blog.csdnimg.cn/76588ca576584092b36de0a584e884cc.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>进入选择客户操作系统安装，这里选择 <strong>我将稍后安装操作系统</strong>，点击下一步</li></ul><p><img src="https://img-blog.csdnimg.cn/cce8cb1707a948f2b3dfab9ea5547d3d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>进入选择将安装的操作系统类型，本次选择安装 <strong>Linux系统</strong>，<strong>Ubuntu</strong>，点击下一步</li></ul><p><img src="https://img-blog.csdnimg.cn/8bce66e87f824f399cf813fbc3a60e47.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>进入选择虚拟机名字和虚拟机创建路径，根据自己的喜好修改好后点击下一步</li></ul><p><img src="https://img-blog.csdnimg.cn/21c961811a1d4867b0027543476c72e5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>进入处理器配置，可以根据自己电脑的逻辑处理器个数和内核个数进行修改(一般情况下默认即可，如果需要有更高的性能可以修改)，这里选择默认，点击下一步</li></ul><p><img src="https://img-blog.csdnimg.cn/6a6cfc837d864c158b39797a14da0985.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>进入内存分配，VMware 会自动检测你的电脑内存大小并给出建议(这里可以根据需求自行调整，只要不超过所建议的最大内存即可)，这里我修改为 <strong>3072MB</strong>，即 <strong>3G 内存</strong>，根据自己的喜好修改好后点击下一步</li></ul><p><img src="https://img-blog.csdnimg.cn/9cccd081ea4347c6b19f8e6c89bc778f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>进入网络类型配置，这里选择 <code>Use network address translation(NAT)</code> ，点击下一步</li></ul><p><img src="https://img-blog.csdnimg.cn/d1179a5976644b85989b0e6f352a3b40.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>进入选择 选择I/O控制器类型，这里默认 ，点击下一步</li></ul><p><img src="https://img-blog.csdnimg.cn/bddaa9c871504fcbb3ec81124d9a0085.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>进入选择磁盘类型，默认为固态硬盘(SCSI) ，如有需求可以自行修改，这里选择 <strong>SCSI</strong> ，点击下一步</li></ul><p><img src="https://img-blog.csdnimg.cn/447abdea2add4e8eb8aa0dfc1b132188.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>进入选择磁盘，这里选择 <strong>创建一个新的虚拟磁盘</strong> ，点击下一步</li></ul><p><img src="https://img-blog.csdnimg.cn/7f5f0c6ceb524b449f56a29f33702b40.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>进入选择磁盘空间大小，如果此虚拟机之后只是用来随意玩耍，分配的磁盘空间大小 <strong>20G</strong> 即可，如果此虚拟机之后是用来开发或者研究，建议分配空间不要小于 <strong>40G</strong> (这里只是我个人使用总结的经验)，这里我分配了 <strong>40G</strong> ，之后选项默认，点击下一步</li></ul><p><img src="https://img-blog.csdnimg.cn/6b8d5bafa6f943f0b65e7d73876cca30.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>进入 指定磁盘文件 ，这里默认，点击下一步</li></ul><p><img src="https://img-blog.csdnimg.cn/5b9f907e5cb446719d31f5caf8f5c7be.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>最后确认好配置后，点击 <code>Finish</code></li></ul><p><img src="https://img-blog.csdnimg.cn/20d168c85c944b71908ab9c0b5027b2c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>至此一个虚拟机便创建成功</li></ul><p><img src="https://img-blog.csdnimg.cn/0dae195f66d5477aa5bdb146e2c553b8.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h3 id="配置虚拟机">配置虚拟机</h3><ul><li>点击 <code>Edit virtual machine settings</code> 进入虚拟机配置</li></ul><p><img src="https://img-blog.csdnimg.cn/9260ca88b40c443f85c1afacb9f48f44.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>在虚拟机关闭时可以进入虚拟机配置界面对虚拟机参数进行配置</li><li>【必配】 USB类型，默认USB支持为<strong>2.0</strong>，需要将USB切换到<strong>3.1</strong>。</li></ul><p><img src="https://img-blog.csdnimg.cn/a335382a7e5a435194012f627d1a8784.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h3 id="总结">总结</h3><ul><li>上面便是安装并创建虚拟机的整体流程，如遇到问题欢迎评论区留言。</li><li>当然虚拟机还有个重要的部分便是安装操作系统</li><li>如何安装操作系统(Ubuntu 为例)请移步 <a href="https://blog.csdn.net/h2763246823/article/details/122523076">【linux系列】VMware虚拟机下安装Ubuntu</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Virtual Machine</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>加强Floyd算法和找零问题贪婪算法求解Python代码实现</title>
    <link href="/2022/12/03/%E5%8A%A0%E5%BC%BAFloyd%E7%AE%97%E6%B3%95%E5%92%8C%E6%89%BE%E9%9B%B6%E9%97%AE%E9%A2%98%E8%B4%AA%E5%A9%AA%E7%AE%97%E6%B3%95%E6%B1%82%E8%A7%A3Python%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/"/>
    <url>/2022/12/03/%E5%8A%A0%E5%BC%BAFloyd%E7%AE%97%E6%B3%95%E5%92%8C%E6%89%BE%E9%9B%B6%E9%97%AE%E9%A2%98%E8%B4%AA%E5%A9%AA%E7%AE%97%E6%B3%95%E6%B1%82%E8%A7%A3Python%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="加强floyd算法使得该算法能够求出最短路径本身而不仅仅是它们的长度">加强Floyd算法，使得该算法能够求出最短路径本身，而不仅仅是它们的长度。</h2><h3 id="算法设计思想">算法设计思想</h3><ul><li><p>所有路径都由两条路径构成： 一条从<span class="math inline">\(v_i\)</span>到<span class="math inline">\(v_k\)</span>的路径，路径中每个中间顶点的编号都不大于<span class="math inline">\(k-1\)</span>; 一条从<span class="math inline">\(v_k\)</span>到<span class="math inline">\(v_j\)</span>的路径，路径中每个中间顶点的编号也都不大于<span class="math inline">\(k-1\)</span></p></li><li><p>设路径长度为 <span class="math inline">\(d\)</span> 得到以下递推式，<span class="math inline">\(当k\geq 1, d_{ij}^{(0)}=w_{ij}时， d_{ij}^{(k)} = min\begin{Bmatrix} d_{ij}^{(k-1)}, d_{ik}^{(k-1)} + d_{kj}^{(k-1)} \end{Bmatrix}\)</span></p></li><li><p>同理路径本身也可以得到与上面相同的公式</p></li></ul><p><span class="math display">\[E=mc^2\]</span></p><h3 id="具体步骤描述">具体步骤描述</h3><ul><li><p>初始化邻接矩阵</p></li><li><p>通过邻接矩阵来初始化路径矩阵</p></li><li><p><span class="math inline">\(k\)</span> 从 0 开始循环</p></li><li><p>遍历邻接矩阵，按照公式处理邻接矩阵和路径矩阵</p></li><li><p><span class="math inline">\(当k\geq 1, d_{ij}^{(0)}=w_{ij}时， d_{ij}^{(k)} = min\begin{Bmatrix} d_{ij}^{(k-1)}, d_{ik}^{(k-1)} + d_{kj}^{(k-1)} \end{Bmatrix}\)</span></p></li><li><p>将两个矩阵返回，即得到最短路径的长度以及最短路径本身</p></li></ul><h3 id="实现源码">实现源码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-comment"># 初始化邻接矩阵</span><br>W = [<br>    [<span class="hljs-number">0</span>, np.inf, <span class="hljs-number">3</span>, np.inf, np.inf],<br>    [<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, np.inf, np.inf, <span class="hljs-number">5</span>],<br>    [np.inf, <span class="hljs-number">7</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, np.inf],<br>    [<span class="hljs-number">6</span>, np.inf, np.inf, <span class="hljs-number">0</span>, <span class="hljs-number">11</span>],<br>    [np.inf, np.inf, np.inf, np.inf, np.inf],<br>]<br><br>S = []<br><br><span class="hljs-comment"># 初始化路径矩阵</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(W)):<br>    S.append([<span class="hljs-built_in">chr</span>(<span class="hljs-number">97</span> + i) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(W))])<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Floyd</span>(<span class="hljs-params">W, S</span>):<br>    D = W<br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(W)):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(W)):<br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(W)):<br>                <span class="hljs-keyword">if</span> D[i][j] &gt; D[i][k] + D[k][j]:<br>                    S[i][j] = S[i][k] + S[k][j]<br>                    D[i][j] = D[i][k] + D[k][j]<br>                <span class="hljs-comment"># 给路径矩阵添上路径终点结点</span><br>                <span class="hljs-keyword">if</span> k == <span class="hljs-built_in">len</span>(W) - <span class="hljs-number">1</span>:<br>                    S[i][j] += S[j][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">return</span> np.array(D), np.<br>array(S)<br><br><br>W, S = Floyd(W, S)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3190608027 黄文焕&quot;</span>)<br><span class="hljs-built_in">print</span>(W)<br><span class="hljs-built_in">print</span>(S)<br></code></pre></td></tr></table></figure><h3 id="运行结果截图">运行结果截图</h3><figure><img src="https://img-blog.csdnimg.cn/b89c49a2d8924595baca8c6e90544bf9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" alt="运行结果" /><figcaption aria-hidden="true">运行结果</figcaption></figure><h2 id="为找零问题写一个贪婪算法的伪代码它以金额n和硬币的面额d1d2...dm作为输入">为找零问题写一个贪婪算法的伪代码，它以金额n和硬币的面额d1&gt;d2&gt;...&gt;dm作为输入。</h2><h3 id="算法设计思想-1">算法设计思想</h3><ul><li>将 n 和 d1 相除，商为硬币个数，再 n 取余 d1 赋值给 n，循环下去，直到 dm</li></ul><h3 id="具体步骤描述-1">具体步骤描述</h3><ul><li><p>输入 n 以及从大到小排列的币值</p></li><li><p>循环处理 li 中的币值，n / li[index],n = n % li[index]</p></li><li><p>将结果保存在字典 d 中，</p></li><li><p>返回结果字典 d</p></li></ul><h3 id="实现源码-1">实现源码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3190608027 黄文焕&quot;</span>)<br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入n: &quot;</span>))<br>li = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请从大到小输入币值: &quot;</span>).split()))<br>d = <span class="hljs-built_in">dict</span>()<br>index = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">while</span> index &lt; <span class="hljs-built_in">len</span>(li):<br>    m = <span class="hljs-built_in">int</span>(n / li[index])<br>    d[li[index]] = m<br>    n = n % li[index]<br>    index += <span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(d)<br></code></pre></td></tr></table></figure><h2 id="运行结果截图-1">运行结果截图</h2><figure><img src="https://img-blog.csdnimg.cn/00217dc58b3e4ebea0ffc6ae02b2731b.png" alt="运行结果" /><figcaption aria-hidden="true">运行结果</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>Algorithm</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Floyd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>二进制反射格雷码和Tromino问题Python代码实现</title>
    <link href="/2022/12/03/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8F%8D%E5%B0%84%E6%A0%BC%E9%9B%B7%E7%A0%81%E5%92%8CTromino%E9%97%AE%E9%A2%98Python%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/"/>
    <url>/2022/12/03/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8F%8D%E5%B0%84%E6%A0%BC%E9%9B%B7%E7%A0%81%E5%92%8CTromino%E9%97%AE%E9%A2%98Python%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="实现n位二进制反射格雷码采用递归的减治法">实现n位二进制反射格雷码（采用递归的减治法）</h2><h3 id="算法设计思想">算法设计思想</h3><ul><li><p>n+1 位格雷码的前 2^n 个二进制串，可以由依此算法生成的 n 位格雷码(总共 2^n 个 n 位二进制串)按顺序排列，再在每个串前加一个前缀 0 构成。</p></li><li><p>n+1 位格雷码的后 2^n 个二进制串，可以由依此算法生成的 n 位格雷码(总共 2^n 个 n 位二进制串)按逆序排列，再在每个串前加一个前缀 1 构成。</p></li></ul><h3 id="具体步骤描述">具体步骤描述</h3><ul><li><p>输入二进制反射格雷码的位数n</p></li><li><p>递归调用<code>BRGC_Recursion</code>函数</p></li><li><p>n 等于1 时返回包含 0 和 1 字串的列表</p></li><li><p>n 不等于 1 时处理递归返回的列表</p><ul><li><p>先复制一份并翻转</p></li><li><p>在原本返回的列表中的每个字串前添加 0</p></li><li><p>在复制翻转后的列表中的每个字串前添加 1</p></li><li><p>返回两个列表合并后的列表</p></li></ul></li></ul><h3 id="实现源码">实现源码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">二进制反射格雷码 -- 递归实现</span><br><span class="hljs-string">输入：二进制反射格雷码位数n</span><br><span class="hljs-string">输出：对应位数的二进制反射格雷码</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;黄文焕 3190608027&quot;</span>)<br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;输入要生成的反射格雷码的位数：&quot;</span>))<br><br><br><span class="hljs-comment"># 二进制反射格雷码递归函数定义</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">BRGC_Recursion</span>(<span class="hljs-params">n</span>):<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> [<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>]<br>    <span class="hljs-keyword">else</span>:<br>        res = BRGC_Recursion(n - <span class="hljs-number">1</span>)<br><br>        <span class="hljs-comment"># 复制res</span><br>        res_cpy = res.copy()<br>        <span class="hljs-comment"># 翻转res_cpy</span><br>        res_cpy.reverse()<br>        <span class="hljs-comment"># 在res中每一项字串前拼接 &#x27;0&#x27;</span><br>        <span class="hljs-keyword">for</span> i, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(res):<br>            res[i] = <span class="hljs-string">&#x27;0&#x27;</span> + v<br>        <span class="hljs-comment"># 在res_copy中每一项字串前拼接 &#x27;1&#x27;</span><br>        <span class="hljs-keyword">for</span> i, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(res_cpy):<br>            res_cpy[i] = <span class="hljs-string">&#x27;1&#x27;</span> + v<br>        <span class="hljs-comment"># 返回res和res_copy拼接后的列表</span><br>        <span class="hljs-keyword">return</span> res + res_cpy<br><br><br><span class="hljs-comment"># 输出生成的二进制反射格雷码</span><br><span class="hljs-built_in">print</span>(BRGC_Recursion(n))<br></code></pre></td></tr></table></figure><h3 id="运行结果截图">运行结果截图</h3><figure><img src="https://img-blog.csdnimg.cn/2359b32a0f7641109115e1f885c96c30.png" alt="运行结果" /><figcaption aria-hidden="true">运行结果</figcaption></figure><h2 id="实现n位二进制反射格雷码非递归算法实现">实现n位二进制反射格雷码（非递归算法实现）</h2><h3 id="算法设计思想-1">算法设计思想</h3><ul><li><p>以全 0 的 n 位串开始。</p></li><li><p>对于 i = 1,2,3 ,···, 2^(n-1), 则通过翻转前一位串中的第 b 位来生成第 i 个位串，前这里 b 是 i 的二进制表示中最低位 1 的位置</p></li></ul><h3 id="具体步骤描述-1">具体步骤描述</h3><ul><li><p>输入二进制反射格雷码的位数n</p></li><li><p>初始化结果列表中的第一个字串，为 n 个 0</p></li><li><p>设置结束为 2 的 n 次方，遍历时则为 1 到 2^(n-1)</p></li><li><p>将 i 转换成 n 位二进制字串</p></li><li><p>从右向左寻找 i 的二进制字串中第一个 1 的索引</p></li><li><p>将结果列表中最后一个字串中，对应索引位置的修改</p><ul><li>如果为 '1' 则换为 '0'，否则换为 '1'</li></ul></li></ul><h3 id="实现源码-1">实现源码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">二进制反射格雷码 -- 非递归实现</span><br><span class="hljs-string">输入：二进制反射格雷码位数n</span><br><span class="hljs-string">输出：对应位数的二进制反射格雷码</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;黄文焕 3190608027&quot;</span>)<br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;输入要生成的反射格雷码的位数：&quot;</span>))<br><br><span class="hljs-comment"># 初始化结果列表中的第一个字串，为n个0</span><br>res = [<span class="hljs-string">&#x27;0&#x27;</span>*n]<br><span class="hljs-comment"># 设置结束为2的n次方</span><br>end = <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, n)<br><span class="hljs-comment"># 从1到end-1</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, end):<br>    <span class="hljs-comment"># 将i转换成二进制字串,去掉 &#x27;0b&#x27; 前缀</span><br>    i_bin = <span class="hljs-built_in">bin</span>(i).replace(<span class="hljs-string">&#x27;0b&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-comment"># 并在i_bin前拼接 n-len(i_bin)长度个 &#x27;0&#x27;</span><br>    i_bin = <span class="hljs-string">&#x27;0&#x27;</span> * (n - <span class="hljs-built_in">len</span>(i_bin)) + i_bin<br>    <span class="hljs-comment"># 将结果列表中最后一个字串转换成列表str</span><br>    <span class="hljs-built_in">str</span> = <span class="hljs-built_in">list</span>(res[i-<span class="hljs-number">1</span>])<br>    <span class="hljs-comment"># 在i_bin中从右向左寻找字符 &#x27;1&#x27;并返回对应索引</span><br>    index = i_bin.rfind(<span class="hljs-string">&#x27;1&#x27;</span>)<br>    <span class="hljs-comment"># 将str中对应索引的字符修改，如果为 &#x27;1&#x27; 则换为 &#x27;0&#x27;，否则换为 &#x27;1&#x27;</span><br>    <span class="hljs-built_in">str</span>[index] = <span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>[index] == <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;1&#x27;</span><br>    <span class="hljs-comment"># 将str重新拼接成字符串，并添加入res列表</span><br>    res.append(<span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">str</span>))<br><br><span class="hljs-comment"># 输出生成的二进制反射格雷码</span><br><span class="hljs-built_in">print</span>(res)<br></code></pre></td></tr></table></figure><h3 id="运行结果截图-1">运行结果截图</h3><figure><img src="https://img-blog.csdnimg.cn/ee0b2c21b37c43e68a6a9cc4eb586eff.png" alt="运行结果" /><figcaption aria-hidden="true">运行结果</figcaption></figure><h2 id="分治法实现2n2n棋盘覆盖问题棋盘用二维数组表示缺失方块0填充l型骨牌用相同整数填充">分治法实现2^n*2^n棋盘覆盖问题，棋盘用二维数组表示，缺失方块0填充，L型骨牌用相同整数填充。</h2><h3 id="算法设计思想-2">算法设计思想</h3><ul><li><p>将棋盘依次划分为四个象限，k所在象限继续划分。</p></li><li><p>k不在的剩余三个象限，将划分轴原点附近的剩余三个点，标志为L型骨牌</p></li><li><p>k不在的象限继续划分，并将之前标志为L型骨牌的点看做缺失点k</p></li><li><p>依次类推，当划分棋盘大小size等于1时结束</p></li></ul><h3 id="具体步骤描述-2">具体步骤描述</h3><ul><li><p>输入 n 和 k 在棋盘中的坐标</p></li><li><p>初始化棋盘</p></li><li><p>将棋盘分为四个象限，k 所在的象限直接递归调用 Tromino</p></li><li><p>对于 k 不在的三个象限，将划分轴原点附近的剩余三个点，标志为L型骨牌(以相同的数字表示)</p></li><li><p>k不在的象限继续划分，并将之前标志为 L型骨牌的点 看做缺失点 k</p></li><li><p>依次类推，当划分棋盘大小size等于1时结束</p></li></ul><h3 id="实现源码-2">实现源码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 导入 numpy 包</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-comment"># 输入n和k在棋盘中的坐标</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;黄文焕 3190608027&quot;</span>)<br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;输入n：&quot;</span>))<br>k_x, k_y = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;输入k所在的坐标：&quot;</span>).split())<br><br><span class="hljs-comment"># 初始化棋盘</span><br>size = <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, n)<br>arr = np.ones((size, size))<br>arr_x, arr_y = arr.shape<br>arr[k_x][k_y] = <span class="hljs-number">0</span><br><br><span class="hljs-comment"># 用于标注L形骨牌</span><br>num = <span class="hljs-number">1</span><br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">参数说明：</span><br><span class="hljs-string">    k_x, k_y -- k所在坐标</span><br><span class="hljs-string">    arr_x, arr_y -- 起点坐标</span><br><span class="hljs-string">    size -- 棋盘大小</span><br><span class="hljs-string">算法思路：</span><br><span class="hljs-string">    将棋盘依次划分为四个象限，k所在象限继续划分。</span><br><span class="hljs-string">    k不在的剩余三个象限，将划分轴原点附近的剩余三个点，标志为L型骨牌</span><br><span class="hljs-string">    k不在的象限继续划分，并将之前标志为L型骨牌的点看做缺失点k</span><br><span class="hljs-string">    依次类推，当划分棋盘大小size等于1时结束</span><br><span class="hljs-string">输入案例：</span><br><span class="hljs-string">    输入n：3</span><br><span class="hljs-string">    输入k所在的坐标：1 1</span><br><span class="hljs-string">输出案例：</span><br><span class="hljs-string">    [[ 9.  9.  8.  8.  4.  4.  3.  3.]</span><br><span class="hljs-string">     [ 9.  0.  7.  8.  4.  2.  2.  3.]</span><br><span class="hljs-string">     [10.  7.  7. 11.  5.  5.  2.  6.]</span><br><span class="hljs-string">     [10. 10. 11. 11.  1.  5.  6.  6.]</span><br><span class="hljs-string">     [14. 14. 13.  1.  1. 19. 18. 18.]</span><br><span class="hljs-string">     [14. 12. 13. 13. 19. 19. 17. 18.]</span><br><span class="hljs-string">     [15. 12. 12. 16. 20. 17. 17. 21.]</span><br><span class="hljs-string">     [15. 15. 16. 16. 20. 20. 21. 21.]]</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-comment"># 定义Tromino递归函数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Tromino</span>(<span class="hljs-params">k_x, k_y, arr_x, arr_y, size</span>):<br>    <span class="hljs-keyword">if</span> size == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span><br>    D_size = <span class="hljs-built_in">int</span>(size / <span class="hljs-number">2</span>)<br>    <span class="hljs-comment"># 使用全局定义的num</span><br>    <span class="hljs-keyword">global</span> num<br>    temp = num<br>    num += <span class="hljs-number">1</span><br><br>    <span class="hljs-comment"># 第一象限</span><br>    <span class="hljs-keyword">if</span> k_x &lt; arr_x + D_size <span class="hljs-keyword">and</span> k_y &gt;=arr_y + D_size:<br>        Tromino(k_x, k_y, arr_x, arr_y + D_size, D_size)<br>    <span class="hljs-keyword">else</span>:<br>        arr[arr_x + D_size - <span class="hljs-number">1</span>][arr_y + D_size] = temp<br>        Tromino(arr_x + D_size - <span class="hljs-number">1</span>, arr_y + D_size, arr_x, arr_y + D_size, D_size)<br><br>    <span class="hljs-comment"># 第二象限</span><br>    <span class="hljs-keyword">if</span> k_x &lt; arr_x + D_size <span class="hljs-keyword">and</span> k_y &lt; arr_y + D_size:<br>        Tromino(k_x, k_y, arr_x, arr_y, D_size)<br>    <span class="hljs-keyword">else</span>:<br>        arr[arr_x + D_size - <span class="hljs-number">1</span>][arr_y + D_size - <span class="hljs-number">1</span>] = temp<br>        Tromino(arr_x + D_size - <span class="hljs-number">1</span>, arr_y + D_size - <span class="hljs-number">1</span>, arr_x, arr_y, D_size)<br><br>    <span class="hljs-comment"># 第三象限</span><br>    <span class="hljs-keyword">if</span> k_x &gt;= arr_x + D_size <span class="hljs-keyword">and</span> k_y &lt; arr_y + D_size:<br>        Tromino(k_x, k_y, arr_x + D_size, arr_y, D_size)<br>    <span class="hljs-keyword">else</span>:<br>        arr[arr_x + D_size][arr_y + D_size - <span class="hljs-number">1</span>] = temp<br>        Tromino(arr_x + D_size, arr_y + D_size - <span class="hljs-number">1</span>, arr_x + D_size, arr_y, D_size)<br><br>    <span class="hljs-comment"># 第四象限</span><br>    <span class="hljs-keyword">if</span> k_x &gt;=arr_x + D_size <span class="hljs-keyword">and</span> k_y &gt;=arr_y + D_size:<br>        Tromino(k_x, k_y, arr_x + D_size, arr_y + D_size, D_size)<br>    <span class="hljs-keyword">else</span>:<br>        arr[arr_x + D_size][arr_y + D_size] = temp<br>        Tromino(arr_x + D_size, arr_y + D_size, arr_x + D_size, arr_y + D_size, D_size)<br><br><br><span class="hljs-comment"># 调用Tromino函数</span><br>Tromino(k_x, k_y, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, size)<br><br><span class="hljs-comment"># 输出标注完成的棋盘</span><br><span class="hljs-built_in">print</span>(arr)<br></code></pre></td></tr></table></figure><h3 id="运行结果截图-2">运行结果截图</h3><figure><img src="https://img-blog.csdnimg.cn/70fb425d55544b6293732869fa3fbb40.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" alt="运行结果" /><figcaption aria-hidden="true">运行结果</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>Algorithm</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Binary Gray Code</tag>
      
      <tag>Tromino</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【快速解决】conda 报错ValueError check_hostname requires server_hostname</title>
    <link href="/2022/11/20/%E3%80%90%E5%BF%AB%E9%80%9F%E8%A7%A3%E5%86%B3%E3%80%91conda-%E6%8A%A5%E9%94%99ValueError/"/>
    <url>/2022/11/20/%E3%80%90%E5%BF%AB%E9%80%9F%E8%A7%A3%E5%86%B3%E3%80%91conda-%E6%8A%A5%E9%94%99ValueError/</url>
    
    <content type="html"><![CDATA[<h2 id="写在前面">写在前面</h2><ul><li>我的环境：<ul><li>Anaconda 4.10.1</li><li>Win10</li></ul></li></ul><h2 id="快速解决">快速解决</h2><figure><img src="https://img-blog.csdnimg.cn/71c803243b62421b8895e9c65a7dce27.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" alt="报错内容" /><figcaption aria-hidden="true">报错内容</figcaption></figure><ul><li>根据报错信息可以判断出是网络连接问题，检查后是因为我设置了代理，只需要给conda也配置上代理即可</li><li>在 <code>C:\users\username\</code> 下找到并打开 <code>.condarc</code> 文件，文件可能隐藏，可以在文件资源管理器中设置查看-&gt;显示隐藏的文件 -<code>.condarc</code> 文件可能为空也可能有内容，只需要添加上如下语句:</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">proxy_servers: &#123;http: <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:port, https: <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:port&#125;<br></code></pre></td></tr></table></figure><ul><li>注意：将 <code>port</code> 换成自己的端口，可以在Win10的设置代理中的手动设置部分找到。</li></ul>]]></content>
    
    
    <categories>
      
      <category>Solutions</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Anaconda</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Eclipse 快速创建运行 Javaweb 项目</title>
    <link href="/2022/11/20/Eclipse-%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BA%E8%BF%90%E8%A1%8C-Javaweb-%E9%A1%B9%E7%9B%AE/"/>
    <url>/2022/11/20/Eclipse-%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BA%E8%BF%90%E8%A1%8C-Javaweb-%E9%A1%B9%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="使用环境">使用环境</h2><ul><li>Eclipse IDE for Enterprise Java Developers.<ul><li>Version: 2020-03 (4.15.0)</li><li>Build id: 20200313-1211</li></ul></li><li>Tomcat<ul><li>Version: apache-tomcat-9.0.46</li></ul></li></ul><h2 id="创建项目">创建项目</h2><ul><li>选择 File -&gt; New -&gt; Dynamic Web Project</li></ul><p><img src="https://img-blog.csdnimg.cn/a9352cb6ece04477ad4c729a93a13c27.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>注意：有可能找不到 Dynamic Web Project 选项，可以进入 Other，在其中的 Web 文件夹中寻找到，如下图：</li></ul><p><img src="https://img-blog.csdnimg.cn/c9775232e5f449a0bc80abc49566d412.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><p><img src="https://img-blog.csdnimg.cn/938f9b2b5396402c89f037a7da380581.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>填入项目名后可以直接点击 Finish，如果需要修改项目的目录结构可以点 Next 进行下一步设置</li></ul><p><img src="https://img-blog.csdnimg.cn/e464d7fac99a42c998146348503e72d6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>点击 Finish 后就会创建一个web项目</li></ul><p><img src="https://img-blog.csdnimg.cn/deace37901bb424cb80e72eac019c752.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h2 id="运行项目">运行项目</h2><ul><li>首先配置运行环境，此处需要用到 Tomcat，(本教程默认已经安装 Tomcat 且可以正常上使用)</li><li>进入到 Window -&gt; Preferences -&gt; Server -&gt; Runtime Environments 在此处进行 eclipse 与本地 Tomcat 的关联，(默认应该没有tomcat配置，因为我已经配置过一次所以有配置好的一个运行环境)</li></ul><p><img src="https://img-blog.csdnimg.cn/bfb97d1c0892499caae927d9d7e32a09.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>点击 Add 按钮后，选择你对应的 Tomcat 版本，(由于我用的是 apache-tomcat-9.0.46, 此处选择 Tomcat v9.0，注意此 eclipse 版本没有 Tomcat v10.0 选项)，点击 Next</li></ul><p><img src="https://img-blog.csdnimg.cn/9d51d42bf27448db90f50443ee8439e5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>点击 Browse 选择 Tomcat 安装路径，切换 JRE，然后点击 Finish 即可完成运行环境的配置</li></ul><p><img src="https://img-blog.csdnimg.cn/a3b8a97cde2e4e0eb72e595ae2a3218d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h2 id="测试配置">测试配置</h2><ul><li>右键 WebContent 新建一个 jsp 文件</li></ul><p><img src="https://img-blog.csdnimg.cn/d7f5dba6b4fe43ebbbf92689f13bc2cf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>编写测试代码</li></ul><p><img src="https://img-blog.csdnimg.cn/8be11a858220424f9e1112fa75551a8d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>可以直接点击顶部绿三角运行项目，项目将运行在 tomcat 上</li></ul><p><img src="https://img-blog.csdnimg.cn/02b3c7666fe443c18941f6351e725796.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>运行成功则出现如下界面</li></ul><p><img src="https://img-blog.csdnimg.cn/8bb5497d2661488b82418739bc645a65.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h2 id="个性化配置">个性化配置</h2><ul><li>进入到 Window -&gt; Preferences -&gt; Server -&gt; Launching 界面可以设置Launching 的效果</li></ul><p><img src="https://img-blog.csdnimg.cn/68096efcf3c1478a99a527622d6e3e73.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><h2 id="遇到的问题">遇到的问题</h2><ul><li><strong>The superclass "javax.servlet.http.HttpServlet" was not found on the Java Build Path</strong></li><li>解决办法</li><li>右击项目名 进入如下路径 点击 Configure Build Path</li></ul><p><img src="https://img-blog.csdnimg.cn/6cef1e6081d0455db5d8e7503302fc1d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>选择 Java Build Path，切换到 Libraries 标签页下，点击 ClassPath，然后点击 Add Library</li><li><a href="https://bbs.csdn.net/topics/392628907?list=10230532">Classpath 和 Modulepath 的区别</a>(本人暂时并不明白 Classpath 和 Modulepath 的区别，感兴趣的可以参考以上的文章)</li></ul><p><img src="https://img-blog.csdnimg.cn/b7d8e8ace2b44dcf98f676ec3c637cb7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>选择 Server Runtime</li></ul><p><img src="https://img-blog.csdnimg.cn/93bb59349e9f450da833d250767e4aa7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p><ul><li>选择配置好的 Tomcat，点击 Finish 即可解决(如果空白则表示 tomcat 配置失败)</li></ul><p><img src="https://img-blog.csdnimg.cn/4732000b6d5044ca8990aa6eff76bace.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Z6g5p2J,size_20,color_FFFFFF,t_70,g_se,x_16" /></p>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Eclipse</tag>
      
      <tag>Java Web</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Electron-vue出现GET http://localhost:9080/__webpack_hmr net::ERR_ABORTED解决方案</title>
    <link href="/2022/11/20/Electron-vue%E5%87%BA%E7%8E%B0ERR-ABORTED%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <url>/2022/11/20/Electron-vue%E5%87%BA%E7%8E%B0ERR-ABORTED%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<h2 id="使用版本">使用版本</h2><ul><li>以下是我解决此问题时使用的electron和vue等的一些版本信息</li></ul><figure><img src="https://img-blog.csdnimg.cn/b7cfc72382bd4247b81f8b269370a592.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA6Z6g5p2J,size_61,color_FFFFFF,t_70,g_se,x_16" alt="版本信息" /><figcaption aria-hidden="true">版本信息</figcaption></figure><ul><li>【附】经过测试 <code>electron</code> 的版本为 <code>13.1.4</code> 时也能解决</li></ul><h2 id="解决方案">解决方案</h2><ul><li>将项目下的 <code>.electron-vue/dev-runner.js</code> 文件打开</li><li>定位到第二个 <code>WebpackDevServer</code></li></ul><figure><img src="https://img-blog.csdnimg.cn/af8cafd21fb9445589638684a5910140.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA6Z6g5p2J,size_54,color_FFFFFF,t_70,g_se,x_16" alt="WebpackDevServer 位置图示" /><figcaption aria-hidden="true">WebpackDevServer 位置图示</figcaption></figure><ul><li>将第 <code>69</code> 行的注释打开</li></ul><figure><img src="https://img-blog.csdnimg.cn/49e10e6c5247402482fa3ff064acf636.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA6Z6g5p2J,size_39,color_FFFFFF,t_70,g_se,x_16" alt="69 行注释打开后图示" /><figcaption aria-hidden="true">69 行注释打开后图示</figcaption></figure><ul><li>重启项目即可解决 <code>GET http://localhost:9080/__webpack_hmr net::ERR_ABORTED</code> 报红的问题</li></ul><h2 id="解决总结">解决总结</h2><ul><li>感觉是因为之前 <code>app.use(hostMiddleware</code> 被注释，因此 <code>webpack-hot-middleware</code> 中间件未能被正常的加载而导致了热部署出现了问题。</li><li>当前对<code>webpack</code> 尚不了解，分析的有问题希望大佬指出。</li></ul>]]></content>
    
    
    <categories>
      
      <category>Solutions</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Electron</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>小程序的授权和获取userInfo</title>
    <link href="/2022/11/20/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8E%88%E6%9D%83%E5%92%8C%E8%8E%B7%E5%8F%96userInfo/"/>
    <url>/2022/11/20/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8E%88%E6%9D%83%E5%92%8C%E8%8E%B7%E5%8F%96userInfo/</url>
    
    <content type="html"><![CDATA[<h2 id="写在前面">写在前面</h2><ul><li>小程序官方在2021年4月28日后修改了<code>wx.getUserInfo</code>函数，所以导致目前网上大部分的文章已经不适用于解决目前小程序授权和获取userInfo的问题，此问题也是困扰了我一整天，算是初步解决，但解决方式比较粗糙，日后知识完善了会进一步修改。</li></ul><h2 id="新的函数">新的函数</h2><ul><li>我的授权是采用<code>wx.getUserProfile()</code>函数，此函数只能在用户操作时调用(重点)，因此配合以按钮进行，下面是我采取的一种做法。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">wx:if</span>=<span class="hljs-string">&quot;&#123;&#123;isShow&#125;&#125;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">wx:if</span>=<span class="hljs-string">&quot;&#123;&#123;!hasUserInfo&#125;&#125;&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;headView&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;headImageView&#x27;</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;headImage&#x27;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#x27;cloud://cloud-hwh.636c-cloud-hwh-1302901969/头像.png&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;titleText&#x27;</span>&gt;</span>申请获取以下权限<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;contentText&#x27;</span>&gt;</span>获得你的公开信息(昵称,头像,手机等)<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">wx:if</span>=<span class="hljs-string">&quot;&#123;&#123;canIUseGetUserProfile&#125;&#125;&quot;</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">&quot;getUserProfile&quot;</span>&gt;</span> 允许授权 <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><p>wxml和js设置的参数绑定(参数自行设置)，设置了一个按钮，并绑定了getUserProfile函数。</p></li><li><p>下面显示关于getUserProfile部分的js</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">getUserProfile</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-comment">// 推荐使用wx.getUserProfile获取用户信息，开发者每次通过该接口获取用户个人信息均需用户确认</span><br>    <span class="hljs-comment">// 开发者妥善保管用户快速填写的头像昵称，避免重复弹窗</span><br>    wx.<span class="hljs-title function_">getUserProfile</span>(&#123;<br>      <span class="hljs-attr">desc</span>: <span class="hljs-string">&#x27;完善个人资料&#x27;</span>, <span class="hljs-comment">// 声明获取用户个人信息后的用途，后续会展示在弹窗中，请谨慎填写</span><br>      <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-property">userInfo</span>)<br>        <span class="hljs-comment">//获取成功后将userInfo保存</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>(&#123;<br>          <span class="hljs-attr">userInfo</span>: res.<span class="hljs-property">userInfo</span>,<br>          <span class="hljs-attr">hasUserInfo</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-attr">isShow</span>: <span class="hljs-literal">false</span><br>        &#125;)<br>        <span class="hljs-comment">//将userInfo写入本地存储</span><br>        wx.<span class="hljs-title function_">setStorage</span>(&#123;<br>          <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;userInfo&quot;</span>,<br>          <span class="hljs-attr">data</span>: res.<span class="hljs-property">userInfo</span><br>        &#125;)<br>        <span class="hljs-comment">//调用获取本地存储的函数，将存储到本地的userInfo取出，存放到app.globalData.userInfo</span><br>        <span class="hljs-comment">//此处是为了将userInfo存到全局，以便其他页面使用</span><br>        app.<span class="hljs-title function_">getStorageUserInfo</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(app.<span class="hljs-property">globalData</span>.<span class="hljs-property">userInfo</span>)<br>          <span class="hljs-keyword">if</span> (app.<span class="hljs-property">globalData</span>.<span class="hljs-property">userInfo</span>) &#123;<br>            that.<span class="hljs-title function_">setData</span>(&#123;<br>              <span class="hljs-attr">userInfo</span>: app.<span class="hljs-property">globalData</span>.<span class="hljs-property">userInfo</span>,<br>              <span class="hljs-attr">hasUserInfo</span>: <span class="hljs-literal">true</span><br>            &#125;)<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(wx.<span class="hljs-property">getUserProfile</span>)<br>            <span class="hljs-keyword">if</span> (wx.<span class="hljs-property">getUserProfile</span>) &#123;<br>              that.<span class="hljs-title function_">setData</span>(&#123;<br>                <span class="hljs-attr">isShow</span>: <span class="hljs-literal">true</span>,<br>                <span class="hljs-attr">canIUseGetUserProfile</span>: <span class="hljs-literal">true</span><br>              &#125;)<br>            &#125;<br>          &#125;<br>        &#125;)<br>      &#125;<br>    &#125;)<br>  &#125;,<br></code></pre></td></tr></table></figure><ul><li>上面的代码实现授权和获取数据</li></ul><h2 id="解决重复授权">解决重复授权</h2><ul><li>为了让已授权的用户在使用时无需重复授权，在app.js中使用</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">getStorageUserInfo</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> that = <span class="hljs-variable language_">this</span>;<br>    <span class="hljs-comment">//进入页面获取是否授权----------------------------</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) &#123;<br>      wx.<span class="hljs-title function_">getSetting</span>(&#123;<br>        <span class="hljs-title function_">success</span>(<span class="hljs-params">res</span>) &#123;<span class="hljs-comment">//authSetting用户授权结果</span><br>          <span class="hljs-comment">//scope.userInfo</span><br>          <span class="hljs-keyword">if</span> (res.<span class="hljs-property">authSetting</span>[<span class="hljs-string">&#x27;scope.userInfo&#x27;</span>]) &#123;<span class="hljs-comment">//授权过</span><br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;授权过信息&#x27;</span>);<br>            <span class="hljs-comment">//获取本地存储中的userInfo</span><br>            <span class="hljs-keyword">let</span> userInfo = wx.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">&#x27;userInfo&#x27;</span>);<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userInfo)<br>            <span class="hljs-comment">//判断是否存在useInfo，如果存在则存储到globalData.userInfo中</span><br>            <span class="hljs-keyword">if</span> (userInfo != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>              that.<span class="hljs-property">globalData</span>.<span class="hljs-property">userInfo</span> = userInfo<br>            &#125;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(that.<span class="hljs-property">globalData</span>.<span class="hljs-property">userInfo</span>)<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;没有授权&#x27;</span>)<br>          &#125;<br>          <span class="hljs-comment">//对执行成功的数据传送</span><br>          <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&quot;调用成功&quot;</span>)<br>        &#125;<br>      &#125;)<br>    &#125;)<br><br>  &#125;,<br>  <span class="hljs-attr">globalData</span>: &#123;<br>    <span class="hljs-attr">userInfo</span>: <span class="hljs-literal">null</span><br>  &#125;<br></code></pre></td></tr></table></figure><h3 id="无法使用wx.getuserinfo或者wx.getuserprofile获取userinfo">无法使用<code>wx.getUserInfo</code>或者<code>wx.getUserProfile</code>获取userInfo</h3><ul><li><p><code>wx.getUserInfo()</code>仅能获取到匿名数据，这是在官方修改函数后导致的。</p></li><li><p>我采用将userInfo数据存入本地，每个小程序允许有10M的本地存储，用来解决<code>wx.getUserProfile()</code>函数只能在用户操作下调用(前面有讲过)，在js中无法直接调用的问题。</p></li><li><p>小程序的本地数据存取可以参考下面的文章</p></li></ul><blockquote><p><a href="https://www.cnblogs.com/pp8080/p/12019757.html">微信小程序中怎么存setStorage - 酷爱。 - 博客园</a></p></blockquote><h3 id="执行顺序问题">执行顺序问题</h3><ul><li><p>由于默认情况下主页面的onLoad函数要比app.js中的onLaunch函数先执行，所以在app.js中直接调用此函数无法实现判断用户是否需要授权，因此需要让onLoad函数中的操作在getStorageUserInfo函数之后执行(此函数在上面也有使用)</p></li><li><p>此处我采用Promise写法以解决这个问题(Promise写法可以参考下面的文章)</p></li></ul><blockquote><p><a href="https://blog.csdn.net/u012693479/article/details/98214802">小程序 ES6 Promise用法讲解_u012693479的博客-CSDN博客_小程序promise详解</a></p></blockquote><ul><li>下面看onLoad函数中的调用</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> that = <span class="hljs-variable language_">this</span>;<br>   <span class="hljs-comment">//在此处调用getStorageUserInfo,在执行后执行原本的操作</span><br>   app.<span class="hljs-title function_">getStorageUserInfo</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(app.<span class="hljs-property">globalData</span>.<span class="hljs-property">userInfo</span>)<br>     <span class="hljs-comment">//判断globalData.userInfo是否为空</span><br>     <span class="hljs-comment">//注意如果直接在app.js中调用，每次进入小程序时globalData.userInfo将一直为空，因为此处先于app.js执行</span><br>     <span class="hljs-keyword">if</span> (app.<span class="hljs-property">globalData</span>.<span class="hljs-property">userInfo</span>) &#123;<br>       that.<span class="hljs-title function_">setData</span>(&#123;<br>         <span class="hljs-attr">userInfo</span>: app.<span class="hljs-property">globalData</span>.<span class="hljs-property">userInfo</span>,<br>         <span class="hljs-attr">hasUserInfo</span>: <span class="hljs-literal">true</span><br>       &#125;)<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(wx.<span class="hljs-property">getUserProfile</span>)<br>       <span class="hljs-comment">//获取授权和userInfo</span><br>       <span class="hljs-keyword">if</span> (wx.<span class="hljs-property">getUserProfile</span>) &#123;<br>         that.<span class="hljs-title function_">setData</span>(&#123;<br>           <span class="hljs-attr">isShow</span>: <span class="hljs-literal">true</span>,<br>           <span class="hljs-attr">canIUseGetUserProfile</span>: <span class="hljs-literal">true</span><br>         &#125;)<br>       &#125;<br>     &#125;<br>   &#125;)<br></code></pre></td></tr></table></figure><ul><li><code>app</code>是在全局添加<code>var app = getApp()</code>而来的，这样使得在其他界面可以使用app.js中的全局变量和函数，即<code>globalData</code>和<code>getStorageUserInfo()</code>，使用方法可以参考这篇文章</li></ul><blockquote><p><a href="https://www.cnblogs.com/jiangtengteng/p/10531297.html">微信小程序 如何使用globalData - 姜腾腾 - 博客园</a></p></blockquote><ul><li>对于上面的问题还有两种办法可以解决，可以参考下面的文章</li></ul><blockquote><p><a href="https://www.cnblogs.com/shipskunkun/p/11802379.html">小程序Page里的函数比app.js先执行的解决办法 - shipskunkun - 博客园</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
      <category>Solutions</category>
      
    </categories>
    
    
    <tags>
      
      <tag>UserInfo</tag>
      
      <tag>Applet</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>create-electron-app安装配置</title>
    <link href="/2022/11/20/create-electron-app%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"/>
    <url>/2022/11/20/create-electron-app%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="写在前面">写在前面</h2><ul><li>本文章分为三个部分<ul><li>Node.js安装配置</li><li>Git安装配置</li><li>安装create-electron-app</li></ul></li><li>如果已安装过Node.js和Git可适当跳过</li><li>Node.js的配置较为重要，确保按教程修改</li><li>遇到一切问题请仔细分析报错</li><li>确保修改环境变量时所填路径无误</li></ul><h2 id="node.js安装配置">Node.js安装配置</h2><h3 id="下载">下载</h3><ul><li><p><a href="https://nodejs.org/en/">官网</a>下载node.js不建议使用最新版本</p></li><li><p>需要安装其他版本的可以访问，<a href="https://nodejs.org/download/release/">node.js其他版本</a></p></li><li><p>根据自己的系统选择对应的版本，此处以<code>v14.17.0</code>为例</p></li><li><p>下载<a href="https://nodejs.org/download/release/v14.17.0/node-v14.17.0-x64.msi">node-v14.17.0-x64.msi</a></p></li></ul><h3 id="安装">安装</h3><ul><li><p>运行<code>.msi</code>文件，除了修改安装路径，均点击下一步</p></li><li><p>安装完成后打开<code>cmd</code></p></li><li><p>执行<code>node -v</code>，如果正确显示版本则安装成功</p></li><li><p>执行<code>npm -v</code> ，如果正确显示版本则安装成功</p></li><li><p>如果安装路径为C盘，注意<code>cmd</code>用管理员身份打开</p></li><li><p>如果执行上面命令出错，检查环境变量是否正确。</p></li></ul><h3 id="配置">配置</h3><h4 id="配置npm安装全局模块和缓存路径">配置npm安装全局模块和缓存路径</h4><ul><li><p>在node.js的安装目录下新建两个文件夹 node_global和node_cache</p></li><li><p><code>cmd</code>执行<code>npm config set prefix "D:\nodejs\node_global"</code></p></li><li><p><code>cmd</code>执行<code>npm config set cache "D:\nodejs\node_cache"</code></p></li><li><p>执行成功后配置环境变量</p></li><li><p><strong>系统变量</strong>：新建系统变量，变量名<code>NODE_PATH</code>，变量值<code>D:\nodejs\node_modules</code></p></li><li><p><strong>用户变量</strong>：在Path中修改node的默认路径<code>C:\Users\users\AppData\Roaming\npm</code> 为<code>D:\nodejs\node_global</code></p></li><li><p><code>cmd</code>执行<code>npm install vue -g</code>，安装完成后查看<code>D:\nodejs\node_global\node_modules</code>路径下是否出现vue文件夹，出现则修改成功。</p></li><li><p>注意：上述要修改成的路径以自己的实际路径为准，关注<code>node_global</code>和<code>node_cache</code>即可。</p></li></ul><h4 id="修改npm镜像">修改npm镜像</h4><ul><li><p><code>cmd</code>执行如下命令</p></li><li><p><code>npm config set ELECTRON_MIRROR http://npm.taobao.org/mirrors/electron/</code></p></li><li><p>修改环境变量，新建用户变量</p></li><li><p>变量名<code>ELECTRON_MIRROR</code>，变量值<code>http://npm.taobao.org/mirrors/electron/</code></p></li><li><p>重启<code>cmd</code></p></li></ul><hr /><h2 id="git安装配置">Git安装配置</h2><h3 id="下载-1">下载</h3><ul><li><p><a href="https://npm.taobao.org/mirrors/git-for-windows/">国内镜像</a>下载</p></li><li><p>此处以<code>v2.30.0</code>为例</p></li><li><p>下载<a href="https://npm.taobao.org/mirrors/git-for-windows/v2.30.0.windows.1/Git-2.30.0-64-bit.exe">Git-2.30.0-64-bit.exe</a></p></li></ul><h3 id="安装-1">安装</h3><ul><li><p>运行<code>.exe</code>文件，除了修改安装路径，均点击下一步</p></li><li><p>安装完成后打开<code>cmd</code>执行<code>git --version</code></p></li><li><p>若未出现版本号，则检查系统环境变量</p></li></ul><hr /><h2 id="安装create-electron-app">安装create-electron-app</h2><h3 id="安装-2">安装</h3><ul><li><p>安装yarn，<code>cmd</code>执行<code>npm install yarn -g</code></p></li><li><p>安装create-electron-app，<code>cmd</code>执行<code>yarn global add create-electron-app</code></p></li><li><p>如果出现yarn不是可执行的命令，请检查环境变量的配置</p></li></ul><h3 id="配置-1">配置</h3><ul><li><p>create-electron-app将安装到<code>D:\nodejs\node_global\bin</code>目录下</p></li><li><p>用户变量的Path添加create-electron-app的安装目录，即添加<code>D:\nodejs\node_global\bin</code></p></li></ul><h3 id="测试">测试</h3><ul><li><p>到希望安装的目录下打开<code>cmd</code></p></li><li><p>执行<code>create-electron-app test</code>，即创建名为test的项目</p></li><li><p>如果报有关node install.js的错误</p></li><li><p>进入项目的<code>node_modules\electron\</code>下，<code>cmd</code>执行<code>node install.js</code></p></li><li><p>上述执行完成无报错后，可在<code>test\</code>下执行<code>npm start</code>，启动项目</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Electron</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java必考知识点整理</title>
    <link href="/2022/11/20/Java%E5%BF%85%E8%80%83%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/"/>
    <url>/2022/11/20/Java%E5%BF%85%E8%80%83%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="线程的生命周期">线程的生命周期</h2><p>线程的生命周期包含5个阶段，包括：新建、就绪、运行、阻塞、死亡。</p><ul><li><p>新建：对象由Thread类或者子类声明并创建，此时对象拥有相应的内存空间和其他资源；</p></li><li><p>就绪：在对象调用线程的start()方法后，这时候线程处于等待CPU分配资源阶段;</p></li><li><p>运行：当就绪的线程被调度并获得CPU资源时，便进入运行状态，run方法定义了线程的操作和功能;</p></li><li><p>阻塞：在运行状态的时候，可能因为某些原因导致运行状态的线程变成了阻塞状态，比如sleep()、wait()之后线程就处于了阻塞状态，这个时候需要其他机制将处于阻塞状态的线程唤醒，比如调用notify或者notifyAll()方法。唤醒的线程不会立刻执行run方法，它们要再次等待CPU分配资源进入运行状态;</p></li><li><p>死亡：如果线程正常执行完毕后或线程被提前强制性的终止或出现异常导致结束，那么线程就要被销毁，释放资源;</p></li></ul><h2 id="重载与覆盖">重载与覆盖</h2><table><thead><tr class="header"><th style="text-align: center;">区别</th><th style="text-align: center;">覆盖</th><th style="text-align: center;">重载</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">实现</td><td style="text-align: center;">子类对父类方法的重写</td><td style="text-align: center;">同一个类中建立多个同名方法</td></tr><tr class="even"><td style="text-align: center;">参数</td><td style="text-align: center;">与父类同名同参</td><td style="text-align: center;">与别的方法同名不同参</td></tr><tr class="odd"><td style="text-align: center;">权限</td><td style="text-align: center;">子类不能覆盖父类的private权限</td><td style="text-align: center;">无</td></tr><tr class="even"><td style="text-align: center;">返回值</td><td style="text-align: center;">与父类方法一致</td><td style="text-align: center;">无</td></tr></tbody></table><h3 id="发生重载的条件">发生重载的条件</h3><ul><li>对于类的方法（包括从父类中继承的方法），方法名相同，参数列表不同的方法之间就构成了重载关系。这里有两个问题需要注意：</li></ul><ol type="1"><li>什么叫参数列表不同？是指三样东西：<strong>参数的类型，参数的个数，参数的顺序</strong>，这三者只要有一个不同就叫做参数列表不同。</li><li>重载关系只能发生在同一个类中吗？非也。这时候你要深刻理解继承，要知道一个子类所拥有的成员除了自己显式写出来的以外，还有父类遗传下来的。所以子类中的某个方法和父类中继承下来的方法也可以发生重载的关系。</li></ol><h3 id="发生覆盖的条件">发生覆盖的条件：</h3><ol type="1"><li><p><strong>“三同一不低”</strong> 子类和父类的<strong>方法名称，参数列表，返回类型</strong>必须<strong>完全相同</strong>，而且子类方法的访问修饰符的权限不能比父类低。</p></li><li><p>子类方法不能抛出比父类方法更多的异常。即子类方法所抛出的异常必须和父类方法所<strong>抛出的异常一致</strong>，或者是其子类什么也不抛出；</p></li><li><p>被覆盖的方法不能是<strong>final类型</strong>的。因为final修饰的方法是无法覆盖的。</p></li><li><p>被覆盖的方法不能为<strong>private</strong>。否则在其子类中只是新定义了一个方法，并没有对其进行覆盖。</p></li><li><p>被覆盖的方法不能为<strong>static</strong>。所以如果父类中的方法为静态的，而子类中的方法不是静态的，但是两个方法除了这一点外其他都满足覆盖条件，那么会发生编译错误。反之亦然。即使父类和子类中的方法都是静态的，并且满足覆盖条件，但是仍然不会发生覆盖，因为静态方法是在编译的时候把静态方法和类的引用类型进行匹配。</p></li></ol><h2 id="面向对象编程的基本特性">面向对象编程的基本特性</h2><h3 id="继承性">继承性</h3><ul><li>程序中的继承性是指子类拥有父类的全部特征和行为，这是类之间的一种关系。Java 只支持<strong>单继承</strong>。</li></ul><h3 id="封装性">封装性</h3><ul><li>封装是将<strong>代码及其处理的数据绑定在一起</strong>的一种编程机制，该机制保证了程序和数据都不受外部干扰且不被误用。封装的目的在于<strong>保护信息</strong>，使用它的主要优点如下。</li></ul><ol type="1"><li>保护类中的信息，它可以阻止在外部定义的代码随意访问内部代码和数据。</li><li>隐藏细节信息，一些不需要程序员修改和使用的信息，比如取款机中的键盘，用户只需要知道按哪个键实现什么操作就可以，至于它内部是如何运行的，用户不需要知道。</li><li>有助于建立各个系统之间的松耦合关系，提高系统的独立性。当一个系统的实现方式发生变化时，只要它的接口不变，就不会影响其他系统的使用。例如 U 盘，不管里面的存储方式怎么改变，只要 U 盘上的 USB 接口不变，就不会影响用户的正常操作。</li><li>提高软件的复用率，降低成本。每个系统都是一个相对独立的整体，可以在不同的环境中得到使用。例如，一个 U 盘可以在多台电脑上使用。</li></ol><ul><li>Java 语言的基本封装单位是<strong>类</strong>。由于类的用途是封装复杂性，所以类的内部有隐藏实现复杂性的机制。Java 提供了<strong>私有和公有</strong>的访问模式，类的公有接口代表外部的用户应该知道或可以知道的每件东西，私有的方法数据只能通过该类的成员代码来访问，这就可以确保不会发生不希望的事情。</li></ul><h3 id="多态性">多态性</h3><ul><li>面向对象的多态性，即“<strong>一个接口，多个方法</strong>”。多态性体现在父类中定义的属性和方法被子类继承后，可以具有不同的属性或表现方式。多态性允许一个接口被多个同类使用，弥补了单继承的不足。</li></ul><h2 id="面向抽象编程">面向抽象编程</h2><ul><li>指当设计某种重要的类时，不让该类面向具体的类，而是面向抽象类，即设计类中的重要数据是抽象类声明的对象，而不是具体类声明的对象。</li></ul><h2 id="开闭原则">开闭原则</h2><ul><li>对扩展开放，对修改关闭。</li></ul><h2 id="线程同步">线程同步</h2><h3 id="概念">概念</h3><ul><li><p>是解决两个或者多个线程同时访问同一个变量，并且至少有一个线程需要修改这个变量时，如何确保不发生冲突和混乱问题的办法。</p><h3 id="实现">实现</h3></li><li><p>给若干个线程需要同时调用的方法添加<code>synchronized</code>修饰，即对其进行加锁。<font color=red>注意:同时调用的方法内需要对变量具有修改操作，且此变量为共有的变量，即只有涉及到共公变量多线程修改的时候才需要加锁</font></p></li><li><p>补充了解<code>Lock</code>接口</p></li></ul><h3 id="牢记">牢记</h3><ul><li>关于线程同步，需要牢牢记住的第一点是：线程同步就是线程排队。同步就是排队。线程同步的目的就是避免线程“同步”执行。这可真是个无聊的绕口令。</li><li>关于线程同步，需要牢牢记住的第二点是 “共享”这两个字。只有共享资源的读写访问才需要同步。如果不是共享资源，那么就根本没有同步的必要。</li><li>关于线程同步，需要牢牢记住的第三点是，只有“变量”才需要同步访问。如果共享的资源是固定不变的，那么就相当于“常量”，线程同时读取常量也不需要同步。至少一个线程修改共享资源，这样的情况下，线程之间就需要同步。</li><li>关于线程同步，需要牢牢记住的第四点是：多个线程访问共享资源的代码有可能是同一份代码，也有可能是不同的代码；无论是否执行同一份代码，只要这些线程的代码访问同一份可变的共享资源，这些线程之间就需要同步。</li></ul><blockquote><p>参考资料</p><p><a href="https://www.jianshu.com/p/6f98f03430eb">Java之多线程同步 - 简书</a></p><p><a href="https://www.cnblogs.com/findbetterme/p/10794410.html">Java中线程同步的理解 - FindBetterMe - 博客园</a></p></blockquote><h2 id="接口">接口</h2><ul><li><p>接口（英文：Interface），在JAVA编程语言中是一个抽象类型，是抽象方法的集合，接口通常以interface来声明。一个类通过继承接口的方式，从而来继承接口的抽象方法。</p></li><li><p>接口并不是类，编写接口的方式和类很相似，但是它们属于不同的概念。类描述对象的属性和方法。接口则包含类要实现的方法。</p></li><li><p>除非实现接口的类是抽象类，否则该类要定义接口中的所有方法。</p></li><li><p>接口无法被实例化，但是可以被实现。一个实现接口的类，必须实现接口内所描述的所有方法，否则就必须声明为抽象类。另外，在 Java 中，接口类型可用来声明一个变量，他们可以成为一个空指针，或是被绑定在一个以此接口实现的对象。</p></li></ul><h2 id="变量类型">变量类型</h2><h3 id="java语言支持的变量类型有">Java语言支持的变量类型有：</h3><ul><li>类变量：独立于方法之外的变量，<strong>用 static 修饰</strong>。(又称静态成员变量)</li><li>实例变量：独立于方法之外的变量，不过<strong>没有 static 修饰</strong>。</li><li>局部变量：类的方法中的变量。</li></ul><h3 id="实例变量和类变量的区别">实例变量和类变量的区别</h3><ul><li>不同对象的实例变量不同</li><li>所有对象共享类变量</li><li>通过类名直接访问类变量</li></ul><p><font color=red>注：类变量似乎破坏了分装性，其实不然，当对象调用实例方法时，该方法中出现的类变量也是该对象的变量，只不过这个变量和所有的其他对象共享而已。</font></p><h2 id="正则表达式">正则表达式</h2><h3 id="三个常用类">三个常用类</h3><p>java.util.regex 包主要包括以下三个类：</p><ul><li><p><strong>Pattern 类</strong>： pattern 对象是一个正则表达式的编译表示。Pattern 类没有公共构造方法。要创建一个 Pattern 对象，你必须首先调用其公共静态编译方法，它返回一个 Pattern 对象。该方法接受一个正则表达式作为它的第一个参数。</p></li><li><p><strong>Matcher 类</strong>： Matcher 对象是对输入字符串进行解释和匹配操作的引擎。与Pattern 类一样，Matcher 也没有公共构造方法。你需要调用 Pattern 对象的 matcher 方法来获得一个 Matcher 对象。</p></li><li><p><strong>PatternSyntaxException</strong>： PatternSyntaxException 是一个非强制异常类，它表示一个正则表达式模式中的语法错误。</p></li></ul><h3 id="捕获组">捕获组</h3><ul><li><p>捕获组是把多个字符当一个单独单元进行处理的方法，它通过对括号内的字符分组来创建。 例如，正则表达式 (123) 创建了单一分组，组里包含"1"，"2"，和"3"。</p></li><li><p>捕获组是通过从左至右计算其开括号来编号 例如，正则表达式 ( A ( B ( C ) ) ),则分为( A (B( C ) ) ),( B ( C ) ),( C ) <strong>计算心得</strong>：从左向右，依次根据<strong>左侧括号匹配右侧括号</strong>，则括号内的字符为一组。</p></li><li><p>可以通过调用 matcher 对象的 groupCount 方法来查看表达式有多少个分组。groupCount 方法返回一个 int 值，表示matcher对象当前有多个捕获组。</p></li><li><p>还有一个特殊的组（group(0)），它总是代表整个表达式。该组不包括在 groupCount 的返回值中。</p></li></ul><h3 id="正则表达式语法">正则表达式语法</h3><ul><li><p>在其他语言中(Perl,JS,PHP,Python,Ruby等)，<code>\</code>表示：我想要在正则表达式中插入一个普通的（字面上的）反斜杠，请不要给它任何特殊的意义。</p></li><li><p>在 Java 中，<code>\\</code> 表示：我要插入一个正则表达式的反斜线，所以其后的字符具有特殊的意义。 <font color=red>注：在Java中需要两个</font><code>\\</code><font color=red>表示一个</font><code>\</code><font color=red>这与C++,Go类似。</font></p></li></ul><blockquote><p>参考资料</p><p><a href="https://www.runoob.com/java/java-regular-expressions.html">Java 正则表达式 | 菜鸟教程</a></p></blockquote><h2 id="数据库">数据库</h2><h3 id="加载驱动">加载驱动</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//驱动程序名称</span><br><span class="hljs-type">String</span> <span class="hljs-variable">driver</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>;<br><span class="hljs-comment">//加载驱动</span><br>Class.forName(driver);<br></code></pre></td></tr></table></figure><h3 id="连接数据库">连接数据库</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//声明Connection对象</span><br><span class="hljs-type">Connection</span> <span class="hljs-variable">con</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-comment">//URL指向要访问的数据库名</span><br><span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;jdbc:mysql://127.0.0.1:3306/javastudy(此处为自己的数据库名)?serverTimezone=UTC&quot;</span>;<br><span class="hljs-comment">//用户名</span><br>String user=<span class="hljs-string">&quot;xxx&quot;</span>;<br><span class="hljs-comment">//密码</span><br>String password=<span class="hljs-string">&quot;xxx&quot;</span>;<br><span class="hljs-comment">//getConnection()方法，连接MySQL数据库！！</span><br>con = DriverManager.getConnection(url, user, password);<br><span class="hljs-keyword">if</span> (!con.isClosed())<br>    System.out.println(<span class="hljs-string">&quot;Succeeded connecting to the Database!&quot;</span>);<br></code></pre></td></tr></table></figure><h3 id="创建查询">创建查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//创建PreparedStatement对象执行sql语句</span><br><span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">statement</span> <span class="hljs-operator">=</span> con.prepareStatement(<span class="hljs-string">&quot;select * from score where id = ?;&quot;</span>);<br><span class="hljs-comment">//给sql语句中的？赋值(从1开始依次往后)</span><br>statement.setString(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;123&quot;</span>);<br><span class="hljs-comment">//执行sql语句并返回结果集</span><br><span class="hljs-type">ResultSet</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> statement.executeQuery();<br></code></pre></td></tr></table></figure><h3 id="处理结果集">处理结果集</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//定义存放查询返回结果的变量,类型与获取方式有关。</span><br>String id;<br><span class="hljs-keyword">while</span>(res.next())&#123;<br>    id = res.getString(<span class="hljs-string">&quot;id&quot;</span>) <span class="hljs-comment">//根据属性名返回结果集中的数据</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="释放结果集关闭连接">释放结果集，关闭连接</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//释放结果集</span><br>res.close();<br><span class="hljs-comment">//关闭连接</span><br>con.close();<br></code></pre></td></tr></table></figure><h2 id="uml类图">UML类图</h2><h3 id="类图基础属性">类图基础属性</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">-表示<span class="hljs-keyword">private</span><br>#表示<span class="hljs-keyword">protected</span><br>~表示<span class="hljs-keyword">default</span>,也就是包权限<br>_下划线表示<span class="hljs-keyword">static</span><br>斜体表示抽象<br></code></pre></td></tr></table></figure><h3 id="类与类之间的关系">类与类之间的关系</h3><ul><li>在UML类图中，常见的有以下几种关系:</li></ul><ol type="1"><li><p>泛化（Generalization）</p></li><li><p>实现（Realization）</p></li><li><p>关联（Association）</p></li><li><p>聚合（Aggregation）</p></li><li><p>组合（Composition）</p></li><li><p>依赖（Dependency）</p></li></ol><h3 id="泛化">泛化</h3><h4 id="继承">继承</h4><ul><li>表示方法：实线+空心三角形</li></ul><h4 id="实现-1">实现</h4><ul><li>表示方法：虚线+空心三角形</li></ul><h2 id="gui">GUI</h2><h3 id="常用组件">常用组件</h3><h4 id="顶层容器">顶层容器</h4><ul><li>JFrame 框架，一般被继承</li></ul><h4 id="中间容器">中间容器</h4><ul><li><p>JPanel 普通面板，<strong>最常用</strong></p></li><li><p>JTabbedPane 选项卡面板，<strong>用于需要切换界面</strong></p></li></ul><h4 id="控件">控件</h4><ul><li><p>JLabel 标签</p></li><li><p>JButton 按钮</p></li><li><p>JTextField 文本框，一般用于做输入框</p></li><li><p>JTextArea 文本域，一般用于做显示框</p></li><li><p>JMenu 菜单</p></li><li><p>JMenuItem 菜单项</p></li></ul><h3 id="常用布局">常用布局</h3><h4 id="flowlayout">FlowLayout</h4><ul><li><p>流式布局，从左向右排列，排满一行则换行</p></li><li><p>是JPanel的默认布局</p></li></ul><h4 id="gridlayout">GridLayout</h4><ul><li>网格布局，将面板按行列划分为相等的网格</li></ul><h4 id="cardlayout">CardLayout</h4><ul><li><p>卡片布局，将面板层叠放入容器</p></li><li><p>可以用来实现类似卡片面板的切换功能</p></li></ul><h3 id="常用方法">常用方法</h3><h4 id="关于容器">关于容器</h4><ul><li><p>setTitle() 设置标题</p></li><li><p>setSize() 设置窗口大小，(宽，高)</p></li><li><p>setVisible() 设置容器是否可见，true/false</p></li><li><p>setLayout() 设置布局，常和布局一起使用</p></li><li><p>setDefaultCloseOperation(EXIT_ON_CLOSE) 设置关闭操作</p></li><li><p>add() 添加容器，控件等</p></li></ul><h4 id="关于控件">关于控件</h4><ul><li><p>getText() 获取文字</p></li><li><p>setText() 设置文字</p></li><li><p>append() 文本域追加文字</p></li></ul><h4 id="监听事件">监听事件</h4><ul><li><p>ActionListener 接口</p><ul><li>重写ActionPerformed(ActionEvent e)函数</li></ul></li><li><p>KeyListener 接口</p><ul><li><p>keyTyped(KeyEvent e)</p></li><li><p>keyPressed(KeyEvent e)</p></li><li><p>keyReleased(KeyEvent e)</p></li></ul></li><li><p>FocusListener 接口</p><ul><li><p>focusGained(FocusEvent e)</p></li><li><p>focusLost(FocusEvent e)</p></li></ul></li></ul><h2 id="网络编程">网络编程</h2><ul><li><p>服务器端</p><ul><li><p>ServerSocket类</p></li><li><p>构造函数ServerSocket(port) 端口</p></li><li><p>方法 accept() 返回一个Socket对象</p></li></ul></li><li><p>客户端</p><ul><li><p>Socket类</p></li><li><p>构造函数Socket(ip, port) 服务器ip和端口</p></li></ul></li><li><p>传输</p><ul><li><p>DataInputStream(socket.getInputStream()) 通过此方法定义输入流对象</p></li><li><p>DataOutputStream(socket.getOutputStream()) 通过此方法定义输出流对象</p></li><li><p>readUTF() 从服务器/客户端接收数据</p></li><li><p>writeUTF() 向服务器/客户端发送数据</p></li></ul></li></ul><h2 id="io流">I/O流</h2><figure><img src="https://img-blog.csdnimg.cn/20190721043347273.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjM4NDA4NQ==,size_16,color_FFFFFF,t_70" alt="I/O流总结" /><figcaption aria-hidden="true">I/O流总结</figcaption></figure><blockquote><p><a href="https://blog.csdn.net/zhaoyanjun6/article/details/54292148">Java IO流学习总结一：输入输出流_赵彦军-CSDN博客</a></p></blockquote><h2 id="mvc结构">MVC结构</h2><h3 id="mvc即-model-模型view-视图及-controller-控制器">MVC，即 Model 模型、View 视图，及 Controller 控制器</h3><ul><li>View：视图，为用户提供使用界面，与用户直接进行交互。</li><li>Model：模型，承载数据，并对用户提交请求进行计算的模块。其分为两类： 一类称为数据承载 Bean：实体类，专门用户承载业务数据的，如 Student、User 等 一类称为业务处理 Bean：指 Service 或 Dao 对象，专门用于处理用户提交请求的。</li><li>Controller：控制器，用于将用户请求转发给相应的 Model 进行处理，并根据 Model 的计算结果向用户提供相应响应。</li></ul><h3 id="mvc-架构程序的工作流程">MVC 架构程序的工作流程</h3><ol type="1"><li><p>用户通过 View 页面向服务端提出请求，可以是表单请求、超链接请求、AJAX 请求等</p></li><li><p>服务端 Controller 控制器接收到请求后对请求进行解析，找到相应的 Model 对用户请求进行处理</p></li><li><p>Model 处理后，将处理结果再交给 Controller</p></li><li><p>Controller 在接到处理结果后，根据处理结果找到要作为向客户端发回的响应 View 页面。页面经渲染（数据填充）后，再发送给客户端。</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>Summarize</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>编译安装Vue-devtools</title>
    <link href="/2022/11/20/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85Vue-devtools/"/>
    <url>/2022/11/20/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85Vue-devtools/</url>
    
    <content type="html"><![CDATA[<h2 id="安装vue-devtool环境要求">安装Vue-devtool环境要求</h2><ul><li>安装环境要求node在6以上，npm在3以上</li><li>此教程测试使用的环境<ul><li>Vue-devtools add-remote-devtools</li><li>npm 6.14.13</li><li>node v14.17.0 ## clone 或者下载</li></ul></li><li>clone和下载地址 github网址: <a href="https://github.com/vuejs/vue-devtools/tree/add-remote-devtools">https://github.com/vuejs/vue-devtools/tree/add-remote-devtools</a> clone地址: <a href="https://github.com/vuejs/vue-devtools.git">https://github.com/vuejs/vue-devtools.git</a></li><li>若选择下载压缩包，先解压到需要的目录，建议修改文件夹名，此处我修改为<code>vue-devtools</code></li></ul><h2 id="npm-编译">npm 编译</h2><ul><li><p>打开<code>cmd</code>，切换到<code>vue-devtools</code>目录下</p></li><li><p>输入<code>npm install</code>，回车执行 <img src="https://img-blog.csdnimg.cn/20210607114721598.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述" /></p></li><li><p>待执行完毕后输入<code>npm run build</code>，回车执行 <img src="https://img-blog.csdnimg.cn/20210607114732359.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述" /></p></li></ul><h2 id="chrome-安装">Chrome 安装</h2><ul><li>打开谷歌浏览器-&gt;设置-&gt;更多工具-&gt;扩展程序</li><li>点击加载已解压的扩展程序</li><li>找到<code>vue-devtools</code>目录下的<code>shells</code>文件夹</li><li>选择<code>shells</code>文件夹中的<code>Chrome</code>文件夹</li><li>点击选择文件夹，安装成功</li></ul><h2 id="使用">使用</h2><ul><li>打开<code>cmd</code>，切换到<code>vue-devtools</code>目录下</li><li>执行<code>npm run dev</code></li><li>浏览器访问<a href="http://localhost:8080/">http://localhost:8080/</a></li><li>可查看vue实例</li><li>在使用vue编写的网页上，插件图标会亮起，点击可使用。</li></ul><h2 id="写在最后">写在最后</h2><ul><li>通过此教程安装的Vue-devtools版本为<code>Vue.js devtools 4.0.1</code>，而Chrome网上应用商店下载安装的版本为<code>Vue.js devtools 5.3.4</code>，尝试编译Vue-devtools的next版本，但编译失败，此问题仍需解决。</li><li>待学习vue.js后将详细介绍Vue-devtools的使用。</li></ul>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vs2019下创建的Qt项目发布并制作安装程序流程</title>
    <link href="/2022/11/18/vs2019%E4%B8%8B%E5%88%9B%E5%BB%BA%E7%9A%84Qt%E9%A1%B9%E7%9B%AE%E5%8F%91%E5%B8%83%E5%B9%B6%E5%88%B6%E4%BD%9C%E5%AE%89%E8%A3%85%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/"/>
    <url>/2022/11/18/vs2019%E4%B8%8B%E5%88%9B%E5%BB%BA%E7%9A%84Qt%E9%A1%B9%E7%9B%AE%E5%8F%91%E5%B8%83%E5%B9%B6%E5%88%B6%E4%BD%9C%E5%AE%89%E8%A3%85%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="写在前面">写在前面</h2><ul><li>梳理了如何制作安装教程的流程。</li><li>在以下测试环境中通过<ul><li>VS2019</li><li>Qt 5.14.2</li><li>Windows 10</li></ul></li><li>总结了网上主流教程没有的解决问题方法<ul><li><a href="#jump1">Qt项目拉取依赖</a></li><li><a href="#jump2"><code>Application Folder</code>下创建的文件夹，将不会自动创建</a></li><li><a href="#jump3">生成项目时报有警告</a></li></ul></li><li>文章没有图片，但十分详细如果环境相似请耐心阅读。</li></ul><h2 id="首先下载microsoft-visual-studio-installer-projects插件">首先下载Microsoft Visual Studio Installer Projects插件</h2><ul><li>项目下点击: 扩展-&gt;管理扩展-&gt;选择联机-&gt;搜索框输入<code>installer</code>搜索-&gt;安装插件-&gt;关闭所有vs界面后自动安装。</li></ul><h2 id="新建setup项目">新建Setup项目</h2><ul><li>项目下点击: 右键解决方案-&gt;添加-&gt;新建项目...-&gt;搜索<code>Setup</code>-&gt;选择<code>Setup Project</code>-&gt; 下一步直到创建好Setup项目</li></ul><h2 id="了解setup项目">了解Setup项目</h2><ul><li>vs在创建好Setup项目后会默认打开项目的文件系统，如果不慎关闭或者未打开可以依次点击: 右键Setup项目-&gt;view-&gt;文件系统(File System)</li><li>文件系统(File System)中主要分为三个文件夹<code>Application Folder</code>, <code>User's Desktop</code> ,<code>User'sPrograms Menu</code><ul><li><code>Application Folder</code> 存放主程序入口(主输出)、依赖(.dll)、图标(.ico)、卸载程序</li><li><code>User's Desktop</code> 存放桌面快捷方式</li><li><code>User's Programs Menu</code> 存放开始菜单的快捷方式 <span id="jump1"></span> ## Qt项目制作安装程序前准备</li></ul></li><li>vs生成Release版本的.exe: 点击调试-&gt;项目属性-&gt;点击配置管理器-&gt;检查是否为Release-&gt;点击生成-&gt;生成项目。</li><li>从Qt自带的控制台进入-&gt;将路径切换到生成的Release版本的.exe路径下-&gt;执行<code>windeployqt xxx.exe</code></li><li><code>xxx.exe</code>为你Qt项目的名称。</li><li>等待执行完毕则成功将Qt项目所需的依赖(.dll)，拉取到你的.exe文件目录下，此时双击.exe文件则可直接执行。</li></ul><h2 id="编辑setup项目">编辑Setup项目</h2><h3 id="首先添加主输出">首先添加主输出</h3><ul><li>右键<code>Application Folder</code>-&gt;Add-&gt;项目输出-&gt;主输出</li></ul><h3 id="添加依赖">添加依赖</h3><ul><li>右键<code>Application Folder</code>-&gt;Add-&gt;文件，选择需要的文件(.dll)</li></ul><h3 id="添加具有文件夹的依赖">添加具有文件夹的依赖</h3><ul><li>例如Qt项目所需的依赖一部分与.exe同级另一部分则在与.exe同级的文件夹下</li><li>右键<code>Application Folder</code>-&gt;Add-&gt;文件夹(Folder)-&gt;修改文件夹名称为依赖所需的文件夹名-&gt;单击打开文件夹-&gt;右侧右击-&gt;Add-&gt;文件，选择需要的文件(.dll) <span id="jump2"></span> ### 使文件夹在安装的时候创建</li><li>如果不做修改，在生成好<code>Setup.exe</code>和<code>Setup.msi</code>文件后，安装到电脑时，对于自己在<code>Application Folder</code>下创建的文件夹，将不会自动创建，因此会破坏目录结构，安装好的文件将因为无法找到依赖而无法运行。</li><li>解决方法: 右键自己创建的文件夹-&gt;单击属性窗口(F4)-&gt;修改属性窗口中的<code>AlwaysCreate</code>和<code>transitive</code>为<code>True</code></li></ul><h3 id="添加快捷方式">添加快捷方式</h3><ul><li>桌面快捷方式(Shortcut): 打开<code>User's Desktop</code>-&gt;右侧右击-&gt;创建新的快捷方式(C)-&gt;选择<code>Application Folder</code>(默认)-&gt;点击Ok或者双击<code>Application Folder</code>-&gt;选择主输出-&gt;创建后修改快捷方式的名字(此名字为桌面自动生成的快捷方式的名字)</li><li>开始菜单的快捷方式: 打开<code>User's Programs Menu</code>-&gt;后续步骤与创建桌面快捷方式无异。</li><li>如有多个文件需要连接到开始菜单，可以在开始菜单创建文件夹来存放: 右键<code>User's Programs Menu</code>-&gt;Add-&gt;文件夹(Floder)-&gt;修改文件夹为想要的名字-&gt;打开文件夹-&gt;后续步骤与创建桌面快捷方式无异。</li><li>开始菜单的文件夹会自动创建。</li></ul><h3 id="添加图标">添加图标</h3><ul><li>右键<code>Application Folder</code>-&gt;Add-&gt;文件，选择需要的图标文件(.ico)</li><li>给快捷方式添加图标: 单击创建好的快捷方式(Shortcut)-&gt;属性窗口中找到<code>Icon</code>-&gt;下拉框找到并单击<code>Browse</code>-&gt;再次点击弹出窗口的<code>Browse</code>-&gt;在<code>Application Folder</code>下找到需要的图标文件(.ico)-&gt;点击Ok添加完成。</li><li>所有快捷方式或者.exe只要属性窗口有<code>Icon</code>都可以参照上述步骤修改图标。 <span id="jump3"></span> ## 修改Setup项目属性</li><li>点击<code>Setup</code>项目，查看属性窗口</li><li>注意<code>Author</code>, <code>Manufacturer</code>,<code>ProductCode</code>,<code>TargetPlatform</code>,<code>Title</code></li><li>尤其注意<code>TargetPlatform</code>,默认为<code>x86</code>,如果项目生成的是<code>x64</code>版本的需要修改，否则会报警告。</li><li>还有一项属性为了更好的兼容,可以修改也可以不修改。</li><li>步骤: 右键<code>Setup</code>项目-&gt;点击属性-&gt;点击<code>Prerequisites</code>-&gt;勾选<code>Microsoft .NET Framework 4.6.1 (x86和x64)</code>-&gt;点击确定</li></ul><h2 id="生成setup项目">生成Setup项目</h2><ul><li>右键项目名生成</li><li>会生成<code>Setup.exe</code>和<code>Setup.msi</code>文件</li><li><code>Setup.exe</code>相当于<code>Setup.msi</code>的一个连接,使用<code>Setup.exe</code>安装时需要确保两个文件在同一目录下。</li></ul>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Qt</tag>
      
      <tag>Installer</tag>
      
      <tag>vs2019</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Intellij IDEA 2020.2.3 配置使用 Tomcat+Servlet</title>
    <link href="/2022/11/18/Intellij-IDEA-2020-2-3-%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8-Tomcat-Servlet/"/>
    <url>/2022/11/18/Intellij-IDEA-2020-2-3-%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8-Tomcat-Servlet/</url>
    
    <content type="html"><![CDATA[<h2 id="创建项目">创建项目</h2><ul><li>添加新项目如下图：</li></ul><figure><img src="https://img-blog.csdnimg.cn/20210517162520150.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" alt="添加新项目" /><figcaption aria-hidden="true">添加新项目</figcaption></figure><ul><li>弹出的窗口中选择<code>Java Enterprise</code>，点击<code>Next</code></li></ul><figure><img src="https://img-blog.csdnimg.cn/20210517162815563.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" alt="选择Java Enterprise" /><figcaption aria-hidden="true">选择Java Enterprise</figcaption></figure><ul><li>下一个界面中勾选<code>Servlet</code>，点击<code>Next</code></li></ul><p><img src="https://img-blog.csdnimg.cn/20210517163111308.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" /></p><ul><li>选择文件名和文件路径，点击<code>FInish</code></li></ul><p><img src="https://img-blog.csdnimg.cn/20210517163554264.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" /></p><h2 id="配置-tomcat-服务器">配置 Tomcat 服务器</h2><ul><li>若为在<code>Intellij IDEA</code> 中添加过<code>Tomcat Server</code>，则在<code>Setting</code>中设置添加自己安装的<code>tomcat</code>服务器，<code>tomcat</code>服务器安装可以参考<a href="https://hwh-2019.github.io/2022/11/18/Tomcat-PHP-Mysql环境配置/">Tomcat+PHP+Mysql环境配置</a></li></ul><p><img src="https://img-blog.csdnimg.cn/20210517164931586.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" /></p><ul><li>点击<code>Run</code>中的<code>Edit Configuration</code></li></ul><p><img src="https://img-blog.csdnimg.cn/20210517163832878.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" /></p><ul><li>点击添加<code>Tomcat Server</code></li></ul><p><img src="https://img-blog.csdnimg.cn/20210517164059685.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" /></p><ul><li><p>下方会警告<code>Warning: No artifacts marked for deployment</code>，切换到Deployment下。 <img src="https://img-blog.csdnimg.cn/20210517164356390.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" /></p></li><li><p>添加<code>build artifact</code>，点击<code>Ok</code></p></li></ul><p><img src="https://img-blog.csdnimg.cn/20210517164540814.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" /></p><h2 id="初步使用">初步使用</h2><h3 id="执行-jsp-文件">执行 jsp 文件</h3><ul><li>在<code>src/main/webapp</code>文件夹下新建文件<code>index.jsp</code></li></ul><p><img src="https://img-blog.csdnimg.cn/20210517171554670.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" /></p><ul><li><p><code>index.jsp</code>文件内容如下 <figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JSP">&lt;%@ page contentType=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="hljs-string">&quot;UTF-8&quot;</span> %&gt;<br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;JSP - Hello World&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt;&lt;%= <span class="hljs-string">&quot;Hello World!&quot;</span> %&gt;<br>&lt;/h1&gt;<br>&lt;br/&gt;<br>&lt;a href=<span class="hljs-string">&quot;hello-servlet&quot;</span>&gt;Hello Servlet&lt;/a&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure></p></li><li><p>点击运行启动服务，效果如下：</p></li></ul><p><img src="https://img-blog.csdnimg.cn/20210517171452430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" /></p><h3 id="执行-servlet">执行 Servlet</h3><ul><li>在<code>src/main/java</code>文件夹下新建包<code>servlet</code>，并在其中添加<code>HelloWorld.java</code>文件</li></ul><p><img src="https://img-blog.csdnimg.cn/20210517172058218.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" /></p><ul><li><code>HelloWorld.java</code>文件内容如下：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> servlet;<br><br><span class="hljs-comment">// 导入必需的 java 库</span><br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.*;<br><br><span class="hljs-comment">// 扩展 HttpServlet 类</span><br><span class="hljs-meta">@WebServlet(&quot;/Servlet&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloWorld</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String message;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ServletException<br>    &#123;<br>        <span class="hljs-comment">// 执行必需的初始化</span><br>        message = <span class="hljs-string">&quot;Hello World&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest request,</span><br><span class="hljs-params">                      HttpServletResponse response)</span><br>            <span class="hljs-keyword">throws</span> ServletException, IOException<br>    &#123;<br>        <span class="hljs-comment">// 设置响应内容类型</span><br>        response.setContentType(<span class="hljs-string">&quot;text/html&quot;</span>);<br><br>        <span class="hljs-comment">// 实际的逻辑是在这里</span><br>        <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> response.getWriter();<br>        out.println(<span class="hljs-string">&quot;&lt;h1&gt;&quot;</span> + message + <span class="hljs-string">&quot;&lt;/h1&gt;&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span><br>    &#123;<br>        <span class="hljs-comment">// 什么也不做</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>打开<code>src/main/webapp/WEB_INF</code>下的<code>web.xml</code>文件，在<code>&lt;web-app&gt;</code>中添加如下内容：</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>HelloWorld<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>servlet.HelloWorld<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>HelloWorld<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/HelloWorld<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>点击运行启动服务，浏览器访问切换到<code>HelloWorld</code>目录下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">http:<span class="hljs-comment">//localhost:8080/demo1_war_exploded</span><br><span class="hljs-comment">//由上面的路径切换到下面的路径</span><br>http:<span class="hljs-comment">//localhost:8080/demo1_war_exploded/HelloWorld</span><br></code></pre></td></tr></table></figure><ul><li>成功的效果如下：</li></ul><p><img src="https://img-blog.csdnimg.cn/2021051717310279.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" /></p><h2 id="tomcat-版本问题">Tomcat 版本问题</h2><p>如果使用<code>tomcat 10</code>版本，则上面切换到<code>HelloWorld</code>目录后会报错。 解决方法有两个： 1. 更换tomcat版本，安装<code>tomcat 9</code> 2. 手动导入<code>tomcat 10</code>所带的<code>servlet-api.jar</code></p><h3 id="手动导入-servlet-api.jar">手动导入 servlet-api.jar</h3><ul><li>打开<code>File</code>下<code>Project Structure</code>中的<code>Modules</code>，切换到<code>Dependencies</code></li></ul><p><img src="https://img-blog.csdnimg.cn/20210517174145999.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" /></p><ul><li>点击加号添加，选择自己<code>tomcat</code>路径<code>lib</code>下的<code>servlet-api.jar</code></li></ul><p><img src="https://img-blog.csdnimg.cn/2021051717445148.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" /></p><ul><li>打开项目下的<code>pom.xml</code>文件，删除如下内容：</li></ul><p><img src="https://img-blog.csdnimg.cn/20210517174816294.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" /></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>点击重新运行启动服务，浏览器访问切换到<code>HelloWorld</code>目录下，即可正常访问。</li></ul>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tomcat</tag>
      
      <tag>Servlet</tag>
      
      <tag>Intellij IDEA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Tomcat+PHP+Mysql环境配置</title>
    <link href="/2022/11/18/Tomcat-PHP-Mysql%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <url>/2022/11/18/Tomcat-PHP-Mysql%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="版本">版本</h2><ul><li>Tomcat 10.0.6</li><li>PHP 8.0.6</li><li>Mysql 8.0.21</li></ul><h2 id="tomcat-安装配置">Tomcat 安装配置</h2><ul><li>下载tomcat 从tomcat官网<a href="https://tomcat.apache.org/download-10.cgi">下载zip包</a></li><li>解压到自己想要的目录下</li><li>使用Tomcat之前需要JDK以及JAVA_HOME环境变量配置</li><li>修改<code>conf</code>文件下的<code>logging.properties</code>文件,<a href="https://blog.csdn.net/weixin_44580492/article/details/106358111">解决控制台乱码问题</a></li><li>配置tomcat环境变量，将<code>bin</code>目录路径添加到<code>path</code>下</li><li><code>cmd</code>下执行startup启动服务</li><li>浏览器输入<code>localhost:8080</code>,成功启动服务效果如下图:</li></ul><figure><img src="https://img-blog.csdnimg.cn/20210516194605404.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70#pic_center" alt="tomcat初始界面" /><figcaption aria-hidden="true">tomcat初始界面</figcaption></figure><h2 id="tomcat-配置-php">Tomcat 配置 PHP</h2><ul><li><a href="https://windows.php.net/download#php-7.0">官网下载php</a></li><li>将php解压到自己想要的目录下</li><li>复制一份<code>php.ini-development</code>,并改名为<code>php.ini</code></li><li>修改<code>php.ini</code>文件<ul><li>搜索定位到<code>extension_dir= "ext"</code>,去掉此行前的<code>;</code>,也可重写并指定<code>ext</code>文件夹的路径</li><li>搜索定位到<code>cgi.force_redirect</code>,改为<code>cgi.force_redirect=0</code></li></ul></li><li>回到<code>tomcat</code>所在目录下，打开<code>conf/context.xml</code>文件</li><li>将<code>&lt;context&gt;</code>标签加上<code>privileged = "true"</code>属性,即修改为<code>&lt;Context privileged="true"&gt;</code></li><li>打开<code>web.xml</code>文件,在添加<code>&lt;web-app&gt;</code>中添加如下代码：</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- ================== Built In Servlet Definitions ==================== --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>php<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.apache.catalina.servlets.CGIServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>clientInputTimeout<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>200<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>debug<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>executable<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- 此处为php-cgi.exe的路径，需要根据自己的文件路径进行修改 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>D:\tomcat\php\php-cgi.exe<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>passShellEnvironment<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>cgiPathPrefix<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- 此处与后文对应 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>WEB-INF/phpbin<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>注意修改<code>php-cgi.exe</code>的路径，路径为自己安装<code>php</code>的路径</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- ================ Built In Servlet Mappings ========================= --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>php<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/phpbin/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>重启服务</li><li>由于上面在<code>web.xml</code>中添加了<code>&lt;param-value&gt;WEB-INF/phpbin&lt;/param-value&gt;</code>,因此在<code>WEB-INF</code>下新建<code>phpbin</code>文件夹,并新建<code>index.php</code>作为测试。</li><li><code>index.php</code>的内容为:</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">phpinfo</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><ul><li>确保服务已启动,访问 <a href="http://localhost:8080/phpbin/index.php">http://localhost:8080/phpbin/index.php</a> 查看效果，正确效果如下：</li></ul><figure><img src="https://img-blog.csdnimg.cn/20210516194717224.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70#pic_center" alt="php验证" /><figcaption aria-hidden="true">php验证</figcaption></figure><h2 id="配置-tomcat-利用-jsp-连接-mysql">配置 Tomcat 利用 jsp 连接 Mysql</h2><ul><li>将mysql的jdbc驱动程序放到tomcat的lib中,如:<a href="https://download.csdn.net/download/h2763246823/18777147">mysql-connector-java-8.0.21.jar</a></li><li>在<code>ROOT</code>目录下新建<code>connect_mysql.jsp</code>文件,添加如下内容:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;%@ page language=<span class="hljs-string">&quot;java&quot;</span> <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.*&quot;</span> pageEncoding=<span class="hljs-string">&quot;gbk&quot;</span>%&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.sql.*&quot;</span> %&gt;<br>&lt;html&gt;<br>  &lt;head&gt;<br>    &lt;title&gt;My JSP starting page&lt;/title&gt;<br>  &lt;/head&gt;<br><br>  &lt;body&gt;<br>    &lt;span&gt;<br>     &lt;%<br>       try &#123;<br>//加载驱动<br>Class.forName(&quot;com.mysql.jdbc.Driver&quot;);<br>//URL指向要访问的数据库名<br>            String url = &quot;jdbc:mysql://127.0.0.1:3306/enwords?serverTimezone=UTC&quot;;<br>            //用户名<br>            String user=&quot;***&quot;;<br>            //密码<br>            String password=&quot;***&quot;;<br>//建立连接<br>Connection con=DriverManager.getConnection(url,user,password);<br>    //创建状态<br>Statement state=con.createStatement();<br>            //3.要执行的sql语句,需要读者自行修改<br>            String sql=&quot;select * from enwords limit 100,120;&quot;;<br>            //4.ResultSet类，用来存放获取的结果集！！<br>ResultSet rs=state.executeQuery(sql);<br><br>String word=null;<br>            String translation=null;<br>            String aString=&quot;&quot;;<br>            //读者请根据自己的数据库表修改打印内容。<br>while(rs.next())&#123;<br>    word=rs.getString(&quot;word&quot;);<br>                translation=rs.getString(&quot;translation&quot;);<br>aString+=word+&quot;\t&quot;+translation+&quot;&lt;br&gt;&quot;<br>+&quot;----------------------------&lt;br&gt;&quot;;<br>&#125;<br>out.println(aString);<br>state.close();<br>con.close();<br><br>&#125; catch (Exception e) &#123;<br>e.printStackTrace();<br>&#125;<br>     %&gt;<br>    &lt;/span&gt;<br>  &lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><ul><li>根据自己<code>mysql</code>情况修改用户名，密码，需要执行的sql语句。</li><li>不熟悉<code>JSP</code>语句的可以去<a href="https://www.runoob.com/jsp/jsp-database-access.html">菜鸟教程</a>学习。</li><li>确保tomcat服务已启动,访问 <a href="http://localhost:8080/connect_mysql.jsp">http://localhost:8080/connect_mysql.jsp</a> 查看效果。</li></ul><h2 id="配置-tomcat-利用-php-连接-mysql">配置 Tomcat 利用 PHP 连接 Mysql</h2><ul><li>为php添加mysql扩展,在<code>php.ini</code>中搜索定位<code>extension</code>,将下面两行前的<code>;</code>去掉</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">extension</span>=mysqli<br><span class="hljs-attr">extension</span>=pdo_mysql<br></code></pre></td></tr></table></figure><ul><li>在<code>WEB_INF/phpbin</code>下新建<code>connect_mysql.php</code>文件,并写入以下内容</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$servername</span> = <span class="hljs-string">&quot;localhost&quot;</span>;<br><span class="hljs-variable">$username</span> = <span class="hljs-string">&quot;***&quot;</span>;<span class="hljs-comment">//用户名</span><br><span class="hljs-variable">$password</span> = <span class="hljs-string">&quot;***&quot;</span>;<span class="hljs-comment">//密码</span><br><span class="hljs-variable">$dbname</span> = <span class="hljs-string">&quot;***&quot;</span>;<span class="hljs-comment">//数据库名</span><br><br><span class="hljs-comment">// 创建连接</span><br><span class="hljs-variable">$conn</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-variable">$servername</span>, <span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>, <span class="hljs-variable">$dbname</span>);<br><span class="hljs-comment">// 检测连接</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$conn</span>-&gt;connect_error) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;连接失败: &quot;</span> . <span class="hljs-variable">$conn</span>-&gt;connect_error);<br>&#125;<br><span class="hljs-comment">//sql语句,读者根据自己的数据库和表修改语句。</span><br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from enwords limit 0,100&quot;</span>;<br><br><span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;-------------------------------&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>-&gt;num_rows &gt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-comment">// 输出数据,请读者根据自己的表和打印要求进行修改。</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;strong&gt;word&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsptranslation&lt;/strong&gt;&lt;br&gt;&quot;</span>;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span> = <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">fetch_assoc</span>()) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;word&quot;</span>]. <span class="hljs-string">&quot;&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&quot;</span> .<br><span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;translation&quot;</span>] . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;-------------------------------&lt;br&gt;&quot;</span>;<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;0 结果&quot;</span>;<br>&#125;<br><span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">close</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><ul><li>根据自己的情况填入对应的用户名，密码，数据库名和sql语句。</li><li>不熟悉<code>php</code>语句的可以去<a href="https://www.runoob.com/php/php-mysql-intro.html">菜鸟教程</a>学习。</li><li>确保tomcat服务已启动，访问<a href="http://localhost:8080/phpbin/connect_mysql.php">http://localhost:8080/phpbin/connect_mysql.php</a> 查看效果。</li></ul><h2 id="可能遇到的问题解决">可能遇到的问题解决</h2><ul><li>如果<code>php</code>连接<code>mysql</code>出现<code>The server requested authentication method unknown to the client</code>报错</li><li><code>cmd</code>下登录数据库，执行如下语句修改密码。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p<br><br>use mysql;<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;你的密码&#x27;</span>;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tomcat</tag>
      
      <tag>PHP</tag>
      
      <tag>Mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>让你的电脑也识得二维码图片(二)</title>
    <link href="/2022/11/18/%E8%AE%A9%E4%BD%A0%E7%9A%84%E7%94%B5%E8%84%91%E4%B9%9F%E8%AF%86%E5%BE%97%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%9B%BE%E7%89%87-%E4%BA%8C/"/>
    <url>/2022/11/18/%E8%AE%A9%E4%BD%A0%E7%9A%84%E7%94%B5%E8%84%91%E4%B9%9F%E8%AF%86%E5%BE%97%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%9B%BE%E7%89%87-%E4%BA%8C/</url>
    
    <content type="html"><![CDATA[<h2 id="继续">继续</h2><p>之前写了一份能够让电脑识别二维码图片的脚本，详细参见<a href="https://hwh-2019.github.io/2022/11/18/让你的电脑也识得二维码图片-一/">《让你的电脑也识得二维码图片（一）》</a> 虽然已经可以做到比较方便的识别电脑上的二维码，但是还是需要将二维码图片下载到本地，然后才能识别，这就比较麻烦，正所谓没有最懒只有更懒，懒是人类进步的源泉。我便想能不能不用下载到本地就可以识别，并且让出现在所有场景下的二维码均可识别。 尝试了一些思路，都比较复杂，不易实现。</p><h2 id="主要问题">主要问题</h2><h3 id="获取图片">获取图片</h3><p>要实现不下载就识别，如何获取到图片是一个问题，目前二维码出现在各种网页，软件之中。 网页的话可以尝试插件，比如<a href="https://crxdoc-zh.appspot.com/extensions/devguide">chrome插件</a>。直接在浏览器中调用识别二维码的api对二维码进行识别。但本人不会，下次一定。 而软件中的就很难处理(你不可能强行修改软件)，你只有下载下来。</p><h2 id="新的思路">新的思路</h2><p>今天由QQ截图突然想到，可以直接从屏幕中截取出二维码进行识别，于是尝试着写一个类似QQ截图的软件然后保存到本地，搞到一半意识到，这太麻烦了，而且终归是保存到了本地，和下载没有区别，放弃。 但是QQ截图，其实并没有保存图片到本地，而是将图片保存到了剪切板中，想到这我突然产生了新的思路：</p><blockquote><p>从剪切板中获取二维码图像然后进行识别</p></blockquote><h2 id="实现">实现</h2><p>CSDN上搜索了一下发现了PIL中的ImageGrab模块 调用此模块</p><blockquote><p>from PIL import ImageGrab</p></blockquote><p>从剪切板获取</p><blockquote><p>image = ImageGrab.grabclipboard()</p></blockquote><p>然后就好了。</p><h2 id="右键">右键</h2><p>还是想用右键菜单操作，这次仍需要更改注册表，但位置和内容都不同，之前是针对所有图片的右键菜单，这次针对在不选中文件或文件夹情况下的右键菜单。 因此打开注册表编辑器，到计算机<code>\HKEY_CLASSES_ROOT\Directory\Background\shell\</code>路径下，新建名为 识别剪切板二维码 的项，再在此项下新建 command 项，修改数值数据为：<code>D:\Python\test\gcb_demo.bat</code></p><p>由于gcb_demo.py的执行无需传参，因此只需要指明路径即可。</p><p>.bat文件中也无需接收参数。</p><h2 id="最后">最后</h2><p>二维码识别功能还有待加强 源码放在<a href="https://gitee.com/HWHfile/recognize-qrcode/tree/master/Recognize%20Qrcode-grabclipboard">Gitee</a></p>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Shell</tag>
      
      <tag>ORcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>让你的电脑也识得二维码图片(一)</title>
    <link href="/2022/11/18/%E8%AE%A9%E4%BD%A0%E7%9A%84%E7%94%B5%E8%84%91%E4%B9%9F%E8%AF%86%E5%BE%97%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%9B%BE%E7%89%87-%E4%B8%80/"/>
    <url>/2022/11/18/%E8%AE%A9%E4%BD%A0%E7%9A%84%E7%94%B5%E8%84%91%E4%B9%9F%E8%AF%86%E5%BE%97%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%9B%BE%E7%89%87-%E4%B8%80/</url>
    
    <content type="html"><![CDATA[<h2 id="开始">开始</h2><p>昨日突发奇想，想在电脑上实现二维码图片的识别解码。因此查了点资料决定用python的pyzbar包写一个二维码解码的脚本。 首先pip安装pyzbar库：</p><blockquote><p>pip install pyzbar</p></blockquote><p>掏出python写下了如下程序：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> webbrowser<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">from</span> pyzbar <span class="hljs-keyword">import</span> pyzbar<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode_qr_code</span>(<span class="hljs-params">code_img_path</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(code_img_path):<br>        <span class="hljs-keyword">raise</span> FileExistsError(code_img_path)<br>    <span class="hljs-keyword">return</span> pyzbar.decode(Image.<span class="hljs-built_in">open</span>(code_img_path), symbols=[pyzbar.ZBarSymbol.QRCODE])<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    src = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;输入二维码路径：&quot;</span>)<br>    results = decode_qr_code(src)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(results):<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;http://&quot;</span> <span class="hljs-keyword">in</span> results[<span class="hljs-number">0</span>].data.decode(<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;https://&quot;</span> <span class="hljs-keyword">in</span> results[<span class="hljs-number">0</span>].data.decode(<span class="hljs-string">&quot;utf-8&quot;</span>):<br>            webbrowser.<span class="hljs-built_in">open</span>(results[<span class="hljs-number">0</span>].data.decode(<span class="hljs-string">&quot;utf-8&quot;</span>))<br>        <span class="hljs-built_in">print</span>(results[<span class="hljs-number">0</span>].data.decode(<span class="hljs-string">&quot;utf-8&quot;</span>))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Can not recognize.&quot;</span>)<br></code></pre></td></tr></table></figure><p>嗯，还不错，只需要运行python脚本输入二维码路径就可以打开识别了，而且做了分类，对于纯文本直接打印，对于网址则使用webbrowser使用默认浏览器打开网址。</p><h2 id="改进">改进</h2><p>虽然我觉得这个脚本还不错啦，可以实现二维码图片的识别解码了，但我觉得这个输入二维码图片路径不大方便（或许是我懒），还有就是每次运行都得找到这个python脚本，着实不大方便。 嗯，得想个办法无需找到python脚本就能直接执行，总不能放个python脚本在桌面吧太丑了。 突然我灵机一动想到了我们的右键菜单栏：</p><figure><img src="https://img-blog.csdnimg.cn/20210219104257525.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70" alt="右键菜单栏" /><figcaption aria-hidden="true">右键菜单栏</figcaption></figure><p>这玩意儿多方便啊，只需要找到二维码图片，然后右击打开菜单栏，然后执行脚本文件就好啦。 立马动手查找资料，看到右键菜单栏添加项需要修改注册表，嗯，按下win+r 输入regedit回车打开注册表编辑器，到计算机<code>\HKEY_CLASSES_ROOT\SystemFileAssociations\image\shell\</code>目录下新建一个项叫Recognize Qrcode（自己取的名字，会显示到右键菜单栏中，上图中有），然后再在Recognize Qrcode/下新建一个command项，双击名称修改其中的数值数据，起初我填的是(注意是英文 ")：<code>D:\Python\test\demo.py "%1"</code></p><p>退出注册表编辑器后右键图片确实可以出现新添加的Recognize Qrcode，但单击执行却提示：</p><p><img src="https://img-blog.csdnimg.cn/20210219105522355.png" /></p><p>哦豁，无法直接执行python脚本，查阅网上资料发现，可以写个.bat文件然后去执行python脚本，即将之前填写的数值数据改成(注意是英文 ")：<code>D:\Python\test\demo.bat "%1"</code></p><p>然后偷学一点批处理命令写了个.bat文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-built_in">cd</span>  d:\Python\<span class="hljs-built_in">test</span><br>d:<br>python demo.py %*<br>pause<br></code></pre></td></tr></table></figure><p>然后再次测试，果然能够成功通过右键菜单运行python脚本了。</p><h2 id="再改进">再改进</h2><p>虽然解决了去寻找python脚本的麻烦，但是还是得手动输入图片路径，这还是好麻烦，能不能在右键菜单运行python脚本的时候直接获取到图片的路径呢。 好的，继续查资料，查了半天还是把目光盯到了右键上，经过一番搜索，发现：</p><blockquote><p>右键的同时系统是会提取到图片的路径的</p></blockquote><p>呦吼，这不就是我想要的嘛。接着开始修改代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> webbrowser<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">from</span> pyzbar <span class="hljs-keyword">import</span> pyzbar<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode_qr_code</span>(<span class="hljs-params">code_img_path</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(code_img_path):<br>        <span class="hljs-keyword">raise</span> FileExistsError(code_img_path)<br>    <span class="hljs-keyword">return</span> pyzbar.decode(Image.<span class="hljs-built_in">open</span>(code_img_path), symbols=[pyzbar.ZBarSymbol.QRCODE])<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># 修改此处直接从系统得到了路径</span><br>    src = sys.argv[<span class="hljs-number">1</span>].replace(<span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>).replace(<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    results = decode_qr_code(src)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(results):<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;http://&quot;</span> <span class="hljs-keyword">in</span> results[<span class="hljs-number">0</span>].data.decode(<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;https://&quot;</span> <span class="hljs-keyword">in</span> results[<span class="hljs-number">0</span>].data.decode(<span class="hljs-string">&quot;utf-8&quot;</span>):<br>            webbrowser.<span class="hljs-built_in">open</span>(results[<span class="hljs-number">0</span>].data.decode(<span class="hljs-string">&quot;utf-8&quot;</span>))<br>        <span class="hljs-built_in">print</span>(results[<span class="hljs-number">0</span>].data.decode(<span class="hljs-string">&quot;utf-8&quot;</span>))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Can not recognize.&quot;</span>)<br></code></pre></td></tr></table></figure><p>测试运行成功。</p><h2 id="再加个小功能">再加个小功能</h2><p>既然右键的时候系统已经能获取到路径了，这不给我们平时复制文件路径提供了一个新思路嘛，按照如上流程可以写一个在右键菜单栏中直接获取到文件路径的脚本，将获取到的路径发送到剪切板中（提一句windows的剪切板真香，建议win+v打开）。 为了测试这个想法，我在这个二维码解码的脚本中也加入了这个功能。 使用subprocess将获取到的路径发到剪切板中：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> webbrowser<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">from</span> pyzbar <span class="hljs-keyword">import</span> pyzbar<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode_qr_code</span>(<span class="hljs-params">code_img_path</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(code_img_path):<br>        <span class="hljs-keyword">raise</span> FileExistsError(code_img_path)<br>    <span class="hljs-keyword">return</span> pyzbar.decode(Image.<span class="hljs-built_in">open</span>(code_img_path), symbols=[pyzbar.ZBarSymbol.QRCODE])<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># 添加此处将获取到的文件路径发送到剪切板</span><br>    cmd = <span class="hljs-string">&#x27;echo &#x27;</span> + sys.argv[<span class="hljs-number">1</span>].strip().replace(<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>) + <span class="hljs-string">&#x27;|clip&#x27;</span><br>    subprocess.check_call(cmd, shell=<span class="hljs-literal">True</span>)<br>    <span class="hljs-comment"># 修改此处直接从系统得到了路径</span><br>    src = sys.argv[<span class="hljs-number">1</span>].replace(<span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>).replace(<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    results = decode_qr_code(src)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(results):<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;http://&quot;</span> <span class="hljs-keyword">in</span> results[<span class="hljs-number">0</span>].data.decode(<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;https://&quot;</span> <span class="hljs-keyword">in</span> results[<span class="hljs-number">0</span>].data.decode(<span class="hljs-string">&quot;utf-8&quot;</span>):<br>            webbrowser.<span class="hljs-built_in">open</span>(results[<span class="hljs-number">0</span>].data.decode(<span class="hljs-string">&quot;utf-8&quot;</span>))<br>        <span class="hljs-built_in">print</span>(results[<span class="hljs-number">0</span>].data.decode(<span class="hljs-string">&quot;utf-8&quot;</span>))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Can not recognize.&quot;</span>)<br></code></pre></td></tr></table></figure><p>经测试完美实现此功能。</p><h2 id="最后">最后</h2><p>这个二维码识别功能还比较简陋，只能识别单张二维码，且图片必须保存到本地，还有较大的改进空间。 有更新想法的可以在评论提出。 源码及后续改进将发布在<a href="https://gitee.com/HWHfile/recognize-qrcode">Gitee</a></p>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
      <category>Tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Shell</tag>
      
      <tag>ORcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ORB_SLAM编译流程及相关报错处理</title>
    <link href="/2022/11/18/ORB-SLAM%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%A5%E9%94%99%E5%A4%84%E7%90%86/"/>
    <url>/2022/11/18/ORB-SLAM%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8A%A5%E9%94%99%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="写在前面">写在前面</h2><p><a href="http://webdiis.unizar.es/~raulmur/orbslam/">ORB-SLAM</a>是一种多功能且精确的单目SLAM解决方案，能够在各种环境下实时计算摄像机轨迹和稀疏的3D场景重建，从小型手持序列到在多个城市驾驶的汽车块。它能够关闭大型环路，并实时地从宽基线进行全局重新定位。 注意：本次编译使用的环境是安装在虚拟机中的Ubuntu18.04，且ORB_SLAM是基于ROS运行的，因此请确保已安装好linux环境及ROS系统。</p><h2 id="准备工作">准备工作</h2><h3 id="虚拟机及ros准备未使用虚拟机的可跳过此步">1.虚拟机及ROS准备(未使用虚拟机的可跳过此步)</h3><p>安装虚拟机，并安装好Ubuntu18.04以及ROS系统，详细教程可参见<a href="https://www.ngui.cc/51cto/show-23557.html">此处</a> 由于是在虚拟机中执行，需要让虚拟机连接到外接USB摄像头或者电脑本机摄像头，详细教程可参见<a href="https://blog.csdn.net/weixin_43849277/article/details/109061739">此处</a></p><h3 id="orb_slam所需环境准备">2.ORB_SLAM所需环境准备</h3><p>首先安装好opencv，网上教程颇多可以自行查阅。 然后使用如下两个命令分别安装boost和eigen3</p><blockquote><p>sudo apt-get install libboost-all-dev</p><p>sudo apt-get install libeigen3-dev</p></blockquote><p>详细内容可参考ORB_SLAM提供的README.md文档</p><h3 id="安装">3.安装</h3><h4 id="源码下载">1.源码下载</h4><p>访问<a href="https://github.com/raulmur/ORB_SLAM">ORB_SLAM在github上的地址</a>下载源码。 或者在终端执行如下命令：</p><blockquote><p>git clone https://github.com/raulmur/ORB_SLAM.git ORB_SLAM</p></blockquote><h4 id="添加环境变量">2.添加环境变量</h4><p>将克隆ORB_SLAM的路径添加到ROS_PACKAGE_PATH环境变量。为此，请修改.bashrc并在底部添加以下行（替换PATH_TO_PARENT_OF_ORB_SLAM）</p><blockquote><p>export ROS_PACKAGE_PATH=${ROS_PACKAGE_PATH}:PATH_TO_PARENT_OF_ORB_SLAM</p></blockquote><p>例如：如果ORB_SLAM文件夹在主文件夹中则将PATH_TO_PARENT_OF_ORB_SLAM替换为~/ORB_SLAM</p><h4 id="编译g2o和dbow2库">3.编译g2o和DBoW2库</h4><p>分别进入到Thirdparty/g2o/和Thirdparty/DBoW2/目录下执行如下命令：</p><blockquote><p>mkdir build cd build cmake .. -DCMAKE_BUILD_TYPE=Release make</p></blockquote><h4 id="编译orb_slam">4.编译ORB_SLAM</h4><p>退回到ORB_SLAM/目录下执行如下命令</p><blockquote><p>mkdir build cd build cmake .. -DCMAKE_BUILD_TYPE=Release make</p></blockquote><h2 id="编译orb_slam报错处理">编译ORB_SLAM报错处理</h2><h3 id="缺少opencv2">1.缺少opencv2</h3><p>报错如下图所示 <img src="https://img-blog.csdnimg.cn/20210219094426398.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70#pic_center" alt="缺少opencv2" /> 解决方法：删除manifest.xml文件中的 <code>&lt; depend package=“opencv2”/ &gt;</code> 行，如下图所示</p><figure><img src="https://img-blog.csdnimg.cn/20210219094558784.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70#pic_center" alt="修改manifest.xml" /><figcaption aria-hidden="true">修改manifest.xml</figcaption></figure><h3 id="缺少头文件">2.缺少头文件</h3><p>出现类似如下错误：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs cpp"> In member function ‘<span class="hljs-type">void</span> ORB_SLAM::ORBextractor::<span class="hljs-built_in">ComputeKeyPoints</span>(std::vector&lt;std::vectorcv::KeyPoint &gt;&amp;)’:<br>/home/jy/catkin_ws/src/ORB_SLAM-master/src/ORBextractor.cc:<span class="hljs-number">607</span>:<span class="hljs-number">63</span>: error: ‘FAST’ <span class="hljs-function">was <span class="hljs-keyword">not</span> declared in <span class="hljs-keyword">this</span> scope</span><br><span class="hljs-function"><span class="hljs-title">FAST</span><span class="hljs-params">(cellImage,cellKeyPoints[i][j],fastTh,<span class="hljs-literal">true</span>)</span></span>;<br>^<br>/home/jy/catkin_ws/src/ORB_SLAM-master/src/ORBextractor.cc:<span class="hljs-number">616</span>:<span class="hljs-number">34</span>: error: ‘ORB’ <span class="hljs-function">has <span class="hljs-keyword">not</span> been declared</span><br><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">( scoreType == ORB::HARRIS_SCORE )</span></span><br><span class="hljs-function">^</span><br><span class="hljs-function">/home/jy/catkin_ws/src/ORB_SLAM-master/src/ORBextractor.cc:<span class="hljs-number">683</span>:<span class="hljs-number">17</span>: error: ‘KeyPointsFilter’ has not been declared</span><br><span class="hljs-function">KeyPointsFilter::retainBest(keysCell,nToRetain[i][j]);</span><br>^<br>/home/jy/catkin_ws/src/ORB_SLAM-master/src/ORBextractor.cc:<span class="hljs-number">699</span>:<span class="hljs-number">13</span>: error: ‘KeyPointsFilter’ <span class="hljs-function">has <span class="hljs-keyword">not</span> been declared</span><br><span class="hljs-function"><span class="hljs-title">KeyPointsFilter::retainBest</span><span class="hljs-params">(keypoints,nDesiredFeatures)</span></span>;<br>^<br>/home/jy/catkin_ws/src/ORB_SLAM-master/src/ORBextractor.cc: In member function ‘<span class="hljs-type">void</span> ORB_SLAM::ORBextractor::<span class="hljs-built_in">operator</span>()(cv::InputArray, cv::InputArray, std::vectorcv::KeyPoint&amp;, cv::OutputArray)’:<br>/home/jy/catkin_ws/src/ORB_SLAM-master/src/ORBextractor.cc:<span class="hljs-number">760</span>:<span class="hljs-number">82</span>: error: ‘GaussianBlur’ <span class="hljs-function">was <span class="hljs-keyword">not</span> declared in <span class="hljs-keyword">this</span> scope</span><br><span class="hljs-function"><span class="hljs-title">GaussianBlur</span><span class="hljs-params">(workingMat, workingMat, Size(<span class="hljs-number">7</span>, <span class="hljs-number">7</span>), <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, BORDER_REFLECT_101)</span></span>;<br>^<br>/home/jy/catkin_ws/src/ORB_SLAM-master/src/ORBextractor.cc: In member function ‘<span class="hljs-type">void</span> ORB_SLAM::ORBextractor::<span class="hljs-built_in">ComputePyramid</span>(cv::Mat, cv::Mat)’:<br>/home/jy/catkin_ws/src/ORB_SLAM-master/src/ORBextractor.cc:<span class="hljs-number">800</span>:<span class="hljs-number">78</span>: error: ‘INTER_LINEAR’ <span class="hljs-function">was <span class="hljs-keyword">not</span> declared in <span class="hljs-keyword">this</span> scope</span><br><span class="hljs-function"><span class="hljs-title">resize</span><span class="hljs-params">(mvImagePyramid[level<span class="hljs-number">-1</span>], mvImagePyramid[level], sz, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, INTER_LINEAR)</span></span>;<br>^<br>/home/jy/catkin_ws/src/ORB_SLAM-master/src/ORBextractor.cc:<span class="hljs-number">800</span>:<span class="hljs-number">90</span>: error: ‘resize’ <span class="hljs-function">was <span class="hljs-keyword">not</span> declared in <span class="hljs-keyword">this</span> scope</span><br><span class="hljs-function"><span class="hljs-title">resize</span><span class="hljs-params">(mvImagePyramid[level<span class="hljs-number">-1</span>], mvImagePyramid[level], sz, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, INTER_LINEAR)</span></span>;<br>^<br>/home/jy/catkin_ws/src/ORB_SLAM-master/src/ORBextractor.cc:<span class="hljs-number">803</span>:<span class="hljs-number">80</span>: error: ‘INTER_NEAREST’ <span class="hljs-function">was <span class="hljs-keyword">not</span> declared in <span class="hljs-keyword">this</span> scope</span><br><span class="hljs-function"><span class="hljs-title">resize</span><span class="hljs-params">(mvMaskPyramid[level<span class="hljs-number">-1</span>], mvMaskPyramid[level], sz, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, INTER_NEAREST)</span></span>;<br>^<br>make[<span class="hljs-number">2</span>]: *** [CMakeFiles/ORB_SLAM-master.dir/src/ORBextractor.cc.o] 错误 <span class="hljs-number">1</span><br>make[<span class="hljs-number">1</span>]: *** [CMakeFiles/ORB_SLAM-master.dir/all] 错误 <span class="hljs-number">2</span><br>make: *** [all] 错误 <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>解决方法：添加缺少的头文件，我的出错是ORBextractor.cc文件，修改如下：</p><figure><img src="https://img-blog.csdnimg.cn/20210219095104204.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70#pic_center" alt="添加头文件" /><figcaption aria-hidden="true">添加头文件</figcaption></figure><h3 id="eigen3库的bug">3.Eigen3库的bug</h3><p>如果出现如下报错：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">/usr/local/include/eigen3/Eigen/src/Core/util/StaticAssert.h:<span class="hljs-number">32</span>:<span class="hljs-number">40</span>: error: <span class="hljs-type">static</span> assertion failed:<br>YOU_MIXED_DIFFERENT_NUMERIC_TYPES__YOU_NEED_TO_USE_THE_CAST_METHOD_OF_MATRIXBASE_TO_CAST_NUMERIC_TYPES_EXPLICITLY<br> <span class="hljs-meta">#<span class="hljs-keyword">define</span> EIGEN_STATIC_ASSERT(X,MSG) static_assert(X,#MSG);</span><br></code></pre></td></tr></table></figure><p>解决方法：打开Thirdparty/g2o/g2o/solvers/linear_solver_eigen.h，将以下代码：</p><blockquote><p>typedef Eigen::PermutationMatrix&lt;Eigen::Dynamic, Eigen::Dynamic, SparseMatrix::Index&gt; PermutationMatrix;</p></blockquote><p>替换为：</p><blockquote><p>typedef Eigen::PermutationMatrix&lt;Eigen::Dynamic, Eigen::Dynamic, int&gt; PermutationMatrix;</p></blockquote><p>如下图所示： <img src="https://img-blog.csdnimg.cn/20210219100103228.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70#pic_center" alt="修改eigen" /></p><h3 id="undefined-reference-to-symbol-_zn5boost6system15system_categoryev">4.undefined reference to symbol '_ZN5boost6system15system_categoryEv'</h3><p>解决方法：如果出现此错误修改CMakeLists.txt文件如下所示： <img src="https://img-blog.csdnimg.cn/20210219100345756.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70#pic_center" alt="修改CMakeLists.txt" /></p><h2 id="写在最后">写在最后</h2><p>所有ORB_SLAM编译流程均参考ORB_SLAM提供的README.md文档，如有疑问可以详细阅读此文档，或者评论区指出。 参考文档：</p><blockquote><p>https://github.com/raulmur/ORB_SLAM/blob/master/README.md https://www.ngui.cc/51cto/show-23557.html https://blog.csdn.net/weixin_43849277/article/details/109061739 https://www.geek-share.com/detail/2764681691.html https://blog.csdn.net/danmeng8068/article/details/83827245</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Tutorial</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SLAM</tag>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>彻底搞懂Java中的＞＞,＜＜,＞＞＞</title>
    <link href="/2022/11/18/%E5%BD%BB%E5%BA%95%E6%90%9E%E6%87%82Java%E4%B8%AD%E7%9A%84%EF%BC%9E%EF%BC%9E-%EF%BC%9C%EF%BC%9C-%EF%BC%9E%EF%BC%9E%EF%BC%9E/"/>
    <url>/2022/11/18/%E5%BD%BB%E5%BA%95%E6%90%9E%E6%87%82Java%E4%B8%AD%E7%9A%84%EF%BC%9E%EF%BC%9E-%EF%BC%9C%EF%BC%9C-%EF%BC%9E%EF%BC%9E%EF%BC%9E/</url>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>首先需要知道在Java基本数据类型中不存在无符号数，即全为有符号数，&gt;&gt;,&lt;&lt;,&gt;&gt;&gt;分别表示算术右移，算术左移，逻辑右移(无符号右移) 对于了解原码，反码，补码的读者可以直接跳过“有符号数的表示”部分</p><h2 id="有符号数的表示补充了解">有符号数的表示（补充了解）</h2><h3 id="原码">1.原码</h3><p>最左边一位二进制表示这个数的符号： ”0“代表正，”1“代表负。后面是它的”有效数字“。</p><p>一个字节存储的有符号数原码，有127个正数；有127个负数和2个”0“。</p><p>‘正’0：0 000 0000；‘负’0：1 000 0000；</p><h3 id="反码">2. 反码</h3><p>用最高位‘0’表示符号为正，‘1’表示符号为负。符号位之后的二进制位用来存储这个数的有效数字：正数的有效数字不变，负数的有效数字取反。</p><p>1字节存储有符号数反码，有127个正数，127个负数和2个“0”，</p><p>“正”0：0 000 0000， “负”0：1 111 1111.</p><h3 id="补码">3. 补码</h3><p>补码表示法仍然用最高有效位（MSB）表示一个有符号数的符号，“1”表示符号为负，“0”表示符号为正。</p><p>其他二进制位数用来存储这个数的有效数字。正数的有效数字不变，负数的有效数字取反后最低位加1.</p><h2 id="算术右移算术左移逻辑右移">算术右移，算术左移，逻辑右移</h2><h3 id="总述">1. 总述</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">&gt;&gt;   :  算术右移，num &gt;&gt; <span class="hljs-number">1</span>,低位溢出,高位补符号位,在十进制数值上相当于num除以<span class="hljs-number">2</span><br>&lt;&lt;   :  算术左移，num &lt;&lt; <span class="hljs-number">1</span>,高位溢出,低位补<span class="hljs-number">0</span>,在十进制数值上相当于num乘以<span class="hljs-number">2</span><br>&gt;&gt;&gt;  :  逻辑右移，忽略符号位，空位都以<span class="hljs-number">0</span>补齐<br></code></pre></td></tr></table></figure><h3 id="逻辑右移详解">2.逻辑右移详解</h3><p>我们知道在Java中Integer占用4个字节，32位，最高位为符号位。Java中的数值用补码表示。 #### 正数 根据上节知识可知，正数的补码等于原码，此处以10为例。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">10</span>在Java中的二进制表示为：<span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">1010</span><br>现在进行逻辑右移: <span class="hljs-number">10</span>&gt;&gt;&gt;<span class="hljs-number">2</span><br>逻辑右移后的二进制表示为：   <span class="hljs-number">00</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0010</span>   (未补齐)<br>逻辑右移后的二进制表示为： <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0010</span>   (<span class="hljs-number">0</span>补齐)<br></code></pre></td></tr></table></figure><h3 id="负数">负数</h3><p>此处以-10为例。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">-<span class="hljs-number">10</span>在java中的二进制表示为：<span class="hljs-number">1111</span> <span class="hljs-number">1111</span> <span class="hljs-number">1111</span> <span class="hljs-number">0110</span><br>现在进行逻辑右移:-<span class="hljs-number">10</span>&gt;&gt;&gt;<span class="hljs-number">2</span><br>逻辑右移后的二进制表示为：    <span class="hljs-number">11</span> <span class="hljs-number">1111</span> <span class="hljs-number">1111</span> <span class="hljs-number">1101</span>  (未补齐)<br>逻辑右移后的二进制表示为：  <span class="hljs-number">0011</span> <span class="hljs-number">1111</span> <span class="hljs-number">1111</span> <span class="hljs-number">1101</span>  (<span class="hljs-number">0</span>补齐)<br></code></pre></td></tr></table></figure><h3 id="测试代码">测试代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> test;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">test</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> -<span class="hljs-number">10</span>;<br><br>        <span class="hljs-comment">//本身二进制结果</span><br>        printInfo(num);<br><br>        <span class="hljs-comment">//右移2位后二进制结果</span><br>        printInfo(num&gt;&gt;<span class="hljs-number">2</span>);<br>        System.out.println(num&gt;&gt;<span class="hljs-number">2</span>);<br><br>        <span class="hljs-comment">//左移1位后二进制结果</span><br>        printInfo(num&lt;&lt;<span class="hljs-number">2</span>);<br>        System.out.println(num&lt;&lt;<span class="hljs-number">2</span>);<br><br>        <span class="hljs-comment">//逻辑右移(无符号右移)1位后二进制结果</span><br>        printInfo(num&gt;&gt;&gt;<span class="hljs-number">2</span>);<br>        System.out.println(num&gt;&gt;&gt;<span class="hljs-number">2</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//转二进制</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printInfo</span><span class="hljs-params">(<span class="hljs-type">int</span> num)</span>&#123;<br>        System.out.println(Integer.toBinaryString(num));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>读者可以自行修改测试。</p>]]></content>
    
    
    <categories>
      
      <category>Summarize</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>顺序表学习总结</title>
    <link href="/2022/11/17/%E9%A1%BA%E5%BA%8F%E8%A1%A8%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"/>
    <url>/2022/11/17/%E9%A1%BA%E5%BA%8F%E8%A1%A8%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h2 id="顺序表">顺序表</h2><p>顺序表，全名顺序存储结构，是<a href="https://blog.csdn.net/h2763246823/article/details/108021474">线性表</a>中的一种。</p><p>顺序表遵循线性表的存储逻辑关系为“一对一”的数据的特点。同时，顺序表对数据的物理存储结构也有特殊的要求：存储数据前需要申请一块足够大的物理空间，数据依次存入空间中，不留间隙。</p><p>例如，使用顺序表存储集合{1，2，3，4，5}，数据的最终存储状态如下图：</p><p><img src="https://img-blog.csdnimg.cn/20200818202543171.png#pic_center" alt="顺序存储结构示意图" /> 理解顺序表的存储结构时，可以参考数组的存储结构。 ## 顺序表的建立 ### 理论 #### 定义数据表 首先，我们需要明确顺序表的建立所需的组成部分。 <pre><code class=" mermaid">graph LRA(顺序表)--&gt;B(一段连续的物理空间)A--&gt; C(保存顺序表中元素个数的length,当前长度)A--&gt; D(保存顺序表最大存储元素个数的size,存储容量)</code></pre> <strong>注</strong>：</p><ol type="1"><li>囊括length 和 size 是为了方便后期使用表中的数据</li><li>正常情况下，size要大于length</li></ol><p><strong>步骤</strong>：</p><ol type="1"><li>声明一个长度不确定的数组,也叫“动态数组”</li><li>声明一个length保存顺序表的长度</li><li>声明一个size保存顺序表分配的存储容量</li></ol><h4 id="初始化顺序表">初始化顺序表</h4><p><strong>步骤</strong>：</p><ol type="1"><li>申请足够大小的物理空间</li><li>分别给size和length赋初值</li></ol><h3 id="实践">实践</h3><p>明确理论之后，我们就开始建立一个顺序表。 注：此处我采用C++模板编写</p><h4 id="定义顺序表">定义顺序表</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Table</span> &#123;<br><span class="hljs-keyword">private</span>:<br>T* head;<span class="hljs-comment">//声明一个长度不确定的数组,也叫“动态数组”</span><br><span class="hljs-type">int</span> length;<span class="hljs-comment">//声明一个length保存顺序表的长度</span><br><span class="hljs-type">int</span> size;<span class="hljs-comment">//声明一个size保存顺序表分配的存储容量</span><br><span class="hljs-comment">//顺序表的一些常规操作声明，目前可以不关注</span><br><span class="hljs-comment">//只是大致的功能，自己创建时可以自行修改。</span><br><span class="hljs-keyword">public</span>:<br><span class="hljs-built_in">Table</span>(<span class="hljs-type">int</span> size);<span class="hljs-comment">//顺序表的初始化</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(T value)</span></span>;<span class="hljs-comment">//尾部添加数据</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(T value, <span class="hljs-type">int</span> pos)</span></span>; <span class="hljs-comment">//中间插入数据</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">del</span><span class="hljs-params">(T value)</span></span>;<span class="hljs-comment">//删除指定数据</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">change</span><span class="hljs-params">(T value, <span class="hljs-type">int</span> pos)</span></span>;<span class="hljs-comment">//改变指定位置的数据</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">show</span><span class="hljs-params">()</span></span>;<span class="hljs-comment">//显示表中全部数据</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(T value)</span></span>;<span class="hljs-comment">//查询数据</span><br>T <span class="hljs-keyword">operator</span>[](<span class="hljs-type">int</span> i); <span class="hljs-comment">//[]操作符重载</span><br>&#125;;<br></code></pre></td></tr></table></figure><h4 id="初始化顺序表-1">初始化顺序表</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br>Table&lt;T&gt;::<span class="hljs-built_in">Table</span>(<span class="hljs-type">int</span> size) &#123;<br>head = <span class="hljs-keyword">new</span> T[size];<span class="hljs-comment">//动态申请存储空间</span><br>length = <span class="hljs-number">0</span>;<span class="hljs-comment">//空表的长度初始化为0</span><br><span class="hljs-keyword">this</span>-&gt;size = size;<span class="hljs-comment">//空表的存储容量为size</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="顺序表的使用">顺序表的使用</h3><h4 id="添加数据">添加数据</h4><p><strong>步骤</strong>：</p><ol type="1"><li>判断是否需要扩容，需要则扩容，size+1</li><li>将数据存入表中下标为length的位置，length+1</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-type">void</span> Table&lt;T&gt;::<span class="hljs-built_in">add</span>(T values) &#123;<br><span class="hljs-keyword">if</span> (length == size) &#123;<br>T* temp = <span class="hljs-keyword">new</span> T[size + <span class="hljs-number">1</span>];<br><span class="hljs-comment">//注意对head中的数据进行保存</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br>temp[i] = head[i];<br>&#125;<br><span class="hljs-keyword">delete</span>[] head;<br>head = temp;<br>size++;<br>&#125;<br><span class="hljs-type">int</span> i = length;<br>head[i] = values;<br>length++;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="插入数据">插入数据</h4><p><strong>步骤</strong>：</p><ol type="1"><li>判断插入位置是否正确</li><li>判断是否需要扩容，需要则扩容，size+1</li><li>将要插入位置数据以及后续数据整体向后移动一个位置</li><li>将元素放到腾出来的位置上，length+1</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-type">void</span> Table&lt;T&gt;::<span class="hljs-built_in">insert</span>(T values, <span class="hljs-type">int</span> pos) &#123;<br><span class="hljs-keyword">if</span> (pos&lt;<span class="hljs-number">1</span> || pos&gt;length + <span class="hljs-number">1</span>) &#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;元素插入位置有误&quot;</span> &lt;&lt; endl;<br><span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (length == size) &#123;<br>T* temp = <span class="hljs-keyword">new</span> T[size + <span class="hljs-number">1</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br>temp[i] = head[i];<br>&#125;<br><span class="hljs-keyword">delete</span>[] head;<br>head = temp;<br>size++;<br>&#125;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = length - <span class="hljs-number">1</span>; i &gt;= pos - <span class="hljs-number">1</span>; i--) &#123;<br>head[i + <span class="hljs-number">1</span>] = head[i];<br>&#125;<br>head[pos - <span class="hljs-number">1</span>] = values;<br>length++;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="删除数据">删除数据</h4><p><strong>步骤</strong>：</p><ol type="1"><li>遍历找到目标数据的位置</li><li>将后续数据整体向前移动一个位置，length-1</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-type">void</span> Table&lt;T&gt;::<span class="hljs-built_in">del</span>(T values) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br><span class="hljs-keyword">if</span> (head[i] == values) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = i+<span class="hljs-number">1</span>; j &lt; length; j++) &#123;<br>head[j - <span class="hljs-number">1</span>] = head[j];<br>&#125;<br>&#125;<br>&#125;<br>length--;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="修改数据">修改数据</h4><p><strong>步骤</strong>：</p><ol type="1"><li>遍历找到目标数据的位置</li><li>直接修改数据的值</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-type">void</span> Table&lt;T&gt;::<span class="hljs-built_in">change</span>(T values, <span class="hljs-type">int</span> pos) &#123;<br>head[pos - <span class="hljs-number">1</span>] = values;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="显示数据">显示数据</h4><p><strong>步骤</strong>：遍历输出</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-type">void</span> Table&lt;T&gt;::<span class="hljs-built_in">show</span>() &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; length;i++) &#123;<br>cout &lt;&lt; head[i] &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>&#125;<br>cout &lt;&lt; endl;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="查询数据">查询数据</h4><p>注： 可以使用多种算法实现查找，比如说二分查找算法，插值查找算法等。 这里使用 顺序查找算法 <strong>步骤</strong>：遍历匹配目标数据</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-type">int</span> Table&lt;T&gt;::<span class="hljs-built_in">query</span>(T values) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br><span class="hljs-keyword">if</span> (head[i] == values) &#123;<br><span class="hljs-keyword">return</span> i+<span class="hljs-number">1</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Summarize</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>数据结构</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java基础语法总结</title>
    <link href="/2022/11/17/Java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/"/>
    <url>/2022/11/17/Java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h2 id="基本概念和数据类型">基本概念和数据类型</h2><h3 id="基本概念">基本概念</h3><ul><li><strong>标识符（identifier）</strong></li></ul><ol type="1"><li>用来表示的有效字符序列：类、变量、方法、数组、文件</li><li>命名规则：<ol type="1"><li>以字母、下划线或货币符号开始,后跟上述三种符号和数字(0-9)，字母不限于英文字母，货币符号除$,也可以是其他符号如￥。</li><li>不能使用其他特殊符号，如: +、@、&amp;、空格等。</li><li>不能与Java关键字同名</li><li>英文字母大小写敏感</li><li>长度无最大长度的限制 （建议 小于255个字符）</li></ol></li></ol><ul><li><strong>关键字</strong></li></ul><ol type="1"><li>Java语言本身必须使用的标识符</li><li>保留字是Java语言保留起来不允许用户使用的标识符</li><li>关键字（保留字）均用小写字母表示 ### 数据类型</li></ol><ul><li><strong>简单数据类型</strong></li></ul><ol type="1"><li>整数类型 (Integer)： byte， short， int (默认) ，long　</li><li>浮点类型 (Floating)：float，double (默认)</li><li>字符类型 (Textual)： char　</li><li>布尔类型 (Logical)： boolean</li></ol><ul><li><strong>引用（复合）数据类型</strong> interface 数组 class Vector Date HashMap … … String Unicode字符集16位 0~65535</li></ul><h2 id="简单数据类型优先级和转换">简单数据类型优先级和转换</h2><ul><li><p><strong>简单类型数据的优先级</strong> byte,short,char &lt; int &lt; long &lt; float &lt; double (由低到高）</p></li><li><p><strong>自动类型转换</strong> 当两个简单数据类型的数据进行二元运算，要先将两个操作数转换成同一类型的数据，再进行运算。 自动类型转换规则：</p></li></ul><table><thead><tr class="header"><th style="text-align: center;">操作数1类型</th><th style="text-align: center;">操作数2类型</th><th style="text-align: center;">类型转换</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">byte、short、char</td><td style="text-align: center;">int　</td><td style="text-align: center;">int</td></tr><tr class="even"><td style="text-align: center;">byte、short、char、int</td><td style="text-align: center;">long</td><td style="text-align: center;">　long</td></tr><tr class="odd"><td style="text-align: center;">byte、short、char、int、long</td><td style="text-align: center;">　float</td><td style="text-align: center;">float</td></tr><tr class="even"><td style="text-align: center;">byte、short、char、int、long、float</td><td style="text-align: center;">double</td><td style="text-align: center;">double</td></tr></tbody></table><ul><li><strong>强制类型转换</strong> 高优先级数据要转换成低优先级数据，需用强制类型转换。 强制类型转换一般存在数据精度损失。 强制类型转换格式： 目标类型 目标变量名=（目标类型）原变量名</li></ul><h2 id="运算符">运算符</h2><ul><li><strong>算术运算符</strong></li></ul><table><thead><tr class="header"><th style="text-align: center;">运算符</th><th style="text-align: center;">含义</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">+</td><td style="text-align: center;">加</td></tr><tr class="even"><td style="text-align: center;">-</td><td style="text-align: center;">减</td></tr><tr class="odd"><td style="text-align: center;">*</td><td style="text-align: center;">乘</td></tr><tr class="even"><td style="text-align: center;">/</td><td style="text-align: center;">除</td></tr><tr class="odd"><td style="text-align: center;">%</td><td style="text-align: center;">取余（取模）</td></tr><tr class="even"><td style="text-align: center;">++</td><td style="text-align: center;">自增</td></tr><tr class="odd"><td style="text-align: center;">--</td><td style="text-align: center;">自减</td></tr></tbody></table><ul><li><strong>位运算符</strong></li></ul><table><thead><tr class="header"><th style="text-align: center;">运算符</th><th style="text-align: center;">含义</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">&amp;</td><td style="text-align: center;">与</td></tr><tr class="even"><td style="text-align: center;"><code>|</code></td><td style="text-align: center;">或</td></tr><tr class="odd"><td style="text-align: center;">^</td><td style="text-align: center;">异或</td></tr><tr class="even"><td style="text-align: center;">&lt;&lt;</td><td style="text-align: center;">左移</td></tr><tr class="odd"><td style="text-align: center;">&gt;&gt;</td><td style="text-align: center;">算术右移</td></tr><tr class="even"><td style="text-align: center;">&gt;&gt;&gt;</td><td style="text-align: center;">逻辑右移</td></tr></tbody></table><p>注：对于&gt;&gt;,&lt;&lt;,&gt;&gt;&gt;详解请参见<a href="https://blog.csdn.net/h2763246823/article/details/113813970">《彻底搞懂Java中的＞＞,＜＜,＞＞＞》</a></p><ul><li><strong>赋值运算符</strong></li></ul><table><thead><tr class="header"><th style="text-align: center;">运算符</th><th style="text-align: center;">含义</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">=</td><td style="text-align: center;">赋值</td></tr><tr class="even"><td style="text-align: center;">+=</td><td style="text-align: center;">加赋值</td></tr><tr class="odd"><td style="text-align: center;">-=</td><td style="text-align: center;">减赋值</td></tr><tr class="even"><td style="text-align: center;">*=</td><td style="text-align: center;">乘赋值</td></tr><tr class="odd"><td style="text-align: center;">/=</td><td style="text-align: center;">除赋值</td></tr><tr class="even"><td style="text-align: center;">%=</td><td style="text-align: center;">取余（取模）赋值</td></tr></tbody></table><p>注：以+=为例，a+=1等价于a=a+1。</p><ul><li><strong>关系运算符</strong></li></ul><table><thead><tr class="header"><th style="text-align: center;">运算符</th><th style="text-align: center;">含义</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">&lt;</td><td style="text-align: center;">小于</td></tr><tr class="even"><td style="text-align: center;">&lt;=</td><td style="text-align: center;">小于等于</td></tr><tr class="odd"><td style="text-align: center;">&gt;</td><td style="text-align: center;">大于</td></tr><tr class="even"><td style="text-align: center;">&gt;=</td><td style="text-align: center;">大于等于</td></tr><tr class="odd"><td style="text-align: center;">==</td><td style="text-align: center;">等于</td></tr><tr class="even"><td style="text-align: center;">!=</td><td style="text-align: center;">不等于</td></tr></tbody></table><ul><li><strong>逻辑运算符</strong></li></ul><table><thead><tr class="header"><th style="text-align: center;">运算符</th><th style="text-align: center;">含义</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">&amp;&amp;</td><td style="text-align: center;">逻辑与</td></tr><tr class="even"><td style="text-align: center;"><code>||</code></td><td style="text-align: center;">逻辑或</td></tr><tr class="odd"><td style="text-align: center;">!</td><td style="text-align: center;">逻辑非</td></tr></tbody></table><ul><li><strong>条件运算符</strong> ? : 运算符 格式：条件表达式 ？表达式1：表达式2 含义：如果<条件表达式>为真，则执行<表达式1>，否则，<执行表达式2></li></ul><h2 id="inputoutput-statement">input/output statement</h2><ul><li><strong>input statement</strong> 标准的输入设备是键盘库 java.util.Scanner (after JDK1.5)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//导入库</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-comment">//import java.util.Scanner也行</span><br><br><span class="hljs-comment">//创建对象</span><br>Scanner Input=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br><span class="hljs-comment">//调用方法</span><br>Input.nextInt()      <span class="hljs-comment">//read int data</span><br>Input.nextByte() <span class="hljs-comment">//read byte data</span><br></code></pre></td></tr></table></figure><h2 id="流程控制语句">流程控制语句</h2><ul><li><strong>分支语句</strong></li></ul><ol type="1"><li><strong>if</strong>语句</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span>(<span class="hljs-type">boolean</span>-expression)<br>statement;<br></code></pre></td></tr></table></figure><p>功能：当boolean-expression为“真”时，执行statement 。 2. <strong>if else</strong>语句 格式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span>(<span class="hljs-type">boolean</span>-expression)<br> statement1；<br><span class="hljs-keyword">else</span> statement2；<br></code></pre></td></tr></table></figure><p>功能：当 boolean-expression为“真”时，执行statement1； 否则，执行statement 2。 3. <strong>switch</strong>语句</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">switch</span>(expression)&#123;<br>      <span class="hljs-keyword">case</span> value1：statement1;<br>           <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> value2：statement2;<br>           <span class="hljs-keyword">break</span>;<br>         ┆         ┆<br>      <span class="hljs-keyword">case</span> valueN：statementN;<br>           <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">default</span> : defaultStatement;<br>&#125;<br></code></pre></td></tr></table></figure><p>功能：将expression的值与value1~valueN匹配，如果匹配则执行对应的statement，然后退出；否则 执行defaultStatement。</p><ul><li><strong>循环语句</strong></li></ul><ol type="1"><li><strong>for</strong>语句</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span>(initialization; termination; iteration)&#123;　　　　<br><span class="hljs-comment">//body</span><br>&#125;<br></code></pre></td></tr></table></figure><p>功能：首先对循环条件（通常为i）进行initialization（初始化），然后执行termination（判断是否终止循环），然后执行循环体里的语句，最后执行iteration（循环条件i改变）</p><ol start="2" type="1"><li><strong>while</strong>语句</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">initialization<br><span class="hljs-title function_">while</span><span class="hljs-params">(termination)</span>&#123;　　　<br><span class="hljs-comment">//body;　      　</span><br>iteration;<br>&#125;<br></code></pre></td></tr></table></figure><p>功能：首先对循环条件（通常为i）进行initialization（初始化），然后执行termination（判断是否终止循环），然后执行循环体里的语句，最后执行iteration（循环条件i改变）</p><ol start="3" type="1"><li><strong>do while</strong>语句</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">initialization<br><span class="hljs-keyword">do</span>&#123;　　　<br><span class="hljs-comment">//body;　      　</span><br>iteration;<br>&#125;<span class="hljs-keyword">while</span>(termination);<br></code></pre></td></tr></table></figure><p>功能：首先对循环条件（通常为i）进行initialization（初始化），然后执行循环体里的语句，然后执行termination（判断是否终止循环），最后执行iteration（循环条件i改变）</p><p>注：<strong>while</strong>和<strong>do while</strong>语句的区别在于执行循环体和执行termination的顺序。</p><ul><li><strong>跳转语句</strong></li></ul><ol type="1"><li><p><strong>break</strong>语句 格式：break； 功能：终止当前循环体，转移到循环语句的下一条语句或标号处执行。</p></li><li><p><strong>continue</strong>语句 格式：continue； 功能： 跳过当前循环体的剩余语句，转移到下一次循环或标号处执行。</p></li><li><p><strong>return</strong>语句 格式：return [返回值]； 功能：终止方法或程序的执行，将控制返回调用者。</p></li></ol><h2 id="数组和向量">数组和向量</h2><h3 id="数组">数组</h3><ol type="1"><li><p><strong>一维数组的声明</strong> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">arrayType  arrayName[];<br><br>arrayType []arrayName;<br></code></pre></td></tr></table></figure></p></li><li><p><strong>一维数组的创建</strong></p><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//数组元素为简单数据类型</span><br><br><span class="hljs-comment">//静态初始化</span><br> arrayType  arrayName[]=&#123;element1[,element2…]&#125;;<br>arrayType  []arrayName=&#123;element1[,element2…]&#125;;<br><span class="hljs-comment">//例如</span><br><span class="hljs-type">int</span> [] samllPrimes=&#123;<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">7</span>,<span class="hljs-number">11</span>,<span class="hljs-number">13</span>&#125;;<br><br><span class="hljs-comment">//动态初始化</span><br>arrayName= <span class="hljs-keyword">new</span> <span class="hljs-title class_">arrayType</span>[arrayLength];<br><span class="hljs-comment">//声明与初始化合并</span><br>arrayType arrayName= <span class="hljs-keyword">new</span> <span class="hljs-title class_">arrayType</span>[arrayLength];<br><span class="hljs-comment">//例如</span><br><span class="hljs-type">int</span> arr[]=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>]<br><br><span class="hljs-comment">//数组元素为复合数据类型</span><br><br><span class="hljs-comment">//创建数组元素</span><br>arrayName= <span class="hljs-keyword">new</span> <span class="hljs-title class_">arrayType</span>[arrayLength];<br><span class="hljs-comment">//为数组元素开辟存储空间</span><br>arrayName[i]= <span class="hljs-keyword">new</span> <span class="hljs-title class_">arrayType</span>[paramList]<br><span class="hljs-comment">//例如</span><br>String  stringArray[];<br>   stringArray=<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[<span class="hljs-number">3</span>];<br>   stringArray[<span class="hljs-number">0</span>]=<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(″Welcome″);<br>   stringArray[<span class="hljs-number">1</span>]=<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(″To″);<br>   stringArray[<span class="hljs-number">2</span>]=<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(″Zhnejiang″);<br></code></pre></td></tr></table></figure></p></li><li><p><strong>数组操作</strong> 引用数组元素，下标从0开始 数组复制 使用系统类的方法 ( System.arraycopy )。 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  *sourceArray             被复制的数组的数组名</span><br><span class="hljs-comment">  *sourcePosition      被复制的数组的起始位置</span><br><span class="hljs-comment">  *destinationArray  新数组的数组名</span><br><span class="hljs-comment">  *destinationposition 新数组储存复制的数组的起始位置</span><br><span class="hljs-comment">  *numberOfEntriesToCopy 需要被复制的元素个数</span><br><span class="hljs-comment">  */</span><br>  <span class="hljs-comment">//导入所需的库</span><br>  <span class="hljs-keyword">import</span> java.io.*;<br><br>System.arraycopy( sourceArray, sourcePosition,<br>destinationArray, destinationposition, numberOfEntriesToCopy)<br></code></pre></td></tr></table></figure></p></li></ol><h3 id="向量">向量</h3><ul><li>是 java.util 包中的一个类，实现了类似动态数组的功能。</li><li>向量与数组的重要区别之一就是 向量的容量是可变的</li></ul><ol type="1"><li>向量的容量：向量的存储空间大小</li><li>向量的长度：线路的实际元素个数</li><li>向量的增量：向量的长度发生变化时，向量容量的增加量</li><li>增大容量时，向量的新容量取值：</li></ol><pre><code class=" mermaid">graph LRA[MAX] --&gt; B(向量的新长度)A --&gt; C(向量的原长度的2倍)C --&gt;增量等于0A --&gt; D(向量的原长度+容量增量)D --&gt; 增量大于0</code></pre><ul><li>声明格式</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Vector &lt;datatype&gt; variable_identifier;<br></code></pre></td></tr></table></figure><ul><li>构造方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">Vector</span><span class="hljs-params">()</span><br><span class="hljs-comment">//创建空向量, 初始容量为 10 ,容量增量为 0 。</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Vector</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity)</span><br><span class="hljs-comment">//创建空向量, 初始容量为capacity, 容量增量为 0 。</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Vector</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity, <span class="hljs-type">int</span> capacityIncrement)</span><br><span class="hljs-comment">//创建空向量, 初始容量为 initialCapacity，容量增量为 capacityIncrement。</span><br></code></pre></td></tr></table></figure><ul><li>添加元素</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(Element obj)</span><br><span class="hljs-comment">//把element组件加到向量末尾，同时大小加1，向量容量比以前大1</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addElement</span><span class="hljs-params">(Element obj)</span><br><span class="hljs-comment">//同上</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> index,E element)</span><br><span class="hljs-comment">//把element组件加到指定处，此后的内容向后移动1 个单位。 注意与 insertElementAt 的不同参数。</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertElementAt</span><span class="hljs-params">(E element,<span class="hljs-type">int</span> index)</span><br><span class="hljs-comment">//把element组件加到指定处，此后的内容向后移动1个单位</span><br></code></pre></td></tr></table></figure><ul><li>修改元素</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(<span class="hljs-type">int</span> index, E element)</span><br><span class="hljs-comment">//用指定元素替换此向量中指定位置的元素。</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setElementAt</span><span class="hljs-params">(E element,<span class="hljs-type">int</span> index)</span><br><span class="hljs-comment">//将此向量的指定索引处的组件设置为指定对象。</span><br></code></pre></td></tr></table></figure><ul><li>删除元素</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span>    <span class="hljs-title function_">clear</span><span class="hljs-params">()</span><br><span class="hljs-comment">//Removes all of the elements from this Vector.</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span>   <span class="hljs-title function_">removeAllElement</span><span class="hljs-params">()</span><br><span class="hljs-comment">//Removes all components from this vector and sets its size to zero.</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(<span class="hljs-type">int</span> index )</span><br><span class="hljs-comment">//Removes the element at the specified position in this Vector.    Shifts any subsequent elements to the left (subtracts one from their indices). Returns the element that was removed from the Vector.</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeElementAt</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span><br><span class="hljs-comment">//Deletes the component at the specified index.</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(object obj)</span><br><span class="hljs-comment">//Removes the first occurrence of the specified element in this Vector If the Vector does not contain the element, it is unchanged. More formally, removes the element with the lowest index i such that (o==null ? get(i)==null : o.equals(get(i))) (if such an element exists).</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeElement</span><span class="hljs-params">(object obj)</span><br><span class="hljs-comment">//Removes the first (lowest-indexed) occurrence of the argument from this vector. If the object is found in this vector, each component in the vector with an index greater or equal to the object&#x27;s index is shifted downward to have an index one smaller than the value it had previously.</span><br></code></pre></td></tr></table></figure><ul><li>查询</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">contains</span><span class="hljs-params">(object obj)</span><br><span class="hljs-comment">//Returns true if this vector contains the specified element.</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(object obj)</span><br><span class="hljs-comment">//Compares the specified Object with this Vector for equality.</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">indexof</span><span class="hljs-params">(object obj)</span><br><span class="hljs-comment">//Returns the index of the first occurrence of the specified element in this vector, or -1 if this vector does not contain the element.</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">indexof</span><span class="hljs-params">(object obj,<span class="hljs-type">int</span> index)</span><br><span class="hljs-comment">//Returns the index of the first occurrence of the specified element in this vector, searching forwards from index, or returns -1 if the element is not found.</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">lastIndexof</span><span class="hljs-params">(object obj)</span><br><span class="hljs-comment">//Returns the index of the last occurrence of the specified element in this vector, or -1 if this vector does not contain the element.</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">lastIndexof</span><span class="hljs-params">(object obj,<span class="hljs-type">int</span> index)</span><br><span class="hljs-comment">//Returns the index of the last occurrence of the specified element in this vector, searching backwards from index, or returns -1 if the element is not found.</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">capacity</span><span class="hljs-params">()</span><br><span class="hljs-comment">//Returns the current capacity of this vector.</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span><br><span class="hljs-comment">//Returns the number of components in this vector.</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span><br><span class="hljs-comment">//Tests if this vector has no components.</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSize</span><span class="hljs-params">(<span class="hljs-type">int</span> newSize)</span><br><span class="hljs-comment">//Sets the size of this vector.</span><br></code></pre></td></tr></table></figure><ul><li>可在向量的任意位置插入不同类型的对象，无需考虑对象的类型，也无需考虑向量的容量。</li><li>向量只能存储对象，不能直接存储简单数据类型。</li><li>适合向量的场合: 频繁进行对象的插入和删除工作 需要处理的对象数目不定 列表成员全部都是对象，或者可以方便的用对象表示 需要很快确定列表内是否存在某一特定对象，并且需要很快了解到对象的存放位置</li><li>适合数组的场合: 所需处理的对象数目大致可以确定 所需处理的是简单数据类型</li></ul>]]></content>
    
    
    <categories>
      
      <category>Summarize</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>线性表浅谈</title>
    <link href="/2022/11/17/%E7%BA%BF%E6%80%A7%E8%A1%A8%E6%B5%85%E8%B0%88/"/>
    <url>/2022/11/17/%E7%BA%BF%E6%80%A7%E8%A1%A8%E6%B5%85%E8%B0%88/</url>
    
    <content type="html"><![CDATA[<h2 id="线性表的概念">线性表的概念</h2><p>线性表，全名为线性储存结构。储存方式可以理解为“把所有数据用一根线串起来，再储存到物理空间中”。 <img src="https://img-blog.csdnimg.cn/20200815133635360.gif#pic_center" alt="数据的线性结构" /></p><h2 id="储存数据的特点">储存数据的特点</h2><ul><li>具有“一对一”逻辑关系。</li><li>要求数据的数据类型必须一致。</li></ul><h2 id="线性表的分类">线性表的分类</h2><p>线性表存储数据可分为<strong>顺序存储结构</strong>和<strong>链式存储结构</strong></p><h3 id="顺序存储结构">顺序存储结构</h3><p>将数据依次连续的存入一整块物理空间之中（简称顺序表），如下图所示：</p><figure><img src="https://img-blog.csdnimg.cn/20200815134201576.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70#pic_center" alt="数据集中存放" /><figcaption aria-hidden="true">数据集中存放</figcaption></figure><h3 id="链式存储结构">链式存储结构</h3><p>数据分散的存储在物理空间中，通过一根线保存着他们之间的逻辑关系（简称链表），如下图所示：</p><figure><img src="https://img-blog.csdnimg.cn/20200815134409696.png#pic_center" alt="数据分散存放" /><figcaption aria-hidden="true">数据分散存放</figcaption></figure><h2 id="元素的前驱与后继">元素的前驱与后继</h2><p>数据结构中，每个数据个体被称为“数据元素”（简称“元素”），每个元素都有前驱和后驱。</p><h3 id="前驱">前驱</h3><ul><li>某一元素的左侧相邻元素称为“直接前驱”，位于此元素左侧的所有元素统称为“前驱元素”。</li></ul><h3 id="后继">后继</h3><ul><li>某一元素的右侧相邻元素称为“直接后继”，位于此元素右侧的所有元素统称为“后继元素”。</li></ul><p>例如下图中数据 <img src="https://img-blog.csdnimg.cn/20200815135039516.gif#pic_center" alt="前驱与后继" /></p><p>对于3，2是它的直接前驱，4是它的直接后继；1和2则是它的前驱元素，4和5则是它的后继元素。</p>]]></content>
    
    
    <categories>
      
      <category>Summarize</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>数据结构</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>内存对齐浅析</title>
    <link href="/2022/11/17/%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90%E6%B5%85%E6%9E%90/"/>
    <url>/2022/11/17/%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90%E6%B5%85%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="引入">引入</h2><p>在了解内存对齐之前，我们先来做个简短的测试。 看看下面的代码输出的结果。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> std::cout;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">test</span>&#123;<br><span class="hljs-type">int</span> x;<br><span class="hljs-type">char</span> y;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br><br>test t;<br>cout&lt;&lt;<span class="hljs-built_in">sizeof</span>(t); <span class="hljs-comment">//输出结果是多少？</span><br><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>如果你的答案是<strong>8</strong>，那么恭喜你答对了，不过相信很多人并不理解为什么是<strong>8</strong>，而不是<strong>5</strong>。按照正常思路，32位系统下，<strong>int</strong>占<strong>4</strong>个字节，<strong>char</strong>占<strong>1</strong>个字节，<strong>4+1=5</strong>,所以<strong>t</strong>占<strong>5</strong>个字节，<strong>sizeof</strong> 应该返回<strong>5</strong>，那为什么是<strong>8</strong>呢？ 这就涉及到了文章的主题，<strong><em>内存对齐</em></strong>。</p><h2 id="内存对齐的原因">内存对齐的原因</h2><p>原因主要分两部分，平台原因和性能原因。</p><h3 id="平台原因">平台原因</h3><p>因为现代计算机中内存的最小单位是<strong>byte</strong>，所以从理论上讲似乎对任何类型的变量的访问可以从任何地址开始。 但是实际上有些硬件平台对基本类型数据在内存中存放的位置有限制，它们会要求这些数据的首地址的值是<strong>某个数k（通常它为4或8）的倍数</strong> 。</p><h3 id="性能原因">性能原因</h3><p>假如没有内存对齐机制，数据可以任意存放，现在一个<strong>int</strong>变量存放在从地址<strong>1</strong>开始的联系四个字节地址中，该处理器去取数据时，要先从<strong>0</strong>地址开始读取第一个<strong>4</strong>字节块,剔除不想要的字节（<strong>0</strong>地址）,然后从地址<strong>4</strong>开始读取下一个<strong>4</strong>字节块,同样剔除不要的数据（<strong>5，6，7</strong>地址）,最后留下的两块数据合并放入寄存器，这需要做很多工作。</p><h2 id="内存对齐规则">内存对齐规则</h2><blockquote><p>每个特定平台上的编译器都有自己的默认“<strong>对齐系数</strong>”(也叫<strong>对齐模数</strong>)。程序员可以通过预编译命令#<strong>pragma pack(n)，n=1,2,4,8,16</strong>来改变这一系数，其中的<strong>n</strong>就是你要指定的“<strong>对齐系数</strong>”。</p></blockquote><p>有效对其值：是给定值<code>#pragma pack(n)</code>和结构体中<strong>最长数据类型长度中较小的</strong>那个。有效对齐值也叫<strong>对齐单位</strong>。</p><h3 id="对齐规则">对齐规则</h3><h4 id="数据成员对齐规则">1、数据成员对齐规则</h4><blockquote><p><strong>结构(struct)</strong>(或<strong>联合(union)</strong>)的数据成员，第一个数据成员放在<strong>offset</strong>为<strong>0</strong>的地方，以后每个数据成员的对齐按照#pragma pack指定的数值和这个数据成员自身长度中，<strong>比较小</strong>的那个进行。</p></blockquote><h4 id="结构或联合的整体对齐规则">2、结构(或联合)的整体对齐规则</h4><blockquote><p>在数据成员完成各自对齐之后，<strong>结构(或联合)本身也要进行对齐</strong>，对齐将按照#pragma pack指定的数值和结构(或联合)最大数据成员长度中，<strong>比较小</strong>的那个进行。</p></blockquote><h4 id="结合12">3、结合1、2</h4><blockquote><p>当#pragma pack的<strong>n</strong>值<strong>等于或超过</strong>所有数据成员长度的时候，这个<strong>n</strong>值的大小将不产生任何效果。</p></blockquote><h2 id="案例分析">案例分析</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> std::cout;<br><span class="hljs-keyword">using</span> std::endl;<br><span class="hljs-keyword">struct</span><br>&#123;<br>   <span class="hljs-type">char</span> c1;<br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-type">char</span> c2;<br>&#125;x1;<br><br><br><span class="hljs-keyword">struct</span> &#123;<br>    <span class="hljs-type">char</span> c1;<br>    <span class="hljs-type">char</span> c2;<br>    <span class="hljs-type">int</span> i;<br>&#125;x2;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    cout &lt;&lt; <span class="hljs-built_in">sizeof</span>(x1) &lt;&lt; endl;  <span class="hljs-comment">// 输出12</span><br>    cout &lt;&lt; <span class="hljs-built_in">sizeof</span>(x2) &lt;&lt; endl;  <span class="hljs-comment">// 输出8</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>以上测试都是在<strong>Win32</strong>环境下进行的，默认#<strong>pragma pack(4)</strong>，因此<strong>对齐单位</strong>为<strong>4</strong>。</p><p>以<strong>x1</strong>对象分析，首先使用<strong>对齐规则1</strong>，对<strong>x1</strong>的<strong>数据成员</strong>进行<strong>内存对齐</strong></p><p>sizeof(c1) = 1 &lt; 4(<strong>对齐单位</strong>) 所以按照<strong>1</strong>字节对齐，占内存的第<strong>0</strong>单元。 sizeof(i) = 4 &lt; = 4(<strong>对齐单位</strong>) 相对于结构体首地址的偏移要为<strong>4</strong>的倍数，占内存的<strong>4,5,6,7</strong>单元。 sizeof(c2) = 1 &lt; 4(<strong>对齐单位</strong>) 相对于结构体首地址的偏移要为<strong>4</strong>的倍数，占内存的第<strong>8</strong>单元。</p><p>接着，使用<strong>对齐规则2</strong>，对<strong>结构体整体</strong>进行<strong>内存对齐</strong>。</p><p><strong>x1</strong>中变量i占用内存最大占<strong>4</strong>字节，而有效对齐单位也为<strong>4</strong>字节，两者较小值就是<strong>4</strong>字节。因此<strong>整体也是按照4字节对齐</strong>。由<strong>对齐规则1</strong>得到<strong>x1</strong>占<strong>9</strong>个字节，此处再按照<strong>对齐规则2</strong>进行整体的<strong>4</strong>字节对齐，所以整个结构体占用<strong>12</strong>个字节。<img src="https://img-blog.csdnimg.cn/20200716221214388.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2gyNzYzMjQ2ODIz,size_16,color_FFFFFF,t_70#pic_center" alt="x1内存布局" /> <strong>x2</strong>对象的分析也是类似。 先套用<strong>对齐规则1</strong>，<strong>c1</strong>和<strong>c2</strong>都是按照<strong>1</strong>个字节对齐，分别占用内存的第<strong>0</strong>和<strong>1</strong>单元，<strong>i</strong>相对于结构体首地址的偏移要为<strong>4</strong>的倍数，占内存的<strong>4,5,6,7</strong>单元。 再套用<strong>对齐规则2</strong>，因此<strong>整体也是按照4字节对齐</strong>。由<strong>对齐规则1</strong>得到<strong>x2</strong>占<strong>8</strong>个字节，此处再按照<strong>对齐规则2</strong>进行整体的<strong>4</strong>字节对齐，所以整个结构体占用<strong>8</strong>个字节。</p><blockquote><p>参考资料： <a href="https://baike.baidu.com/item/%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/9537460?fr=aladdin">内存对齐_百度百科</a> <a href="https://zhuanlan.zhihu.com/p/30007037">C/C++内存对齐详解 - 知乎</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Summarize</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
